<!doctype html><html lang=zh-CN data-theme=light><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#19b8eb" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.126.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="磁盘存储和文件系统"><meta itemprop=description content="1208034077#qq.com"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="http://localhost:1313/imgs/hugo_next_avatar.png"><meta itemprop=keywords content="linux"><meta property="og:type" content="article"><meta property="og:title" content="磁盘存储和文件系统"><meta property="og:description" content="1208034077#qq.com"><meta property="og:image" content="/imgs/hugo_next_avatar.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="http://localhost:1313/post/linux11/"><meta property="og:site_name" content="蓝惠の小窝"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="蓝惠の小窝"><meta property="article:published_time" content="2024-12-15 20:06:00 +0800 CST"><meta property="article:modified_time" content="2024-12-15 20:06:00 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"path":"linux11","permalink":"http://localhost:1313/post/linux11/","title":"磁盘存储和文件系统","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://hm.baidu.com/hm.js?",e.async="true",document.head.appendChild(e)})</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>磁盘存储和文件系统 - 蓝惠の小窝</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>蓝惠の小窝</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>寻找大波斯菊需要的不是金钱，而是一颗去找寻的心♥.</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>友链</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>79</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#磁盘结构>磁盘结构</a><ul><li><a href=#设备文件>设备文件</a></li></ul></li><li><a href=#硬盘类型>硬盘类型</a></li><li><a href=#机械硬盘和固态硬盘>机械硬盘和固态硬盘</a></li><li><a href=#硬盘存储术语>硬盘存储术语</a></li><li><a href=#管理存储>管理存储</a><ul><li><a href=#磁盘分区>磁盘分区</a><ul><li><a href=#为什么分区>为什么分区</a></li><li><a href=#分区方式>分区方式</a></li><li><a href=#mbr分区>MBR分区</a></li><li><a href=#gpt分区>GPT分区</a></li><li><a href=#bios和uefi>BIOS和UEFI</a></li></ul></li><li><a href=#管理分区>管理分区</a><ul><li><a href=#parted-命令>parted 命令</a></li><li><a href=#分区工具fdisk和gdisk><strong>分区工具fdisk和gdisk</strong></a></li></ul></li></ul></li><li><a href=#文件系统>文件系统</a><ul><li><a href=#文件系统概念>文件系统概念</a></li><li><a href=#文件系统类型>文件系统类型</a></li><li><a href=#文件系统的组成部分>文件系统的组成部分</a><ul><li><a href=#创建文件系统>创建文件系统</a></li><li><a href=#查看和管理分区信息>查看和管理分区信息</a></li><li><a href=#文件系统检测和修复>文件系统检测和修复</a></li></ul></li></ul></li><li><a href=#挂载>挂载</a><ul><li><a href=#添加新硬盘让kernel发现新硬盘>添加新硬盘，让kernel发现新硬盘</a></li><li><a href=#挂载文件系统-mount>挂载文件系统 mount</a></li><li><a href=#卸载文件系统-umount>卸载文件系统 umount</a></li><li><a href=#查看挂载情况>查看挂载情况</a></li><li><a href=#持久挂载>持久挂载</a></li></ul></li><li><a href=#处理交换文件和分区>处理交换文件和分区</a><ul><li><a href=#swap-介绍>swap 介绍</a></li><li><a href=#交换分区实现过程>交换分区实现过程</a></li><li><a href=#禁用swap分区>禁用swap分区：</a></li><li><a href=#调整swap启用标准>调整swap启用标准</a></li><li><a href=#关闭swap>关闭swap</a></li><li><a href=#swap的使用策略>swap的使用策略</a></li></ul></li><li><a href=#移动介质>移动介质</a><ul><li><a href=#使用光盘>使用光盘</a></li><li><a href=#usb介质>USB介质</a></li></ul></li><li><a href=#磁盘常见工具>磁盘常见工具</a><ul><li><a href=#文件系统空间实际真正占用等信息的查看工具-df>文件系统空间实际真正占用等信息的查看工具 df</a></li><li><a href=#查看某目录总体空间实际占用状态-du>查看某目录总体空间实际占用状态 du</a></li><li><a href=#大厂面试题>大厂面试题:</a></li><li><a href=#工具-dd>工具 dd</a></li><li><a href=#练习>练习</a></li></ul></li><li><a href=#raid>RAID</a><ul><li><a href=#raid级别>RAID级别</a></li></ul></li><li><a href=#逻辑卷管理器lvm>逻辑卷管理器（LVM）</a><ul><li><a href=#lvm介绍>LVM介绍</a></li></ul></li><li><a href=#实现逻辑卷>实现逻辑卷</a><ul><li><a href=#pv管理工具>pv管理工具</a><ul><li><a href=#创建pv>创建pv</a></li><li><a href=#删除pv>删除pv</a></li></ul></li><li><a href=#vg管理工具>vg管理工具</a><ul><li><a href=#显示卷组>显示卷组</a></li><li><a href=#创建卷组>创建卷组</a></li><li><a href=#管理卷组>管理卷组</a></li></ul></li><li><a href=#lv管理工具>lv管理工具</a><ul><li><a href=#显示逻辑卷>显示逻辑卷</a></li><li><a href=#创建逻辑卷>创建逻辑卷</a></li><li><a href=#删除逻辑卷>删除逻辑卷</a></li><li><a href=#重设文件系统大小>重设文件系统大小</a></li></ul></li><li><a href=#扩展和缩减逻辑卷>扩展和缩减逻辑卷</a><ul><li><a href=#在线扩展逻辑卷>在线扩展逻辑卷</a></li><li><a href=#缩减逻辑卷>缩减逻辑卷</a></li></ul></li><li><a href=#跨主机迁移卷组>跨主机迁移卷组</a><ul><li><a href=#1-在旧系统中umount-所有卷组上的逻辑卷>1 在旧系统中，umount 所有卷组上的逻辑卷</a></li><li><a href=#2-禁用卷组>2 禁用卷组</a></li><li><a href=#3-导出卷组>3 导出卷组</a></li><li><a href=#4-拆下旧硬盘在目标计算机上并导入卷组>4 拆下旧硬盘在目标计算机上,并导入卷组：</a></li><li><a href=#5-启用>5 启用</a></li><li><a href=#6-mount-所有卷组上的逻辑卷>6 mount 所有卷组上的逻辑卷</a></li></ul></li><li><a href=#拆除指定的pv存储设备>拆除指定的PV存储设备</a></li></ul></li><li><a href=#逻辑卷快照>逻辑卷快照</a><ul><li><a href=#逻辑卷快照原理>逻辑卷快照原理</a></li><li><a href=#实现逻辑卷快照>实现逻辑卷快照</a><ul><li><a href=#为现有逻辑卷创建快照>为现有逻辑卷创建快照</a></li><li><a href=#挂载快照>挂载快照</a></li><li><a href=#恢复快照>恢复快照</a></li><li><a href=#删除快照>删除快照</a></li><li><a href=#练习-1>练习</a></li></ul></li><li><a href=#卸载逻辑卷>卸载逻辑卷</a></li></ul></li><li><a href=#常见面试题>常见面试题</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=蓝惠の小窝 src=/imgs/img-lazy-loading.gif data-src=/imgs/hugo_next_avatar.png><p class=site-author-name itemprop=name>蓝惠の小窝</p><div class=site-description itemprop=description>1208034077#qq.com</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>79</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>7</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>55</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/lanhui672 title="Github → https://github.com/lanhui672" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title></div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=http://lanhui.live title=http://lanhui.live target=_blank>短域密语</a></li><li class=links-of-blogroll-item><a href=http://lan-hui.com title=http://lan-hui.com target=_blank>引导页</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=0001-01-01T00:00:00+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=146430></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=337></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2024-12-15T20:06:00+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title=直达评论><i class="fas fa-comments"></i></div><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/lanhui672/lanhui672.github.io/wiki rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=http://localhost:1313/post/linux11/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/hugo_next_avatar.png"><meta itemprop=name content="蓝惠の小窝"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="蓝惠の小窝"><meta itemprop=description content="1208034077#qq.com"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="磁盘存储和文件系统"><meta itemprop=description content="磁盘结构 设备文件 设备文件：关联至一个设备驱动程序，进而能够跟与之对应硬件设备进行通信 设备号码： * 主设备号：major number, 标识设备类型 * 次设备号"></span><header class=post-header><h1 class=post-title itemprop="name headline">磁盘存储和文件系统</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2024-12-15 20:06:00 +0800 CST" itemprop="dateCreated datePublished" datetime="2024-12-15 20:06:00 +0800 CST">2024-12-15
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/linux itemprop=url rel=index><span itemprop=name>linux</span></a></span></span></div><div class=post-meta-items></div></div><meta name=baidu-site-verification content="codeva-CvrLlzui8a"><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?289d43bfba112a047eccf686e7551557",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></header><div class="post-body autonumber" itemprop=articleBody><h2 id=磁盘结构>磁盘结构
<a class=header-anchor href=#%e7%a3%81%e7%9b%98%e7%bb%93%e6%9e%84></a></h2><h3 id=设备文件>设备文件
<a class=header-anchor href=#%e8%ae%be%e5%a4%87%e6%96%87%e4%bb%b6></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>设备文件：关联至一个设备驱动程序，进而能够跟与之对应硬件设备进行通信  
</span></span><span style=display:flex><span>设备号码：  
</span></span><span style=display:flex><span>* 主设备号：major number, 标识设备类型
</span></span><span style=display:flex><span>* 次设备号：minor number, 标识同一类型下的不同设备
</span></span><span style=display:flex><span>设备类型： 
</span></span><span style=display:flex><span>* 块设备：block，存取单位“块”，磁盘
</span></span><span style=display:flex><span>* 字符设备：char，存取单位“字符”，键盘
</span></span><span style=display:flex><span>磁盘设备的设备文件命名：  
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>dev/DEV_FILE
</span></span><span style=display:flex><span>/dev/sdX # SAS,SATA,SCSI,IDE,USB
</span></span><span style=display:flex><span>/dev/nvme0n# #nvme协议硬盘，如：第一个硬盘：nvme0n1，第二个硬盘：nvme0n2
</span></span></code></pre></div><p>虚拟磁盘：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>/dev/vd
</span></span><span style=display:flex><span>/dev/xvd
</span></span></code></pre></div><p>不同磁盘标识：a-z,aa,ab…
示例：/dev/sda，/dev/sdb, &mldr;
同一设备上的不同分区：1,2, &mldr;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>/dev/sda1
</span></span><span style=display:flex><span>/dev/sda5
</span></span></code></pre></div><p>范例：创建设备文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#df /boot</span>
</span></span><span style=display:flex><span>Filesystem <span style=color:#ae81ff>1</span>K<span style=color:#f92672>-</span>blocks Used Available Use<span style=color:#f92672>%</span> Mounted on
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>sda1 <span style=color:#ae81ff>999320</span> <span style=color:#ae81ff>130848</span> <span style=color:#ae81ff>799660</span> <span style=color:#ae81ff>15</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>boot
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#ls /boot</span>
</span></span><span style=display:flex><span>config<span style=color:#f92672>-</span><span style=color:#ae81ff>4.18</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span><span style=color:#ae81ff>147.</span>el8<span style=color:#f92672>.</span>x86_64 loader
</span></span><span style=display:flex><span>efi lost<span style=color:#f92672>+</span>found
</span></span><span style=display:flex><span>grub2 System<span style=color:#f92672>.</span>map<span style=color:#f92672>-</span><span style=color:#ae81ff>4.18</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>147.</span>el8<span style=color:#f92672>.</span>x86_64
</span></span><span style=display:flex><span>initramfs<span style=color:#f92672>-</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span>rescue<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>b85fc7444b240a992c42ce2a9f65db5<span style=color:#f92672>.</span>img vmlinuz<span style=color:#f92672>-</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span>rescue<span style=color:#f92672>-</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span>b85fc7444b240a992c42ce2a9f65db5
</span></span><span style=display:flex><span>initramfs<span style=color:#f92672>-</span><span style=color:#ae81ff>4.18</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span><span style=color:#ae81ff>147.</span>el8<span style=color:#f92672>.</span>x86_64<span style=color:#f92672>.</span>img vmlinuz<span style=color:#f92672>-</span><span style=color:#ae81ff>4.18</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>147.</span>el8<span style=color:#f92672>.</span>x86_64
</span></span><span style=display:flex><span>initramfs<span style=color:#f92672>-</span><span style=color:#ae81ff>4.18</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span><span style=color:#ae81ff>147.</span>el8<span style=color:#f92672>.</span>x86_64kdump<span style=color:#f92672>.</span>img
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#mknod /data/partition-sda1 b 8 1</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#ll /data/partition-sda1</span>
</span></span><span style=display:flex><span>brw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>1</span> Apr <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>15</span> <span style=color:#f92672>/</span>data<span style=color:#f92672>/</span>partition<span style=color:#f92672>-</span>sda1
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#mount /data/partition-sda1 /mnt/  </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#ls /mnt</span>
</span></span><span style=display:flex><span>config<span style=color:#f92672>-</span><span style=color:#ae81ff>4.18</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span><span style=color:#ae81ff>147.</span>el8<span style=color:#f92672>.</span>x86_64 loader
</span></span><span style=display:flex><span>efi lost<span style=color:#f92672>+</span>found
</span></span><span style=display:flex><span>grub2 System<span style=color:#f92672>.</span>map<span style=color:#f92672>-</span><span style=color:#ae81ff>4.18</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>147.</span>el8<span style=color:#f92672>.</span>x86_64
</span></span><span style=display:flex><span>initramfs<span style=color:#f92672>-</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span>rescue<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>b85fc7444b240a992c42ce2a9f65db5<span style=color:#f92672>.</span>img vmlinuz<span style=color:#f92672>-</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span>rescue<span style=color:#f92672>-</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span>b85fc7444b240a992c42ce2a9f65db5
</span></span><span style=display:flex><span>initramfs<span style=color:#f92672>-</span><span style=color:#ae81ff>4.18</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span><span style=color:#ae81ff>147.</span>el8<span style=color:#f92672>.</span>x86_64<span style=color:#f92672>.</span>img vmlinuz<span style=color:#f92672>-</span><span style=color:#ae81ff>4.18</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>147.</span>el8<span style=color:#f92672>.</span>x86_64
</span></span><span style=display:flex><span>initramfs<span style=color:#f92672>-</span><span style=color:#ae81ff>4.18</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0</span><span style=color:#f92672>-</span><span style=color:#ae81ff>147.</span>el8<span style=color:#f92672>.</span>x86_64kdump<span style=color:#f92672>.</span>img
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#ll /dev/zero</span>
</span></span><span style=display:flex><span>crw<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span>rw<span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>5</span> Apr <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>03</span> <span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>zero
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#mknod /data/zero c 1 5</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#ll /data/zero</span>
</span></span><span style=display:flex><span>crw<span style=color:#f92672>-</span>r<span style=color:#f92672>--</span>r<span style=color:#f92672>--</span> <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>5</span> Apr <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>09</span>:<span style=color:#ae81ff>17</span> <span style=color:#f92672>/</span>data<span style=color:#f92672>/</span>zero
</span></span></code></pre></div><p>在Linux系统中，mknod 命令用于创建特殊的文件，如块设备文件或字符设备文件。这个命令通常用于创建设备文件，这些文件代表系统中的硬件设备。</p><p>命令 mknod /data/partition-sda1 b 8 1 的含义如下：</p><p>mknod：命令名，用于创建特殊文件。<br>/data/partition-sda1：这是你想要创建的设备文件的路径和名称。在这个例子中，你将在 /data 目录下创建一个名为 partition-sda1 的文件。<br>b：表示你正在创建一个块设备文件。块设备是指那些以块为单位读写数据的设备，如硬盘。<br>8：这是主设备号，它标识了设备的类型。在Linux系统中，8通常代表第一个SCSI硬盘。<br>1：这是次设备号，它用于区分同一类型的不同设备。在这个例子中，1表示第一个分区。<br>总的来说，这个命令的作用是在 /data 目录下创建一个名为 partition-sda1 的块设备文件，代表第一个SCSI硬盘的第一个分区。这个文件可以用来访问和操作这 个分区，就像访问一个普通文件一样。<br>mknod /data/zero c 1 5个命令的作用是在 /data 目录下创建一个名为 zero 的字符设备文件，1：这是主设备号，它标识了设备的类型。5：这是次设备号，它用于区分同一类型的不同设备。在这个例子中，5表示这个特定的字符设备。
范例: 操纵设备文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#ll /dev/null /dev/zero
</span></span><span style=display:flex><span>crw-rw-rw- 1 root root 1, 3 Aug 14 2020 /dev/null
</span></span><span style=display:flex><span>crw-rw-rw- 1 root root 1, 5 Aug 14 2020 /dev/zero
</span></span><span style=display:flex><span>[root@centos8 ~]#mknod /data/testdev c 1 5
</span></span><span style=display:flex><span>[root@centos8 ~]#ll /data/testdev
</span></span><span style=display:flex><span>crw-r--r-- 1 root root 1, 5 Aug 14 09:26 /data/testdev
</span></span><span style=display:flex><span>[root@centos8 ~]#dd if=/data/testdev of=/data/test1.img bs=1 count=10
</span></span><span style=display:flex><span>10+0 records in
</span></span><span style=display:flex><span>10+0 records out
</span></span><span style=display:flex><span>10 bytes copied, 9.0379e-05 s, 111 kB/s
</span></span><span style=display:flex><span>[root@centos8 ~]#ll /data/test1.img
</span></span><span style=display:flex><span>-rw-r--r-- 1 root root 10 Aug 14 09:27 /data/test1.img
</span></span><span style=display:flex><span>[root@centos8 ~]#hexdump -C /data/test1.img
</span></span><span style=display:flex><span>00000000 00 00 00 00 00 00 00 00 00 00 |..........|
</span></span><span style=display:flex><span>0000000a
</span></span><span style=display:flex><span>[root@centos8 ~]#rm -f /data/testdev
</span></span><span style=display:flex><span>[root@centos8 ~]#ll /data
</span></span><span style=display:flex><span>total 4
</span></span><span style=display:flex><span>-rw-r--r-- 1 root root 10 Aug 14 09:27 test1.img
</span></span><span style=display:flex><span>[root@centos8 ~]#cp /dev/zero /data/zero
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span>[root@centos8 ~]#ll -h /data/zero
</span></span><span style=display:flex><span>-rw-r--r-- 1 root root 155M Aug 14 09:29 /data/zero
</span></span><span style=display:flex><span>[root@centos8 ~]#ll -h /data/zero /dev/zero
</span></span><span style=display:flex><span>-rw-r--r-- 1 root root 155M Aug 14 09:29 /data/zero
</span></span><span style=display:flex><span>crw-rw-rw- 1 root root 1, 5 Aug 14 2020 /dev/zero
</span></span><span style=display:flex><span>[root@centos8 ~]#cp -a /dev/zero /data/zero
</span></span><span style=display:flex><span>cp: overwrite &#39;/data/zero&#39;? y
</span></span><span style=display:flex><span>[root@centos8 ~]#ll /data/zero
</span></span><span style=display:flex><span>crw-rw-rw- 1 root root 1, 5 Aug 14 2020 /data/zero
</span></span></code></pre></div><h2 id=硬盘类型>硬盘类型
<a class=header-anchor href=#%e7%a1%ac%e7%9b%98%e7%b1%bb%e5%9e%8b></a></h2><p>硬盘接口类型</p><ul><li>IDE：133MB/s，并行接口，早期家用电脑</li><li>SCSI：640MB/s，并行接口，早期服务器</li><li>SATA：6Gbps，SATA数据端口与电源端口是分开的，即需要两条线，一条数据线，一条电源线</li><li>SAS：6Gbps，SAS是一整条线，数据端口与电源端口是一体化的，SAS中是包含供电线的，而
SATA中不包含供电线。SATA标准其实是SAS标准的一个子集，二者可兼容，SATA硬盘可以插入
SAS主板上，反之不行</li><li>USB：480MB/s</li><li>M.2：
注意：速度不是由单纯的接口类型决定，支持Nvme协议硬盘速度是最快的
<strong>服务器硬盘大小</strong></li><li>LFF：3.5寸，一般见到的那种台式机硬盘的大小</li><li>SFF：Small Form Factor 小形状因数，2.5寸，注意不同于2.5寸的笔记本硬盘
L、S分别是大、小的意思，目前服务器或者盘柜采用sff规格的硬盘主要是考内虑增大单位密度内的磁盘
容量、增强散热、减小功耗</li></ul><h2 id=机械硬盘和固态硬盘>机械硬盘和固态硬盘
<a class=header-anchor href=#%e6%9c%ba%e6%a2%b0%e7%a1%ac%e7%9b%98%e5%92%8c%e5%9b%ba%e6%80%81%e7%a1%ac%e7%9b%98></a></h2><p>机械硬盘（HDD）：Hard Disk Drive，即是传统普通硬盘，主要由：盘片，磁头，盘片转轴及控制电
机，磁头控制器，数据转换器，接口，缓存等几个部分组成。机械硬盘中所有的盘片都装在一个旋转轴
上，每张盘片之间是平行的，在每个盘片的存储面上有一个磁头，磁头与盘片之间的距离比头发丝的直
径还小，所有的磁头联在一个磁头控制器上，由磁头控制器负责各个磁头的运动。磁头可沿盘片的半径
方向运动，加上盘片每分钟几千转的高速旋转，磁头就可以定位在盘片的指定位置上进行数据的读写操
作。数据通过磁头由电磁流来改变极性方式被电磁流写到磁盘上，也可以通过相反方式读取。硬盘为精
密设备，进入硬盘的空气必须过滤
固态硬盘（SSD）：Solid State Drive，用固态电子存储芯片阵列而制成的硬盘，由控制单元和存储单
元（FLASH芯片、DRAM芯片）组成。固态硬盘在接口的规范和定义、功能及使用方法上与普通硬盘的
完全相同，在产品外形和尺寸上也与普通硬盘一致
相较于HDD，SSD在防震抗摔、传输速率、功耗、重量、噪音上有明显优势，SSD传输速率性能是HDD
的2倍
相较于SSD，HDD在价格、容量占有绝对优势
硬盘有价，数据无价，目前SSD不能完全取代HHD</p><h2 id=硬盘存储术语>硬盘存储术语
<a class=header-anchor href=#%e7%a1%ac%e7%9b%98%e5%ad%98%e5%82%a8%e6%9c%af%e8%af%ad></a></h2><ul><li>硬盘存储术语 CHS</li><li>head：磁头 磁头数=盘面数</li><li>track：磁道 磁道=柱面数</li><li>sector：扇区，512bytes</li><li>cylinder：柱面 1柱面=512 * sector数/track<em>head数=512</em>63*255=7.84M
CentOS 5 之前版本 Linux 以柱面的整数倍划分分区，CentOS 6之后可以支持以扇区划分分区
范例:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos6 ~]#echo &#34;scale=2;512*63*255/1024/1024&#34; |bc
</span></span><span style=display:flex><span>7.84
</span></span><span style=display:flex><span>#查看CHS
</span></span><span style=display:flex><span>[root@centos6 ~]#fdisk -l /dev/sda
</span></span><span style=display:flex><span>Disk /dev/sda: 214.7 GB, 214748364800 bytes
</span></span><span style=display:flex><span>255 heads, 63 sectors/track, 26108 cylinders
</span></span><span style=display:flex><span>Units = cylinders of 16065 * 512 = 8225280 bytes
</span></span><span style=display:flex><span>Sector size (logical/physical): 512 bytes / 512 bytes
</span></span><span style=display:flex><span>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span></span><span style=display:flex><span>Disk identifier: 0x0006fc79
</span></span><span style=display:flex><span>Device Boot Start End Blocks Id System
</span></span><span style=display:flex><span>/dev/sda1 * 1 131 1048576 83 Linux
</span></span><span style=display:flex><span>Partition 1 does not end on cylinder boundary.
</span></span><span style=display:flex><span>/dev/sda2 131 12879 102400000 83 Linux
</span></span><span style=display:flex><span>/dev/sda3 12879 19253 51200000 83 Linux
</span></span><span style=display:flex><span>/dev/sda4 19253 26109 55065600 5 Extended
</span></span><span style=display:flex><span>/dev/sda5 19254 19515 2097152 82 Linux swap / Solaris
</span></span><span style=display:flex><span>[root@centos8 ~]#fdisk -u=cylinder -l /dev/sda
</span></span><span style=display:flex><span>Disk /dev/sda: 200 GiB, 214748364800 bytes, 419430400 sectors
</span></span><span style=display:flex><span>Geometry: 255 heads, 2 sectors/track, 26108 cylinders
</span></span><span style=display:flex><span>Units: cylinders of 510 * 512 = 261120 bytes
</span></span><span style=display:flex><span>Sector size (logical/physical): 512 bytes / 512 bytes
</span></span><span style=display:flex><span>I/O size (minimum/optimal): 512 bytes / 512 bytes
</span></span><span style=display:flex><span>Disklabel type: dos
</span></span><span style=display:flex><span>Disk identifier: 0x59474ddc
</span></span><span style=display:flex><span>Device Boot Start End Cylinders Size Id Type
</span></span><span style=display:flex><span>/dev/sda1 * 5 4117 4113 1G 83 Linux
</span></span><span style=display:flex><span>/dev/sda2 4117 415323 411207 100G 83 Linux
</span></span><span style=display:flex><span>/dev/sda3 415323 620926 205604 50G 83 Linux
</span></span><span style=display:flex><span>/dev/sda4 620926 822413 201488 49G 5 Extended
</span></span><span style=display:flex><span>/dev/sda5 620930 629154 8225 2G 82 Linux swap / Solaris
</span></span></code></pre></div><p>fdisk 是一个用于磁盘分区的程序。它提供了磁盘分区管理功能，包括创建、删除、修改和查看磁盘分区等。</p><p>命令 fdisk -u=cylinder -l /dev/sda 的含义如下：</p><p>fdisk：命令名，用于磁盘分区管理。<br>-u=cylinder：这个选项指定 fdisk 使用柱面作为显示单位。在旧式的硬盘驱动器中，柱面是磁盘分区的物理单位。现代硬盘通常使用扇区作为单位，但是在某些情况下，使用柱面可能更方便，尤其是在处理旧硬件或兼容性问题时。<br>-l：这个选项告诉 fdisk 列出指定的磁盘分区的信息，而不是进入交互式模式。<br>/dev/sda：这是你要查看的磁盘设备的路径。在Linux系统中，/dev/sda 通常代表第一个SCSI或SATA硬盘驱动器。<br>执行这个命令将显示 /dev/sda 硬盘的分区表信息，包括每个分区的编号、类型、起始和结束柱面、大小等详细信息。如果硬盘上有多个分区，这些分区将被列出。<br><strong>范例：识别SSD和机械硬盘类型</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>#1表示机械，0表示SSD
</span></span><span style=display:flex><span>[root@centos8 ~]#lsblk -d -o name,rota
</span></span><span style=display:flex><span>NAME ROTA
</span></span><span style=display:flex><span>sda 1
</span></span><span style=display:flex><span>sr0 1
</span></span><span style=display:flex><span>nvme0n1 0
</span></span><span style=display:flex><span>nvme0n2 0
</span></span><span style=display:flex><span>[root@centos8 ~]#ls /sys/block/
</span></span><span style=display:flex><span>nvme0n1 nvme0n2 sda sr0
</span></span><span style=display:flex><span>[root@centos8 ~]#cat /sys/block/*/queue/rotational
</span></span><span style=display:flex><span>0
</span></span><span style=display:flex><span>0
</span></span><span style=display:flex><span>1
</span></span><span style=display:flex><span>1
</span></span><span style=display:flex><span>[root@centos8 ~]#cat /sys/block/sda/queue/rotational
</span></span><span style=display:flex><span>1
</span></span><span style=display:flex><span>[root@centos8 ~]#cat /sys/block/sr0/queue/rotational
</span></span><span style=display:flex><span>1
</span></span><span style=display:flex><span>[root@centos8 ~]#cat /sys/block/nvme0n1/queue/rotational
</span></span><span style=display:flex><span>0
</span></span><span style=display:flex><span>[root@centos8 ~]#cat /sys/block/nvme0n2/queue/rotational
</span></span><span style=display:flex><span>0
</span></span></code></pre></div><p>范例: 测速</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@ubuntu1804 ~]#dd | hdparm -t /dev/sda
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/dev/sda:
</span></span><span style=display:flex><span> Timing buffered disk reads: 148 MB in  3.14 seconds =  47.11 MB/sec
</span></span></code></pre></div><p>d 命令： dd 是一个强大的命令行工具，用于转换和复制文件，同时可以在复制过程中进行格式转换。它通常用于备份磁盘分区、制作磁盘映像、或者从设备中读取原始数据，你可以使用 dd 从一个磁盘分区创建一个镜像文件：<code>dd if=/dev/sda of=image.img bs=4M</code>if=/dev/sda 表示输入文件是 /dev/sda，of=image.img 表示输出文件是 image.img，bs=4M 表示以 4MB 的块大小进行复制。<br>hdparm 命令： hdparm 是一个用于获取和设置SATA/IDE硬盘参数的命令行工具。它常用于测试硬盘的读取速度或设置硬盘的一些性能参数。-t 选项告诉 hdparm 执行读取速度测试，/dev/sda 是要测试的硬盘设备。</p><p><strong>CHS</strong></p><ul><li>CHS采用 24 bit位寻址</li><li>其中前10位表示cylinder，中间8位表示head，后面6位表示sector</li><li>最大寻址空间 8 GB
<strong>LBA</strong>（logical block addressing）</li><li>LBA是一个整数，通过转换成 CHS 格式完成磁盘具体寻址</li><li>ATA-1规范中定义了28位寻址模式，以每扇区512位组来计算，ATA-1所定义的28位LBA上限达到
128 GiB。2002年ATA-6规范采用48位LBA，同样以每扇区512位组计算容量上限可达128Petabytes
由于CHS寻址方式的寻址空间在大概8GB以内，所以在磁盘容量小于大概8GB时，可以使用CHS寻址方
式或是LBA寻址方式；在磁盘容量大于大概8GB时，则只能使用LBA寻址方式</li></ul><h2 id=管理存储>管理存储
<a class=header-anchor href=#%e7%ae%a1%e7%90%86%e5%ad%98%e5%82%a8></a></h2><p>使用磁盘空间过程</p><ol><li>设备分区</li><li>创建文件系统</li><li>挂载新的文件系统</li></ol><h3 id=磁盘分区>磁盘分区
<a class=header-anchor href=#%e7%a3%81%e7%9b%98%e5%88%86%e5%8c%ba></a></h3><h4 id=为什么分区>为什么分区
<a class=header-anchor href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e5%88%86%e5%8c%ba></a></h4><ul><li>优化I/O性能</li><li>实现磁盘空间配额限制</li><li>提高修复速度</li><li>隔离系统和程序</li><li>安装多个OS</li><li>采用不同文件系统</li></ul><h4 id=分区方式>分区方式
<a class=header-anchor href=#%e5%88%86%e5%8c%ba%e6%96%b9%e5%bc%8f></a></h4><p>两种分区方式：MBR，GPT</p><h4 id=mbr分区>MBR分区
<a class=header-anchor href=#mbr%e5%88%86%e5%8c%ba></a></h4><p>MBR：Master Boot Record，1982年，使用32位表示扇区数，分区不超过2T<br>划分分区的单位：</p><ul><li>CentOS 5 之前按整柱面划分</li><li>CentOS 6 版本后可以按Sector划分
0磁道0扇区：512bytes<br>446bytes: boot loader 启动相关<br>64bytes：分区表，其中每16bytes标识一个分区<br>2bytes: 55AA，标识位<br>MBR分区中一块硬盘最多有4个主分区，也可以3主分区+1扩展(N个逻辑分区)<br>MBR分区：主和扩展分区对应的1&ndash;4，/dev/sda3，逻辑分区从5开始，/dev/sda5<br>MBR分区结构<br><a href=http://www.178linux.com/85121 title=MBR分区结构http://www.178linux.com/85121 rel="noopener external nofollow noreferrer" target=_blank class=exturl>MBR分区结构http://www.178linux.com/85121
<i class="fa fa-external-link-alt"></i></a></li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=/images/url/linux/linux09/09.jpg alt=2>
硬盘主引导记录MBR由4个部分组成</p><table><thead><tr><th style=text-align:center>十六进制地址范围</th><th style=text-align:center>描述</th><th style=text-align:center>分类</th></tr></thead><tbody><tr><td style=text-align:center>0000-0088</td><td style=text-align:center>Master Boot Record 主引导程序</td><td style=text-align:center>主引导程序</td></tr><tr><td style=text-align:center>0089-01BD</td><td style=text-align:center>出错信息数据区</td><td style=text-align:center>数据区</td></tr><tr><td style=text-align:center>01BE-01CD</td><td style=text-align:center>分区项1（16字节）</td><td style=text-align:center>分区表</td></tr><tr><td style=text-align:center>01CE-01DD</td><td style=text-align:center>分区项2（16字节）</td><td style=text-align:center>分区表</td></tr><tr><td style=text-align:center>01DE-01ED</td><td style=text-align:center>分区项3（16字节）</td><td style=text-align:center>分区表</td></tr><tr><td style=text-align:center>01EE-01FD</td><td style=text-align:center>分区项4（16字节）</td><td style=text-align:center>分区表</td></tr><tr><td style=text-align:center>01FE</td><td style=text-align:center>55</td><td style=text-align:center>结束标志</td></tr><tr><td style=text-align:center>01FF</td><td style=text-align:center>AA</td><td style=text-align:center>结束标志</td></tr></tbody></table><ul><li>主引导程序（偏移地址0000H&ndash;0088H），它负责从活动分区中装载，并运行系统引导程序</li><li>出错信息数据区，偏移地址0089H&ndash;00E1H为出错信息，00E2H&ndash;01BDH全为0字节</li><li>分区表（DPT,Disk Partition Table）含4个分区项，偏移地址01BEH&ndash;01FDH,每个分区表项长16个
字节，共64字节为分区项1、分区项2、分区项3、分区项4</li><li>结束标志字，偏移地址01FE&ndash;01FF的2个字节值为结束标志55AA
MBR中DPT结构<table><thead><tr><th>存储字节节位</th><th>内容及含义</th></tr></thead><tbody><tr><td>第1字节</td><td>引导标志。若值为80H表示活动分区，若值为00H表示非活动分区。</td></tr><tr><td>第2、3、4字节</td><td>本分区的起始磁头号、扇区号、柱面号。<br>磁头号——第2字节；<br>扇区号——第3字节的低6位；<br>柱面号——为第3字节高2位+第4字节8位。</td></tr><tr><td>第5字节</td><td>分区类型符。<br>00H——表示该分区未用（即没有指定）；<br>06H——FAT16基本分区；<br>0BH——FAT32基本分区；<br>05H——扩展分区；<br>07H——NTFS分区；<br>0FH——（LBA模式）扩展分区（83H为Linux分区等）。</td></tr><tr><td>第6、7、8字节</td><td>本分区的结束磁头号、扇区号、柱面号。<br>磁头号——第6字节； 扇区号——第7字节的低6位；<br>柱面号——为第7字节高2位+第8字节8位。</td></tr><tr><td>第9、10、11、12字节</td><td>本分区之前已用了的扇区数，</td></tr><tr><td>第13、14、15、16字节</td><td>本分区的总扇区数</td></tr></tbody></table></li></ul><p>范例: 备份MBR的分区表,并破坏后恢复</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>#备份MBR分区表
</span></span><span style=display:flex><span>[root@centos8 ~]#dd if=/dev/sda of=/data/dpt.img bs=1 count=64 skip=446
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dd：命令名，用于数据复制和转换。
</span></span><span style=display:flex><span>if=/dev/sda：if 代表 input file，这里指定输入文件为 /dev/sda，即第一个SCSI或SATA硬盘。
</span></span><span style=display:flex><span>of=/data/dpt.img：of 代表 output file，这里指定输出文件为 /data/dpt.img，即将数据写入到这个文件中。
</span></span><span style=display:flex><span>bs=1：bs 代表 block size，这里指定块大小为 1 字节。
</span></span><span style=display:flex><span>count=64：count 代表要复制的块数，这里指定复制 64 块。
</span></span><span style=display:flex><span>skip=446：skip 代表在开始复制之前要跳过的块数，这里指定跳过 446 块。
</span></span><span style=display:flex><span>这个命令的作用是从 /dev/sda 硬盘的第 447 块（因为计数是从 0 开始的）开始，复制下一个 64 块（每个块大小为 1 字节）的数据到 /data/dpt.img 文件中。这种操作通常用于复制磁盘上的特定数据，例如磁盘的引导记录或分区表。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#scp /data/dpt.img 10.0.0.102:
</span></span><span style=display:flex><span>scp（secure copy）是一个用于在网络上在不同主机之间安全地复制文件的命令。它使用SSH协议进行加密传输，确保数据的安全。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#破坏MBR分区表
</span></span><span style=display:flex><span>[root@centos8 ~]#dd if=/dev/zero of=/dev/sda bs=1 count=64 seek=446
</span></span><span style=display:flex><span>dd：命令名，用于数据复制和转换。
</span></span><span style=display:flex><span>if=/dev/zero：if 代表 input file，这里指定输入文件为 /dev/zero，这是一个特殊的设备文件，它会不断返回空字符（即 ASCII 码的 0）。
</span></span><span style=display:flex><span>of=/dev/sda：of 代表 output file，这里指定输出文件为 /dev/sda，即第一个SCSI或SATA硬盘。
</span></span><span style=display:flex><span>bs=1：bs 代表 block size，这里指定块大小为 1 字节。
</span></span><span style=display:flex><span>count=64：count 代表要复制的块数，这里指定复制 64 块。
</span></span><span style=display:flex><span>seek=446：seek 代表在开始写入之前要跳过的块数，这里指定跳过 446 块。
</span></span><span style=display:flex><span>这个命令的作用是从 /dev/zero 读取 64 个字节的空字符，然后将这些字符写入到 /dev/sda 硬盘的第 447 块（因为计数是从 0 开始的）开始的 64 个块中。这种操作通常用于清零磁盘上的特定数据，例如磁盘的引导记录或分区表。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#无法启动
</span></span><span style=display:flex><span>[root@centos8 ~]#reboot
</span></span><span style=display:flex><span>#用光盘启动,进入rescue mode,选第3项skip to shell    Rescue a Rocky Linux system
</span></span><span style=display:flex><span>#配置网络
</span></span><span style=display:flex><span>#ifconfig ens160 10.0.0.8/24
</span></span><span style=display:flex><span>#ip a a 10.0.0.8/24 dev ens160
</span></span><span style=display:flex><span>#scp 10.0.0.102:/root/dpt.img .
</span></span><span style=display:flex><span>#恢复MBR分区表
</span></span><span style=display:flex><span>#dd if=dpt.img of=/dev/sda bs=1 seek=446
</span></span><span style=display:flex><span>#reboot
</span></span></code></pre></div><p>问题：利用分区策略相同的另一台主机的分区表来还原和恢复当前主机破环的分区表？</p><h4 id=gpt分区>GPT分区
<a class=header-anchor href=#gpt%e5%88%86%e5%8c%ba></a></h4><p>GPT：GUID（Globals Unique Identifiers） partition table 支持128个分区，使用64位，支持8Z（
512Byte/block ）64Z （ 4096Byte/block）<br>使用128位UUID(Universally Unique Identifier) 表示磁盘和分区 GPT分区表自动备份在头和尾两份，
并有CRC校验位<br>UEFI (Unified Extensible Firmware Interface 统一可扩展固件接口)硬件支持GPT，使得操作系统可以
启动<br><strong>GPT分区结构</strong>
<img src=/imgs/img-lazy-loading.gif data-src=/images/url/linux/linux09/06.jpg alt>
GPT分区结构分为4个区域：</p><ul><li>GPT头</li><li>分区表</li><li>GPT分区</li><li>备份区域</li></ul><h4 id=bios和uefi>BIOS和UEFI
<a class=header-anchor href=#bios%e5%92%8cuefi></a></h4><p>BIOS是固化在电脑主板上的程序，主要用于开机系统自检和引导操作系统。目前新式的电脑基本上都是
UEFI启动<br>BIOS（Basic Input Output System 基本输入输出系统）主要完成系统硬件自检和引导操作系统，操作
系统开始启动之后，BIOS的任务就完成了。系统硬件自检：如果系统硬件有故障，主板上的扬声器就会
发出长短不同的“滴滴”音，可以简单的判断硬件故障，比如“1长1短”通常表示内存故障，“1长3短”通常
表示显卡故障<br>BIOS在1975年就诞生了，使用汇编语言编写，当初只有16位，因此只能访问1M的内存，其中前640K
称为基本内存，后384K内存留给开机和各类BIOS本身使用。BIOS只能识别到主引导记录（MBR）初始
化的硬盘，最大支持2T的硬盘，4个主分区（逻辑分区中的扩展分区除外），而目前普遍实现了64位系
统，传统的BIOS已经无法满足需求了，这时英特尔主导的EFI就诞生了<br>EFI（Extensible Firmware Interface）可扩展固件接口，是 Intel 为 PC 固件的体系结构、接口和服务
提出的建议标准。其主要目的是为了提供一组在 OS 加载之前（启动前）在所有平台上一致的、正确指
定的启动服务，被看做是BIOS 的继任者，或者理解为新版BIOS。<br>UEFI是由EFI1.10为基础发展起来的，它的所有者已不再是Intel，而是一个称作Unified EFI Form的国际
组织<br>UEFI(Unified Extensible Firmware Interface)统一的可扩展固件接口， 是一种详细描述类型接口的标
准。UEFI 相当于一个轻量化的操作系统，提供了硬件和操作系统之间的一个接口，提供了图形化的操
作界面。最关键的是引入了GPT分区表，支持2T以上的硬盘，硬盘分区不受限制<br>BIOS和UEFI区别<br>BIOS采用了16位汇编语言编写，只能运行在实模式（内存寻址方式由16位段寄存器的内容乘以16(10H)
当做段基地址，加上16位偏移地址形成20位的物理地址）下，可访问的内存空间为1MB，只支持字符
操作界面<br>UEFI采用32位或者64位的C语言编写，突破了实模式的限制，可以达到最大的寻址空间，支持图形操作
界面，使用文件方式保存信息，支持GPT分区启动，适合和较新的系统和硬件的配合使用<br><img src=/imgs/img-lazy-loading.gif data-src=/images/url/linux/linux09/06.jpg alt></p><h3 id=管理分区>管理分区
<a class=header-anchor href=#%e7%ae%a1%e7%90%86%e5%88%86%e5%8c%ba></a></h3><p>列出块设备</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>lsblk
</span></span></code></pre></div><p>创建分区命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>fdisk 管理MBR分区
</span></span><span style=display:flex><span>gdisk 管理GPT分区
</span></span><span style=display:flex><span>parted 高级分区操作，可以是交互或非交互方式
</span></span></code></pre></div><p>重新设置内存中的内核分区表版本，适合于除了CentOS 6 以外的其它版本 5，7，</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>partprobe
</span></span></code></pre></div><h4 id=parted-命令>parted 命令
<a class=header-anchor href=#parted-%e5%91%bd%e4%bb%a4></a></h4><p><strong><u>注意：parted的操作都是实时生效的，小心使用</u></strong><br>格式：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>parted [选项]... [设备 [命令 [参数]...]...]
</span></span></code></pre></div><p>parted 是一个功能强大的磁盘分区和分区表管理工具，它支持多种分区表类型，包括传统的 MBR（Master Boot Record）和现代的 GPT（GUID Partition Table）。以下是一些 parted 命令的常见选项：
帮助选项：</p><p>-h, &ndash;help 显示此求助信息<br>-l, &ndash;list 列出所有设别的分区信息<br>-i, &ndash;interactive 在必要时，提示用户<br>-s, &ndash;script 从不提示用户<br>-v, &ndash;version 显示版本</p><ol><li><p><strong>print</strong>：显示磁盘的分区表和分区信息。</p><ul><li><code>parted /dev/sdb print</code>：打印 /dev/sdb 硬盘的分区信息。</li></ul></li><li><p><strong>mklabel</strong>：创建一个新的分区表。</p><ul><li><code>parted /dev/sdb mklabel gpt</code>：在 /dev/sdb 硬盘上创建一个新的 GPT 分区表。</li></ul></li><li><p><strong>mkpart</strong>：创建一个新的分区。</p><ul><li><code>parted /dev/sdb mkpart primary ext4 1MB 2GB</code>：在 /dev/sdb 硬盘上从 1MB 开始创建一个 2GB 大小的主分区，并使用 ext4 文件系统。</li></ul></li><li><p><strong>rm</strong>：删除一个分区。</p><ul><li><code>parted /dev/sdb rm 1</code>：删除 /dev/sdb 硬盘上的第一个分区。</li></ul></li><li><p><strong>resizepart</strong>：调整一个分区的大小。</p><ul><li><code>parted /dev/sdb resizepart 2 5GB</code>：将 /dev/sdb 硬盘上的第二个分区大小调整为 5GB。
resize：这个命令通常用于调整文件系统的大小。在你调整了分区大小之后，可能需要调整文件系统
以适应新的分区大小。resize 命令不是 parted 的直接命令，而是特定于文件系统的工具的一部分。
例如，如果你使用的是 ext2/ext3/ext4 文件系统，你可能需要使用 resize2fs 命令来调整文件系统的大小。</li></ul></li><li><p><strong>set</strong>：设置分区标志。</p><ul><li><code>parted /dev/sdb set 1 boot on</code>：将 /dev/sdb 硬盘上的第一个分区设置为可引导。</li></ul></li><li><p><strong>unit</strong>：设置默认的单位（例如，MB、GB、%）。</p><ul><li><code>parted /dev/sdb unit GB</code>：设置默认单位为 GB。</li></ul></li><li><p><strong>align</strong>：设置分区对齐方式。</p><ul><li><code>parted /dev/sdb align optimal</code>：设置分区对齐方式为最优。</li></ul></li><li><p><strong>name</strong>：给分区命名。</p><ul><li><code>parted /dev/sdb name 1 MyPartition</code>：将 /dev/sdb 硬盘上的第一个分区命名为 &ldquo;MyPartition&rdquo;。</li></ul></li><li><p><strong>quit</strong>：退出 parted 交互式模式。
补充：
cp [FROM-DEVICE] FROM-MINOR TO-MINOR #将文件系统复制到另一个分区<br>help [COMMAND] #打印通用求助信息，或关于 COMMAND 的信息<br>move MINOR 起始点 终止点 #移动编号为 MINOR 的分区<br>rescue 起始点 终止点 #挽救临近“起始点”、“终止点”的遗失的分区<br>select 设备 #选择要编辑的设备</p></li></ol><p>请注意，使用 parted 对磁盘进行操作可能会损坏数据，因此在执行任何分区操作之前，务必确保备份重要数据。此外，对磁盘进行操作通常需要管理员权限（root）。</p><p>范例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>parted /dev/sdb mklabel gpt|msdos
</span></span><span style=display:flex><span>parted /dev/sdb print
</span></span><span style=display:flex><span>parted /dev/sdb mkpart primary 1 200 （默认M）
</span></span><span style=display:flex><span>parted /dev/sdb rm 1
</span></span><span style=display:flex><span>parted -l 列出所有硬盘分区信息
</span></span></code></pre></div><p>范例:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb print
</span></span><span style=display:flex><span>Error: /dev/sdb: unrecognised disk label
</span></span><span style=display:flex><span>Model: VMware, VMware Virtual S (scsi)
</span></span><span style=display:flex><span>Disk /dev/sdb: 21.5GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: unknown
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>parted：命令名，用于磁盘分区和管理。
</span></span><span style=display:flex><span>/dev/sdb：指定要操作的磁盘设备，这里是指第二个SCSI或SATA硬盘。
</span></span><span style=display:flex><span>print：打印磁盘的分区表信息。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb mklabel gpt  mklabel gpt  创建一个 GPT（GUID Partition Table）分区表。
</span></span><span style=display:flex><span>Information: You may need to update /etc/fstab.
</span></span><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb print
</span></span><span style=display:flex><span>Model: VMware, VMware Virtual S (scsi)
</span></span><span style=display:flex><span>Disk /dev/sdb: 21.5GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: gpt
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Number Start End Size File system Name Flags
</span></span><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb mkpart primary 1 1001
</span></span><span style=display:flex><span>Information: You may need to update /etc/fstab.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb print
</span></span><span style=display:flex><span>Model: VMware, VMware Virtual S (scsi)
</span></span><span style=display:flex><span>Disk /dev/sdb: 21.5GB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: gpt
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Number Start End Size File system Name Flags
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1 1049kB 1001MB 1000MB primary
</span></span><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb mkpart primary 1002 1102
</span></span><span style=display:flex><span>Information: You may need to update /etc/fstab.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb print
</span></span><span style=display:flex><span>Model: VMware, VMware Virtual S (scsi)
</span></span><span style=display:flex><span>Disk /dev/sdb: 21.5GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: gpt
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Number Start End Size File system Name Flags
</span></span><span style=display:flex><span>1 1049kB 1001MB 1000MB primary
</span></span><span style=display:flex><span>2 1002MB 1102MB 99.6MB primary
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb rm 2
</span></span><span style=display:flex><span>Information: You may need to update /etc/fstab.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb print
</span></span><span style=display:flex><span>Model: VMware, VMware Virtual S (scsi)
</span></span><span style=display:flex><span>Disk /dev/sdb: 21.5GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: gpt
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Number Start End Size File system Name Flags
</span></span><span style=display:flex><span>1 1049kB 1001MB 1000MB primary
</span></span><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb mklabel msdos
</span></span><span style=display:flex><span>Warning: The existing disk label on /dev/sdb will be destroyed and all data on
</span></span><span style=display:flex><span>this disk will be lost. Do you want to continue?
</span></span><span style=display:flex><span>Yes/No? Y
</span></span><span style=display:flex><span>Information: You may need to update /etc/fstab.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb print
</span></span><span style=display:flex><span>Model: VMware, VMware Virtual S (scsi)
</span></span><span style=display:flex><span>Disk /dev/sdb: 21.5GB
</span></span><span style=display:flex><span>Sector size (logical/physical): 512B/512B
</span></span><span style=display:flex><span>Partition Table: msdos
</span></span><span style=display:flex><span>Disk Flags:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Number Start End Size Type File system Flags
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#parted /dev/sdb   执行这个命令将启动 parted 的交互式模式，
</span></span><span style=display:flex><span>允许你直接在 parted 命令行界面中输入命令来管理 /dev/sdb 硬盘。在交互式模式下，
</span></span><span style=display:flex><span>你可以执行各种操作，如创建、删除、调整分区大小，以及修改分区表类型等
</span></span><span style=display:flex><span>GNU Parted 3.2
</span></span><span style=display:flex><span>Using /dev/sdb
</span></span><span style=display:flex><span>Welcome to GNU Parted! Type &#39;help&#39; to view a list of commands.
</span></span><span style=display:flex><span>(parted) help
</span></span><span style=display:flex><span>    align-check TYPE N check partition N for TYPE(min|opt)
</span></span><span style=display:flex><span>alignment
</span></span><span style=display:flex><span>    help [COMMAND] print general help, or help on
</span></span><span style=display:flex><span>COMMAND
</span></span><span style=display:flex><span>    mklabel,mktable LABEL-TYPE create a new disklabel (partition
</span></span><span style=display:flex><span>table)
</span></span><span style=display:flex><span>    mkpart PART-TYPE [FS-TYPE] START END make a partition
</span></span><span style=display:flex><span>    name NUMBER NAME name partition NUMBER as NAME
</span></span><span style=display:flex><span>    print [devices|free|list,all|NUMBER] display the partition table,
</span></span><span style=display:flex><span>available devices, free space, all found partitions, or a particular partition
</span></span><span style=display:flex><span>    quit exit program
</span></span><span style=display:flex><span>    rescue START END rescue a lost partition near START
</span></span><span style=display:flex><span>and END
</span></span><span style=display:flex><span>    resizepart NUMBER END resize partition NUMBER
</span></span><span style=display:flex><span>    rm NUMBER delete partition NUMBER
</span></span><span style=display:flex><span>    select DEVICE choose the device to edit
</span></span><span style=display:flex><span>    disk_set FLAG STATE change the FLAG on selected device
</span></span><span style=display:flex><span>    disk_toggle [FLAG] toggle the state of FLAG on selected
</span></span><span style=display:flex><span>device
</span></span><span style=display:flex><span>    set NUMBER FLAG STATE change the FLAG on partition NUMBER
</span></span><span style=display:flex><span>    toggle [NUMBER [FLAG]] toggle the state of FLAG on partition
</span></span><span style=display:flex><span>NUMBER
</span></span><span style=display:flex><span>    unit UNIT set the default unit to UNIT
</span></span><span style=display:flex><span>    version display the version number and
</span></span><span style=display:flex><span>copyright information of GNU Parted
</span></span><span style=display:flex><span>(parted)
</span></span></code></pre></div><h4 id=分区工具fdisk和gdisk><strong>分区工具fdisk和gdisk</strong>
<a class=header-anchor href=#%e5%88%86%e5%8c%ba%e5%b7%a5%e5%85%b7fdisk%e5%92%8cgdisk></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>fdisk -l [-u] [device...] 查看分区
</span></span><span style=display:flex><span>fdisk [device...] 管理MBR分区
</span></span><span style=display:flex><span>gdisk [device...] 类fdisk 的GPT分区工具
</span></span></code></pre></div><p>子命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>p 分区列表
</span></span><span style=display:flex><span>t 更改分区类型
</span></span><span style=display:flex><span>n 创建新分区
</span></span><span style=display:flex><span>d 删除分区
</span></span><span style=display:flex><span>v 校验分区
</span></span><span style=display:flex><span>u 转换单位
</span></span><span style=display:flex><span>w 保存并退出
</span></span><span style=display:flex><span>q 不保存并退出
</span></span><span style=display:flex><span>l 列出所有可用的分区类型
</span></span><span style=display:flex><span>device 指定要操作的磁盘设备
</span></span></code></pre></div><p>查看内核是否已经识别新的分区</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>cat /proc/partitions
</span></span></code></pre></div><p><strong>CentOS 7,8 同步分区表:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>partprobe
</span></span></code></pre></div><p>CentOS6 通知内核重新读取硬盘分区表</p><p>新增分区用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>partx -a /dev/DEVICE
</span></span><span style=display:flex><span>kpartx -a /dev/DEVICE -f: force
</span></span><span style=display:flex><span>#示例：
</span></span><span style=display:flex><span>[root@centos6 ~]#partx -a /dev/sda
</span></span></code></pre></div><p>删除分区用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>partx -d --nr M-N /dev/DEVICE
</span></span><span style=display:flex><span>#示例：
</span></span><span style=display:flex><span>[root@centos6 ~]#partx -d --nr 6-8 /dev/sda
</span></span></code></pre></div><p>范例:非交互式创建分区</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>echo -e &#39;n\np\n\n\n+2G\nw\n&#39; | fdisk /dev/sdc
</span></span></code></pre></div><p>范例:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>#增加了6,7分区
</span></span><span style=display:flex><span>[root@centos6 ~]#fdisk /dev/sda
</span></span><span style=display:flex><span>Command (m for help): w
</span></span><span style=display:flex><span>The partition table has been altered!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Calling ioctl() to re-read partition table.
</span></span><span style=display:flex><span>WARNING: Re-reading the partition table failed with error 16: Device or resource
</span></span><span style=display:flex><span>busy.
</span></span><span style=display:flex><span>The kernel still uses the old table. The new table will be used at
</span></span><span style=display:flex><span>the next reboot or after you run partprobe(8) or kpartx(8)
</span></span><span style=display:flex><span>Syncing disks.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#分区表不同步
</span></span><span style=display:flex><span>[root@centos6 ~]#lsblk
</span></span><span style=display:flex><span>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
</span></span><span style=display:flex><span>sr0 11:0 1 3.7G 0 rom
</span></span><span style=display:flex><span>sda 8:0 0 200G 0 disk
</span></span><span style=display:flex><span>├─sda1 8:1 0 1G 0 part /boot
</span></span><span style=display:flex><span>├─sda2 8:2 0 97.7G 0 part /
</span></span><span style=display:flex><span>├─sda3 8:3 0 48.8G 0 part /data
</span></span><span style=display:flex><span>├─sda4 8:4 0 1K 0 part
</span></span><span style=display:flex><span>└─sda5 8:5 0 2G 0 part [SWAP]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#同步分区表
</span></span><span style=display:flex><span>[root@centos6 ~]#partx -a /dev/sda
</span></span><span style=display:flex><span>BLKPG: Device or resource busy
</span></span><span style=display:flex><span>error adding partition 1
</span></span><span style=display:flex><span>BLKPG: Device or resource busy
</span></span><span style=display:flex><span>error adding partition 2
</span></span><span style=display:flex><span>BLKPG: Device or resource busy
</span></span><span style=display:flex><span>error adding partition 3
</span></span><span style=display:flex><span>BLKPG: Device or resource busy
</span></span><span style=display:flex><span>error adding partition 4
</span></span><span style=display:flex><span>BLKPG: Device or resource busy
</span></span><span style=display:flex><span>error adding partition 5
</span></span><span style=display:flex><span>[root@centos6 ~]#lsblk
</span></span><span style=display:flex><span>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
</span></span><span style=display:flex><span>sr0 11:0 1 3.7G 0 rom
</span></span><span style=display:flex><span>sda 8:0 0 200G 0 disk
</span></span><span style=display:flex><span>├─sda1 8:1 0 1G 0 part /boot
</span></span><span style=display:flex><span>├─sda2 8:2 0 97.7G 0 part /
</span></span><span style=display:flex><span>├─sda3 8:3 0 48.8G 0 part /data
</span></span><span style=display:flex><span>├─sda4 8:4 0 1K 0 part
</span></span><span style=display:flex><span>├─sda5 8:5 0 2G 0 part [SWAP]
</span></span><span style=display:flex><span>├─sda6 8:6 0 2G 0 part
</span></span><span style=display:flex><span>└─sda7 8:7 0 3G 0 part
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#删除了6,7分区
</span></span><span style=display:flex><span>[root@centos6 ~]#fdisk /dev/sda
</span></span><span style=display:flex><span>Command (m for help): w
</span></span><span style=display:flex><span>The partition table has been altered!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Calling ioctl() to re-read partition table.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WARNING: Re-reading the partition table failed with error 16: Device or resource
</span></span><span style=display:flex><span>busy.
</span></span><span style=display:flex><span>The kernel still uses the old table. The new table will be used at
</span></span><span style=display:flex><span>the next reboot or after you run partprobe(8) or kpartx(8)
</span></span><span style=display:flex><span>Syncing disks.
</span></span><span style=display:flex><span>[root@centos6 ~]#
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos6 ~]#lsblk
</span></span><span style=display:flex><span>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
</span></span><span style=display:flex><span>sr0 11:0 1 3.7G 0 rom
</span></span><span style=display:flex><span>sda 8:0 0 200G 0 disk
</span></span><span style=display:flex><span>├─sda1 8:1 0 1G 0 part /boot
</span></span><span style=display:flex><span>├─sda2 8:2 0 97.7G 0 part /
</span></span><span style=display:flex><span>├─sda3 8:3 0 48.8G 0 part /data
</span></span><span style=display:flex><span>├─sda4 8:4 0 1K 0 part
</span></span><span style=display:flex><span>├─sda5 8:5 0 2G 0 part [SWAP]
</span></span><span style=display:flex><span>├─sda6 8:6 0 2G 0 part
</span></span><span style=display:flex><span>└─sda7 8:7 0 3G 0 part
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#同步分区表
</span></span><span style=display:flex><span>[root@centos6 ~]#partx -d --nr 6-7 /dev/sda
</span></span><span style=display:flex><span>[root@centos6 ~]#lsblk
</span></span><span style=display:flex><span>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
</span></span><span style=display:flex><span>sr0 11:0 1 3.7G 0 rom
</span></span><span style=display:flex><span>sda 8:0 0 200G 0 disk
</span></span><span style=display:flex><span>├─sda1 8:1 0 1G 0 part /boot
</span></span><span style=display:flex><span>├─sda2 8:2 0 97.7G 0 part /
</span></span><span style=display:flex><span>├─sda3 8:3 0 48.8G 0 part /data
</span></span><span style=display:flex><span>├─sda4 8:4 0 1K 0 part
</span></span><span style=display:flex><span>└─sda5 8:5 0 2G 0 part [SWAP]
</span></span></code></pre></div><p>范例: 批量创建分区</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#echo -e &#39;n\np\n\n\n+1G\nw&#39; | fdisk /dev/sdb
</span></span><span style=display:flex><span>[root@centos8 ~]#fdisk /dev/sdb &lt;&lt;EOF
</span></span><span style=display:flex><span>n
</span></span><span style=display:flex><span>p
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+1G
</span></span><span style=display:flex><span>w
</span></span><span style=display:flex><span>EOF
</span></span><span style=display:flex><span>[root@centos8 ~]#lsblk /dev/sdb
</span></span><span style=display:flex><span>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
</span></span><span style=display:flex><span>sdb 8:16 0 20G 0 disk
</span></span><span style=display:flex><span>├─sdb1 8:17 0 1G 0 part
</span></span><span style=display:flex><span>└─sdb2 8:18 0 1G 0 part
</span></span></code></pre></div><h2 id=文件系统>文件系统
<a class=header-anchor href=#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f></a></h2><h3 id=文件系统概念>文件系统概念
<a class=header-anchor href=#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e6%a6%82%e5%bf%b5></a></h3><p>文件系统是操作系统用于明确存储设备或分区上的文件的方法和数据结构；即在存储设备上组织文件的
方法。操作系统中负责管理和存储文件信息的软件结构称为文件管理系统，简称文件系统
从系统角度来看，文件系统是对文件存储设备的空间进行组织和分配，负责文件存储并对存入的文件进
行保护和检索的系统。具体地说，它负责为用户建立文件，存入、读出、修改、转储文件，控制文件的
存取，安全控制，日志，压缩，加密等<br>支持的文件系统</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>/lib/modules/`uname -r`/kernel/fs
</span></span></code></pre></div><p><a href=%e5%90%84%e7%a7%8d%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%ef%bc%9ahttps://en.wikipedia.org/wiki/Comparison_of_file_systems title=各种文件系统：https://en.wikipedia.org/wiki/Comparison_of_file_systems>各种文件系统：https://en.wikipedia.org/wiki/Comparison_of_file_systems</a><br>帮助：man 5 fs</p><h3 id=文件系统类型>文件系统类型
<a class=header-anchor href=#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%b1%bb%e5%9e%8b></a></h3><p><strong>Linux 常用文件系统</strong></p><ul><li>ext2：Extended file system 适用于那些分区容量不是太大，更新也不频繁的情况，例如 /boot 分
区</li><li>ext3：是 ext2 的改进版本，其支持日志功能，能够帮助系统从非正常关机导致的异常中恢复</li><li>ext4：是 ext 文件系统的最新版。提供了很多新的特性，包括纳秒级时间戳、创建和使用巨型文件
(16TB)、最大1EB的文件系统，以及速度的提升</li><li>xfs：SGI，支持最大8EB的文件系统</li><li>swap</li><li>iso9660 光盘</li><li>btrfs（Oracle）</li><li>reiserfs
Windows 常用文件系统</li><li>FAT32</li><li>NTFS</li><li>exFAT
Unix：</li><li>FFS（fast）</li><li>UFS（unix）</li><li>JFS2</li></ul><p>网络文件系统：</p><ul><li>NFS</li><li>CIFS
集群文件系统：</li><li>GFS2</li><li>OCFS2（oracle）
分布式文件系统：</li><li>fastdfs</li><li>ceph</li><li>moosefs</li><li>mogilefs</li><li>glusterfs</li><li>Lustre
RAW：</li><li>裸文件系统,未经处理或者未经格式化产生的文件系统</li><li>常用的文件系统特性：
FAT32</li><li>最多只能支持16TB的文件系统和4GB的文件
NTFS</li><li>最多只能支持16EB的文件系统和16EB的文件
EXT3</li><li>最多只能支持32TB的文件系统和2TB的文件，实际只能容纳2TB的文件系统和16GB的文件</li><li>Ext3目前只支持32000个子目录</li><li>Ext3文件系统使用32位空间记录块数量和 inode数量</li><li>当数据写入到Ext3文件系统中时，Ext3的数据块分配器每次只能分配一个4KB的块
EXT4：</li><li>EXT4是Linux系统下的日志文件系统，是EXT3文件系统的后继版本</li><li>Ext4的文件系统容量达到1EB，而支持单个文件则达到16TB</li><li>理论上支持无限数量的子目录</li><li>Ext4文件系统使用64位空间记录块数量和 inode数量</li><li>Ext4的多块分配器支持一次调用分配多个数据块</li><li>修复速度更快
XFS</li><li>根据所记录的日志在很短的时间内迅速恢复磁盘文件内容</li><li>用优化算法，日志记录对整体文件操作影响非常小</li><li>是一个全64-bit的文件系统，最大可以支持8EB的文件系统，而支持单个文件则达到8EB</li><li>能以接近裸设备I/O的性能存储数据
<strong>查前支持的文件系统：</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>cat /proc/filesystems
</span></span></code></pre></div><h3 id=文件系统的组成部分>文件系统的组成部分
<a class=header-anchor href=#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%9a%84%e7%bb%84%e6%88%90%e9%83%a8%e5%88%86></a></h3><ul><li>内核中的模块：ext4, xfs, vfat</li><li>Linux的虚拟文件系统：VFS</li><li>用户空间的管理工具：mkfs.ext4, mkfs.xfs,mkfs.vfat</li></ul><h4 id=创建文件系统>创建文件系统
<a class=header-anchor href=#%e5%88%9b%e5%bb%ba%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f></a></h4><p>创建文件管理工具</p><ul><li>mkfs命令：<br>(1) mkfs.FS_TYPE /dev/DEVICE<br>ext4<br>xfs<br>btrfs<br>vfat
(2) mkfs -t FS_TYPE /dev/DEVICE<br>-L &lsquo;LABEL&rsquo; 设定卷标</li><li>mke2fs：ext系列文件系统专用管理工具
常用选项</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>-t {ext2|ext3|ext4|xfs} 指定文件系统类型
</span></span><span style=display:flex><span>-b {1024|2048|4096} 指定块 block 大小
</span></span><span style=display:flex><span>-L ‘LABEL’ 设置卷标
</span></span><span style=display:flex><span>-j 相当于 -t ext3， mkfs.ext3 = mkfs -t ext3 = mke2fs -j = mke2fs -t ext3
</span></span><span style=display:flex><span>-i # 为数据空间中每多少个字节创建一个inode；不应该小于block大
</span></span><span style=display:flex><span>小
</span></span><span style=display:flex><span>-N # 指定分区中创建多少个inode
</span></span><span style=display:flex><span>-I 一个inode记录占用的磁盘空间大小，128---4096
</span></span><span style=display:flex><span>-m # 默认5%,为管理人员预留空间占总空间的百分比
</span></span><span style=display:flex><span>-O FEATURE[,...] 启用指定特性
</span></span><span style=display:flex><span>-O ^FEATURE 关闭指定特性
</span></span></code></pre></div><p>范例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>mkfs.ext4 /dev/sdb1 
</span></span></code></pre></div><h4 id=查看和管理分区信息>查看和管理分区信息
<a class=header-anchor href=#%e6%9f%a5%e7%9c%8b%e5%92%8c%e7%ae%a1%e7%90%86%e5%88%86%e5%8c%ba%e4%bf%a1%e6%81%af></a></h4><p>blkid 可以查看块设备属性信息<br>格式：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>blkid [OPTION]... [DEVICE]
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>blkid /dev/sdb1  查看文件系统是否创建成功
</span></span></code></pre></div><p>常用选项：<br>-U UUID 根据指定的UUID来查找对应的设备<br>-L LABEL 根据指定的LABEL来查找对应的设备<br>e2label：管理ext系列文件系统的LABEL</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>e2label DEVICE [LABEL]
</span></span></code></pre></div><p>findfs ：查找分区</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>findfs [options] LABEL=&lt;label&gt;
</span></span><span style=display:flex><span>findfs [options] UUID=&lt;uuid&gt;
</span></span></code></pre></div><p>范例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#findfs UUID=f7f53add-b184-4ddc-8d2c-5263b84d1e15
</span></span><span style=display:flex><span>/dev/sda2
</span></span></code></pre></div><p>范例:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#findfs `sed -En &#39;/data/s#^([^ ]+).*#\1#p&#39; /etc/fstab`
</span></span><span style=display:flex><span>/dev/sda3
</span></span></code></pre></div><p>tune2fs：重新设定ext系列文件系统可调整参数的值</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>-l 查看指定文件系统超级块信息；super block
</span></span><span style=display:flex><span>-L &#39;LABEL’ 修改卷标
</span></span><span style=display:flex><span>-m # 修预留给管理员的空间百分比
</span></span><span style=display:flex><span>-j 将ext2升级为ext3
</span></span><span style=display:flex><span>-O 文件系统属性启用或禁用, -O ^has_journal
</span></span><span style=display:flex><span>-o 调整文件系统的默认挂载选项，-o ^acl
</span></span><span style=display:flex><span>-U UUID 修改UUID号
</span></span></code></pre></div><p>dumpe2fs：显示ext文件系统信息，将磁盘块分组管理<br>-h：查看超级块信息，不显示分组信息<br>范例：查看ext文件系统的元数据和块组信息</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#dumpe2fs /dev/sda1
</span></span><span style=display:flex><span>dumpe2fs 1.44.6 (5-Mar-2019)
</span></span><span style=display:flex><span>Filesystem volume name: &lt;none&gt;
</span></span><span style=display:flex><span>Last mounted on: /boot
</span></span><span style=display:flex><span>Filesystem UUID: 5c2216e3-ae34-444e-aa60-83cbaebb47e7
</span></span><span style=display:flex><span>Filesystem magic number: 0xEF53
</span></span><span style=display:flex><span>Filesystem revision #: 1 (dynamic)
</span></span><span style=display:flex><span>Filesystem features: has_journal ext_attr resize_inode dir_index filetype
</span></span><span style=display:flex><span>needs_recovery extent 64bit flex_bg sparse_super large_file huge_file dir_nlink
</span></span><span style=display:flex><span>extra_isize metadata_csum
</span></span><span style=display:flex><span>Filesystem flags: signed_directory_hash
</span></span><span style=display:flex><span>Default mount options: user_xattr acl
</span></span><span style=display:flex><span>Filesystem state: clean
</span></span><span style=display:flex><span>Errors behavior: Continue
</span></span><span style=display:flex><span>Filesystem OS type: Linux
</span></span><span style=display:flex><span>Inode count: 65536
</span></span><span style=display:flex><span>Block count: 262144
</span></span><span style=display:flex><span>Reserved block count: 13107
</span></span><span style=display:flex><span>Free blocks: 217118
</span></span><span style=display:flex><span>Free inodes: 65227
</span></span><span style=display:flex><span>First block: 0
</span></span><span style=display:flex><span>Block size: 4096
</span></span><span style=display:flex><span>Fragment size: 4096
</span></span><span style=display:flex><span>Group descriptor size: 64
</span></span><span style=display:flex><span>Reserved GDT blocks: 127
</span></span><span style=display:flex><span>Blocks per group: 32768
</span></span><span style=display:flex><span>Fragments per group: 32768
</span></span><span style=display:flex><span>Inodes per group: 8192
</span></span><span style=display:flex><span>Inode blocks per group: 512
</span></span><span style=display:flex><span>Flex block group size: 16
</span></span><span style=display:flex><span>Filesystem created: Thu Jan 16 10:39:10 2020
</span></span><span style=display:flex><span>Last mount time: Mon Apr 13 12:03:10 2020
</span></span><span style=display:flex><span>Last write time: Mon Apr 13 12:03:10 2020
</span></span><span style=display:flex><span>Mount count: 6
</span></span><span style=display:flex><span>Maximum mount count: -1
</span></span><span style=display:flex><span>Last checked: Thu Jan 16 10:39:10 2020
</span></span><span style=display:flex><span>Check interval: 0 (&lt;none&gt;)
</span></span><span style=display:flex><span>Lifetime writes: 236 MB
</span></span><span style=display:flex><span>Reserved blocks uid: 0 (user root)
</span></span><span style=display:flex><span>Reserved blocks gid: 0 (group root)
</span></span><span style=display:flex><span>First inode: 11
</span></span><span style=display:flex><span>Inode size: 256
</span></span><span style=display:flex><span>Required extra isize: 32
</span></span><span style=display:flex><span>Desired extra isize: 32
</span></span><span style=display:flex><span>Journal inode: 8
</span></span><span style=display:flex><span>Default directory hash: half_md4
</span></span><span style=display:flex><span>Directory Hash Seed: 5737d3fe-91ce-4cf3-bb5b-125ea41dd70f
</span></span><span style=display:flex><span>Journal backup: inode blocks
</span></span><span style=display:flex><span>Checksum type: crc32c
</span></span><span style=display:flex><span>Checksum: 0x66531756
</span></span><span style=display:flex><span>Journal features: journal_incompat_revoke journal_64bit
</span></span><span style=display:flex><span>journal_checksum_v3
</span></span><span style=display:flex><span>Journal size: 32M
</span></span><span style=display:flex><span>Journal length: 8192
</span></span><span style=display:flex><span>Journal sequence: 0x00000150
</span></span><span style=display:flex><span>Journal start: 1
</span></span><span style=display:flex><span>Journal checksum type: crc32c
</span></span><span style=display:flex><span>Journal checksum: 0x96f6d31c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Group 0: (Blocks 0-32767) csum 0x874c [ITABLE_ZEROED]
</span></span><span style=display:flex><span>Primary superblock at 0, Group descriptors at 1-1
</span></span><span style=display:flex><span>Reserved GDT blocks at 2-128
</span></span><span style=display:flex><span>Block bitmap at 129 (+129), csum 0x094b3829
</span></span><span style=display:flex><span>Inode bitmap at 137 (+137), csum 0x520c0d78
</span></span><span style=display:flex><span>Inode table at 145-656 (+145)
</span></span><span style=display:flex><span>28511 free blocks, 7885 free inodes, 8 directories, 7884 unused inodes
</span></span><span style=display:flex><span>Free blocks: 4257-32767
</span></span><span style=display:flex><span>Free inodes: 308-8192
</span></span><span style=display:flex><span>Group 1: (Blocks 32768-65535) csum 0xb8c0 [ITABLE_ZEROED]
</span></span><span style=display:flex><span>Backup superblock at 32768, Group descriptors at 32769-32769
</span></span><span style=display:flex><span>Reserved GDT blocks at 32770-32896
</span></span><span style=display:flex><span>Block bitmap at 130 (bg #0 + 130), csum 0xd4258ac5
</span></span><span style=display:flex><span>Inode bitmap at 138 (bg #0 + 138), csum 0xbc34b300
</span></span><span style=display:flex><span>Inode table at 657-1168 (bg #0 + 657)
</span></span><span style=display:flex><span>7813 free blocks, 8190 free inodes, 2 directories, 8189 unused inodes
</span></span><span style=display:flex><span>Free blocks: 32944-33321, 33324-33791, 36736-36863, 38912, 38914, 38917-40959,
</span></span><span style=display:flex><span>44988-45055, 60132-60415, 61085, 61095-65535
</span></span><span style=display:flex><span>Free inodes: 8195-16384
</span></span><span style=display:flex><span>Group 2: (Blocks 65536-98303) csum 0x6a55 [INODE_UNINIT, ITABLE_ZEROED]
</span></span><span style=display:flex><span>Block bitmap at 131 (bg #0 + 131), csum 0x5a5af22f
</span></span><span style=display:flex><span>Inode bitmap at 139 (bg #0 + 139), csum 0x00000000
</span></span><span style=display:flex><span>Inode table at 1169-1680 (bg #0 + 1169)
</span></span><span style=display:flex><span>25533 free blocks, 8192 free inodes, 0 directories, 8192 unused inodes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>·······
</span></span></code></pre></div><p>xfs_info：显示示挂载或已挂载的 xfs 文件系统信息</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>xfs_info mountpoint|devname
</span></span></code></pre></div><p>范例:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#xfs_info /dev/sda7
</span></span><span style=display:flex><span>meta-data=/dev/sda7     isize=512 agcount=4, agsize=131072 blks
</span></span><span style=display:flex><span>        =          sectsz=512 attr=2, projid32bit=1
</span></span><span style=display:flex><span>        =          crc=1 finobt=1, sparse=1, rmapbt=0
</span></span><span style=display:flex><span>        =          reflink=1
</span></span><span style=display:flex><span>data    =          bsize=4096 blocks=524288, imaxpct=25
</span></span><span style=display:flex><span>        = sunit=0 swidth=0 blks
</span></span><span style=display:flex><span>naming  =version 2  bsize=4096 ascii-ci=0, ftype=1
</span></span><span style=display:flex><span>log     =internal log bsize=4096 blocks=2560, version=2
</span></span><span style=display:flex><span>= sectsz=512 sunit=0 blks, lazy-count=1
</span></span><span style=display:flex><span>realtime =none         extsz=4096 blocks=0, rtextents=0
</span></span></code></pre></div><p><strong>超级块和INODE TABLE</strong>
块组描述符表(GDT)<br>ext文件系统每一个块组信息使用32字节描述，这32个字节称为块组描述符，所有块组的块组描述符组
成块组描述符表GDT(group descriptor table)。虽然每个块组都需要块组描述符来记录块组的信息和属
性元数据，但是不是每个块组中都存放了块组描述符。将所有块组的块组信息组成一个GDT保存,并将该
GDT存放于某些块组中，类似存放superblock和备份superblock的块</p><h4 id=文件系统检测和修复>文件系统检测和修复
<a class=header-anchor href=#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e6%a3%80%e6%b5%8b%e5%92%8c%e4%bf%ae%e5%a4%8d></a></h4><p>文件系统夹故障常发生于死机或者非正常关机之后，挂载为文件系统标记为“no clean”<br><strong>注意：一定不要在挂载状态下执行下面命令修复</strong>
fsck: File System Check</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>fsck.FS_TYPE
</span></span><span style=display:flex><span>fsck -t FS_TYPE
</span></span><span style=display:flex><span>fsck.ext4 -p /dev/sda1  检查并自动修复这个文件系统上的任何错误
</span></span><span style=display:flex><span>fsck -t xfs /dev/sdb2  对 /dev/sdb2 分区上的 xfs 文件系统进行检查，并在可能的情况下修复发现的问题。
</span></span></code></pre></div><p>注意：FS_TYPE 一定要与分区上已经文件类型相同
常用选项：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>-a 自动修复
</span></span><span style=display:flex><span>-r 交互式修复错误
</span></span></code></pre></div><p>e2fsck：ext系列文件专用的检测修复工具</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>-y 自动回答为yes
</span></span><span style=display:flex><span>-f 强制修复
</span></span><span style=display:flex><span>-p 自动进行安全的修复文件系统问题
</span></span></code></pre></div><p>xfs_repair：xfs文件系统专用检测修复工具<br>常用选项：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>-f 修复文件，而设备
</span></span><span style=display:flex><span>-n 只检查
</span></span><span style=display:flex><span>-d 允许修复只读的挂载设备，在单用户下修复 / 时使用，然后立即reboot
</span></span></code></pre></div><p>范例：修改破坏的ext文件系统</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#mount /dev/sdb2 /mnt</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#cp /etc/fstab /mnt/f1</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#cp /etc/fstab /mnt/f2</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#ls /mnt</span>
</span></span><span style=display:flex><span>f1 f2 lost<span style=color:#f92672>+</span>found
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#dd if=/dev/zero of=/dev/sdb2 bs=1M count=1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span><span style=color:#f92672>+</span><span style=color:#ae81ff>0</span> records <span style=color:#f92672>in</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span><span style=color:#f92672>+</span><span style=color:#ae81ff>0</span> records out
</span></span><span style=display:flex><span><span style=color:#ae81ff>1048576</span> bytes (<span style=color:#ae81ff>1.0</span> MB, <span style=color:#ae81ff>1.0</span> MiB) copied, <span style=color:#ae81ff>0.00128317</span> s, <span style=color:#ae81ff>817</span> MB<span style=color:#f92672>/</span>s
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#ls /mnt</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#tune2fs -l /dev/sdb2</span>
</span></span><span style=display:flex><span>tune2fs <span style=color:#ae81ff>1.44</span><span style=color:#f92672>.</span><span style=color:#ae81ff>6</span> (<span style=color:#ae81ff>5</span><span style=color:#f92672>-</span>Mar<span style=color:#f92672>-</span><span style=color:#ae81ff>2019</span>)
</span></span><span style=display:flex><span>tune2fs: Bad magic number <span style=color:#f92672>in</span> super<span style=color:#f92672>-</span>block <span style=color:#66d9ef>while</span> trying to open <span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>sdb2
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#df</span>
</span></span><span style=display:flex><span>Filesystem      <span style=color:#ae81ff>1</span>K<span style=color:#f92672>-</span>blocks        Used Available Use<span style=color:#f92672>%</span> Mounted
</span></span><span style=display:flex><span>on
</span></span><span style=display:flex><span>devtmpfs         <span style=color:#ae81ff>391676</span>             <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>391676</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>dev
</span></span><span style=display:flex><span>tmpfs        <span style=color:#ae81ff>408092</span>                 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>408092</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>shm
</span></span><span style=display:flex><span>tmpfs        <span style=color:#ae81ff>408092</span>                 <span style=color:#ae81ff>5824</span> <span style=color:#ae81ff>402268</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>run
</span></span><span style=display:flex><span>tmpfs        <span style=color:#ae81ff>408092</span>                 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>408092</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>sys<span style=color:#f92672>/</span>fs<span style=color:#f92672>/</span>cgroup
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>sda2       <span style=color:#ae81ff>104806400</span>             <span style=color:#ae81ff>4381120</span> <span style=color:#ae81ff>100425280</span> <span style=color:#ae81ff>5</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>sda3       <span style=color:#ae81ff>52403200</span>                <span style=color:#ae81ff>398584</span> <span style=color:#ae81ff>52004616</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>data
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>sda1       <span style=color:#ae81ff>999320</span>                  <span style=color:#ae81ff>130848</span> <span style=color:#ae81ff>799660</span> <span style=color:#ae81ff>15</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>boot
</span></span><span style=display:flex><span>tmpfs <span style=color:#ae81ff>81616</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>81616</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>run<span style=color:#f92672>/</span>user<span style=color:#f92672>/</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>sdb2        <span style=color:#ae81ff>73786976294838107984</span> <span style=color:#ae81ff>73786976294836115464</span>      <span style=color:#ae81ff>1976136</span> <span style=color:#ae81ff>100</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>mnt
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#umount /mnt</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#e2fsck /dev/sdb2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>e2fsck <span style=color:#ae81ff>1.44</span><span style=color:#f92672>.</span><span style=color:#ae81ff>6</span> (<span style=color:#ae81ff>5</span><span style=color:#f92672>-</span>Mar<span style=color:#f92672>-</span><span style=color:#ae81ff>2019</span>)
</span></span><span style=display:flex><span>ext2fs_open2: Bad magic number <span style=color:#f92672>in</span> super<span style=color:#f92672>-</span>block
</span></span><span style=display:flex><span>e2fsck: Superblock invalid, trying backup blocks<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>test was <span style=color:#f92672>not</span> cleanly unmounted, check forced<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Resize inode <span style=color:#f92672>not</span> valid<span style=color:#f92672>.</span> Recreate<span style=color:#f92672>&lt;</span>y<span style=color:#f92672>&gt;</span><span style=color:#960050;background-color:#1e0010>?</span> yes
</span></span><span style=display:flex><span>Pass <span style=color:#ae81ff>1</span>: Checking inodes, blocks, <span style=color:#f92672>and</span> sizes
</span></span><span style=display:flex><span>Pass <span style=color:#ae81ff>2</span>: Checking directory structure
</span></span><span style=display:flex><span>Pass <span style=color:#ae81ff>3</span>: Checking directory connectivity
</span></span><span style=display:flex><span>Pass <span style=color:#ae81ff>4</span>: Checking reference counts
</span></span><span style=display:flex><span>Pass <span style=color:#ae81ff>5</span>: Checking group summary information
</span></span><span style=display:flex><span>Block bitmap differences: <span style=color:#f92672>+</span>(<span style=color:#ae81ff>98304</span><span style=color:#f92672>--</span><span style=color:#ae81ff>98560</span>) <span style=color:#f92672>+</span>(<span style=color:#ae81ff>163840</span><span style=color:#f92672>--</span><span style=color:#ae81ff>164096</span>) <span style=color:#f92672>+</span>(<span style=color:#ae81ff>229376</span><span style=color:#f92672>--</span><span style=color:#ae81ff>229632</span>) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>294912</span><span style=color:#f92672>--</span><span style=color:#ae81ff>295168</span>)
</span></span><span style=display:flex><span>Fix<span style=color:#f92672>&lt;</span>y<span style=color:#f92672>&gt;</span><span style=color:#960050;background-color:#1e0010>?</span> yes
</span></span><span style=display:flex><span>Free blocks count wrong <span style=color:#66d9ef>for</span> group <span style=color:#75715e>#0 (24280, counted=24281).</span>
</span></span><span style=display:flex><span>Fix<span style=color:#f92672>&lt;</span>y<span style=color:#f92672>&gt;</span><span style=color:#960050;background-color:#1e0010>?</span>
</span></span><span style=display:flex><span>test: e2fsck canceled<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test: <span style=color:#f92672>*****</span> FILE SYSTEM WAS MODIFIED <span style=color:#f92672>*****</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#e2fsck /dev/sdb2 -y</span>
</span></span><span style=display:flex><span>e2fsck <span style=color:#ae81ff>1.44</span><span style=color:#f92672>.</span><span style=color:#ae81ff>6</span> (<span style=color:#ae81ff>5</span><span style=color:#f92672>-</span>Mar<span style=color:#f92672>-</span><span style=color:#ae81ff>2019</span>)
</span></span><span style=display:flex><span>test was <span style=color:#f92672>not</span> cleanly unmounted, check forced<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Pass <span style=color:#ae81ff>1</span>: Checking inodes, blocks, <span style=color:#f92672>and</span> sizes
</span></span><span style=display:flex><span>Pass <span style=color:#ae81ff>2</span>: Checking directory structure
</span></span><span style=display:flex><span>Pass <span style=color:#ae81ff>3</span>: Checking directory connectivity
</span></span><span style=display:flex><span>Pass <span style=color:#ae81ff>4</span>: Checking reference counts
</span></span><span style=display:flex><span>Pass <span style=color:#ae81ff>5</span>: Checking group summary information
</span></span><span style=display:flex><span>Free blocks count wrong <span style=color:#66d9ef>for</span> group <span style=color:#75715e>#0 (24280, counted=24281).</span>
</span></span><span style=display:flex><span>Fix<span style=color:#960050;background-color:#1e0010>?</span> yes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ree blocks count wrong <span style=color:#66d9ef>for</span> group <span style=color:#75715e>#1 (32511, counted=32509).</span>
</span></span><span style=display:flex><span>Fix<span style=color:#960050;background-color:#1e0010>?</span> yes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Free blocks count wrong (<span style=color:#ae81ff>498131</span>, counted<span style=color:#f92672>=</span><span style=color:#ae81ff>498130</span>)<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Fix<span style=color:#960050;background-color:#1e0010>?</span> yes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Free inodes count wrong <span style=color:#66d9ef>for</span> group <span style=color:#75715e>#0 (8181, counted=8179).</span>
</span></span><span style=display:flex><span>Fix<span style=color:#960050;background-color:#1e0010>?</span> yes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Free inodes count wrong (<span style=color:#ae81ff>131061</span>, counted<span style=color:#f92672>=</span><span style=color:#ae81ff>131059</span>)<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Fix<span style=color:#960050;background-color:#1e0010>?</span> yes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Padding at end of inode bitmap is <span style=color:#f92672>not</span> set<span style=color:#f92672>.</span> Fix<span style=color:#960050;background-color:#1e0010>?</span> yes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test: <span style=color:#f92672>*****</span> FILE SYSTEM WAS MODIFIED <span style=color:#f92672>*****</span>
</span></span><span style=display:flex><span>test: <span style=color:#ae81ff>13</span><span style=color:#f92672>/</span><span style=color:#ae81ff>131072</span> files (<span style=color:#ae81ff>0.0</span><span style=color:#f92672>%</span> non<span style=color:#f92672>-</span>contiguous), <span style=color:#ae81ff>26158</span><span style=color:#f92672>/</span><span style=color:#ae81ff>524288</span> blocks
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#tune2fs -l /dev/sdb2</span>
</span></span><span style=display:flex><span>tune2fs <span style=color:#ae81ff>1.44</span><span style=color:#f92672>.</span><span style=color:#ae81ff>6</span> (<span style=color:#ae81ff>5</span><span style=color:#f92672>-</span>Mar<span style=color:#f92672>-</span><span style=color:#ae81ff>2019</span>)
</span></span><span style=display:flex><span>Filesystem volume name: test
</span></span><span style=display:flex><span>Last mounted on:         <span style=color:#f92672>&lt;</span><span style=color:#f92672>not</span> available<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>Filesystem UUID:        c44b3a40<span style=color:#f92672>-</span><span style=color:#ae81ff>70</span>dc<span style=color:#f92672>-</span><span style=color:#ae81ff>44</span>d2<span style=color:#f92672>-</span><span style=color:#ae81ff>8427</span><span style=color:#f92672>-</span>b8094f73940a
</span></span><span style=display:flex><span>Filesystem magic number: <span style=color:#ae81ff>0xEF53</span>
</span></span><span style=display:flex><span>Filesystem revision <span style=color:#75715e>#:  1 (dynamic)</span>
</span></span><span style=display:flex><span>Filesystem features:    has_journal ext_attr resize_inode dir_index filetype
</span></span><span style=display:flex><span>extent <span style=color:#ae81ff>64</span>bit flex_bg sparse_super large_file huge_file dir_nlink extra_isize
</span></span><span style=display:flex><span>metadata_csum
</span></span><span style=display:flex><span>Filesystem flags:       signed_directory_hash
</span></span><span style=display:flex><span>Default mount options: user_xattr acl
</span></span><span style=display:flex><span>Filesystem state:       clean
</span></span><span style=display:flex><span>Errors behavior:        Continue
</span></span><span style=display:flex><span>Filesystem <span style=color:#a6e22e>OS</span> type:     Linux
</span></span><span style=display:flex><span>Inode count:            <span style=color:#ae81ff>131072</span>
</span></span><span style=display:flex><span>Block count:            <span style=color:#ae81ff>524288</span>
</span></span><span style=display:flex><span>Reserved block count:   <span style=color:#ae81ff>26214</span>
</span></span><span style=display:flex><span>Free blocks:            <span style=color:#ae81ff>498130</span>
</span></span><span style=display:flex><span>Free inodes:            <span style=color:#ae81ff>131059</span>
</span></span><span style=display:flex><span>First block:            <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Block size:             <span style=color:#ae81ff>4096</span>
</span></span><span style=display:flex><span>Fragment size:          <span style=color:#ae81ff>4096</span>
</span></span><span style=display:flex><span>Group descriptor size:  <span style=color:#ae81ff>64</span>
</span></span><span style=display:flex><span>Reserved GDT blocks:    <span style=color:#ae81ff>255</span>
</span></span><span style=display:flex><span>Blocks per group:       <span style=color:#ae81ff>32768</span>
</span></span><span style=display:flex><span>Fragments per group:    <span style=color:#ae81ff>32768</span>
</span></span><span style=display:flex><span>Inodes per group:       <span style=color:#ae81ff>8192</span>
</span></span><span style=display:flex><span>Inode blocks per group: <span style=color:#ae81ff>512</span>
</span></span><span style=display:flex><span>Flex block group size:  <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>Filesystem created:     Mon Apr <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>10</span>:<span style=color:#ae81ff>06</span> <span style=color:#ae81ff>2020</span>
</span></span><span style=display:flex><span>Last mount time:        n<span style=color:#f92672>/</span>a
</span></span><span style=display:flex><span>Last write time:        Mon Apr <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>57</span>:<span style=color:#ae81ff>21</span> <span style=color:#ae81ff>2020</span>
</span></span><span style=display:flex><span>Mount count: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Maximum mount count:    <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Last checked:           Mon Apr <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>16</span>:<span style=color:#ae81ff>57</span>:<span style=color:#ae81ff>21</span> <span style=color:#ae81ff>2020</span>
</span></span><span style=display:flex><span>Check interval:         <span style=color:#ae81ff>0</span> (<span style=color:#f92672>&lt;</span>none<span style=color:#f92672>&gt;</span>)
</span></span><span style=display:flex><span>Lifetime writes:        <span style=color:#ae81ff>130</span> MB
</span></span><span style=display:flex><span>Reserved blocks uid:    <span style=color:#ae81ff>0</span> (user root)
</span></span><span style=display:flex><span>Reserved blocks gid:    <span style=color:#ae81ff>0</span> (group root)
</span></span><span style=display:flex><span>First inode:            <span style=color:#ae81ff>11</span>
</span></span><span style=display:flex><span>Inode size:             <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>Required extra isize:   <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>Desired extra isize:    <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>Journal inode:          <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>Default directory hash: half_md4
</span></span><span style=display:flex><span><span style=color:#a6e22e>Directory</span> Hash Seed:    <span style=color:#ae81ff>8</span>d4f1f25<span style=color:#f92672>-</span>ab7c<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>fb2<span style=color:#f92672>-</span>b45d<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span>d23974edede
</span></span><span style=display:flex><span>Journal backup:         inode blocks
</span></span><span style=display:flex><span>Checksum type:          crc32c
</span></span><span style=display:flex><span>Checksum:               <span style=color:#ae81ff>0x7f222e49</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#mount /dev/sdb2 /mnt</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#ls /mnt</span>
</span></span><span style=display:flex><span>f1 f2 lost<span style=color:#f92672>+</span>found
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#cat /mnt/f1</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># /etc/fstab</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Created by anaconda on Wed Jan 15 21:39:15 2020</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Accessible filesystems, by reference, are maintained under &#39;/dev/disk/&#39;.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># After editing this file, run &#39;systemctl daemon-reload&#39; to update systemd</span>
</span></span><span style=display:flex><span><span style=color:#75715e># units generated from this file.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>UUID<span style=color:#f92672>=</span>f7f53add<span style=color:#f92672>-</span>b184<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>ddc<span style=color:#f92672>-</span><span style=color:#ae81ff>8</span>d2c<span style=color:#f92672>-</span><span style=color:#ae81ff>5263</span>b84d1e15 <span style=color:#f92672>/</span> xfs
</span></span><span style=display:flex><span>defaults <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>UUID<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>c2216e3<span style=color:#f92672>-</span>ae34<span style=color:#f92672>-</span><span style=color:#ae81ff>444</span>e<span style=color:#f92672>-</span>aa60<span style=color:#f92672>-</span><span style=color:#ae81ff>83</span>cbaebb47e7 <span style=color:#f92672>/</span>boot ext4
</span></span><span style=display:flex><span>defaults <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>UUID<span style=color:#f92672>=</span><span style=color:#ae81ff>9</span>a2293a8<span style=color:#f92672>-</span><span style=color:#ae81ff>9277</span><span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>b18<span style=color:#f92672>-</span>bae1<span style=color:#f92672>-</span><span style=color:#ae81ff>498e0</span>b9da145 <span style=color:#f92672>/</span>data xfs
</span></span><span style=display:flex><span>defaults <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>UUID<span style=color:#f92672>=</span>eebe3bc7<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span>d52<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>ad9<span style=color:#f92672>-</span><span style=color:#ae81ff>86</span>aa<span style=color:#f92672>-</span><span style=color:#ae81ff>916</span>f1a123fd4 swap swap
</span></span><span style=display:flex><span>defaults <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#</span>
</span></span></code></pre></div><h2 id=挂载>挂载
<a class=header-anchor href=#%e6%8c%82%e8%bd%bd></a></h2><h3 id=添加新硬盘让kernel发现新硬盘>添加新硬盘，让kernel发现新硬盘
<a class=header-anchor href=#%e6%b7%bb%e5%8a%a0%e6%96%b0%e7%a1%ac%e7%9b%98%e8%ae%a9kernel%e5%8f%91%e7%8e%b0%e6%96%b0%e7%a1%ac%e7%9b%98></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>echo &#39;- - -&#39; &gt; /sys/class/scsi_host/host0|1|2/scan
</span></span></code></pre></div><p>2、再分区设置文件系统</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>parted /dev/sda mklabel msdos|gtp
</span></span></code></pre></div><p>3、分区</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>parted /dev/sda mkpart primary 1 300
</span></span></code></pre></div><p>4.设置文件系统</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>mkfs.ext4 /dev/sda1
</span></span></code></pre></div><p>5、挂载</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>mount /dev/sda1  /opt/test
</span></span></code></pre></div><p>挂载:将额外文件系统与根文件系统某现存的目录建立起关联关系，进而使得此目录做为其它文件访问入
口的行为<br>卸载:为解除此关联关系的过程<br>把设备关联挂载点：mount Point<br>挂载点下原有文件在挂载完成后会被临时隐藏，因此，挂载点目录一般为空<br>进程正在使用中的设备无法被卸载</p><h3 id=挂载文件系统-mount>挂载文件系统 mount
<a class=header-anchor href=#%e6%8c%82%e8%bd%bd%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f-mount></a></h3><p>格式：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>mount [-fnrsvw] [-t vfstype] [-o options] device mountpoint
</span></span></code></pre></div><p><strong>device：指明要挂载的设备</strong></p><ul><li>设备文件：例如:/dev/sda5</li><li>卷标：-L &lsquo;LABEL&rsquo;, 例如 -L &lsquo;MYDATA&rsquo;</li><li>UUID： -U &lsquo;UUID&rsquo;：例如 -U &lsquo;0c50523c-43f1-45e7-85c0-a126711d406e&rsquo;</li><li>伪文件系统名称：proc, sysfs, devtmpfs, configfs<br><strong>mountpoint：挂载点目录必须事先存在，建议使用空目录</strong></br><strong>mount 常用命令选项</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>-f              模仿挂载，但不实际执行挂载操作。这可以用来检查挂载命令是否正确。
</span></span><span style=display:flex><span>-t fstype       指定要挂载的设备上的文件系统类型,如:ext4,xfs
</span></span><span style=display:flex><span>-r readonly，   只读挂载
</span></span><span style=display:flex><span>-w read and write, 读写挂载,此为默认设置,可省略
</span></span><span style=display:flex><span>-n              不更新/etc/mtab，mount不可见（挂载时不将信息记录在 /etc/mtab 或 /proc/mounts 文件中。）
</span></span><span style=display:flex><span>-a              自动挂载所有支持自动挂载的设备(定义在了/etc/fstab文件中，且挂载选项中有
</span></span><span style=display:flex><span>auto功能)
</span></span><span style=display:flex><span>-L &#39;LABEL&#39;      以卷标指定挂载设备
</span></span><span style=display:flex><span>-U &#39;UUID&#39; 以UUID指定要挂载的设备
</span></span><span style=display:flex><span>-B, --bind      绑定目录到另一个目录上
</span></span><span style=display:flex><span>-s              严格模式，mount 将以传统模式运行，不使用 libmount 库。
</span></span><span style=display:flex><span>-o options：    (挂载文件系统的选项)，多个选项使用逗号分隔。指定挂载时使用的特定选项，
</span></span><span style=display:flex><span>                如 ro（只读）、rw（读写）、user（允许普通用户挂载）、exec（允许执行文件）等。
</span></span><span style=display:flex><span>async           异步模式,内存更改时,写入缓存区buffer,过一段时间再写到磁盘中，效率高，但不安全
</span></span><span style=display:flex><span>sync            同步模式,内存更改时，同时写磁盘，安全，但效率低下
</span></span><span style=display:flex><span>atime/noatime   包含目录和文件
</span></span><span style=display:flex><span>diratime/nodiratime 目录的访问时间戳
</span></span><span style=display:flex><span>auto/noauto     是否支持开机自动挂载，是否支持-a选项
</span></span><span style=display:flex><span>exec/noexec     是否支持将文件系统上运行应用程序
</span></span><span style=display:flex><span>dev/nodev       是否支持在此文件系统上使用设备文件
</span></span><span style=display:flex><span>suid/nosuid     是否支持suid和sgid权限
</span></span><span style=display:flex><span>remount         重新挂载
</span></span><span style=display:flex><span>ro/rw           只读、读写
</span></span><span style=display:flex><span>user/nouser     是否允许普通用户挂载此设备，/etc/fstab使用
</span></span><span style=display:flex><span>acl/noacl       启用此文件系统上的acl功能
</span></span><span style=display:flex><span>loop            使用loop设备
</span></span><span style=display:flex><span>_netdev         当网络可用时才对网络资源进行挂载，如：NFS文件系统
</span></span><span style=display:flex><span>defaults        相当于rw, suid, dev, exec, auto, nouser, async
</span></span><span style=display:flex><span>device          指定要挂载的设备，如 /dev/sda1。
</span></span><span style=display:flex><span>mountpoint      指定文件系统挂载的目录，如 /mnt/data。
</span></span></code></pre></div><p><strong>挂载规则:</strong></p><ul><li>一个挂载点同一时间只能挂载一个设备</li><li>一个挂载点同一时间挂载了多个设备，只能看到最后一个设备的数据，其它设备上的数据将被隐藏</li><li>一个设备可以同时挂载到多个挂载点</li><li>通常挂载点一般是已存在空的目录</li></ul><h3 id=卸载文件系统-umount>卸载文件系统 umount
<a class=header-anchor href=#%e5%8d%b8%e8%bd%bd%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f-umount></a></h3><p>卸载时：可使用设备，也可以使用挂载点</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>umount 设备名|挂载点
</span></span></code></pre></div><h3 id=查看挂载情况>查看挂载情况
<a class=header-anchor href=#%e6%9f%a5%e7%9c%8b%e6%8c%82%e8%bd%bd%e6%83%85%e5%86%b5></a></h3><p>查看挂载</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>#通过查看/etc/mtab文件显示当前已挂载的所有设备
</span></span><span style=display:flex><span>mount
</span></span><span style=display:flex><span>#查看内核追踪到的已挂载的所有设备
</span></span><span style=display:flex><span>cat /proc/mounts
</span></span></code></pre></div><p>查看挂载点情况</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>findmnt MOUNT_POINT|device
</span></span></code></pre></div><p>查看正在访问指定文件系统的进程</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>lsof MOUNT_POINT
</span></span><span style=display:flex><span>fuser -v MOUNT_POINT
</span></span></code></pre></div><p>终止所有在正访问指定的文件系统的进程</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>fuser -km MOUNT_POINT
</span></span></code></pre></div><h3 id=持久挂载>持久挂载
<a class=header-anchor href=#%e6%8c%81%e4%b9%85%e6%8c%82%e8%bd%bd></a></h3><p>将挂载保存到 /etc/fstab 中可以下次开机时，自动启用挂载<br>将内容添加到/etc/fstab<br>格式帮助：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>man 5 fstab
</span></span></code></pre></div><p>每行定义一个要挂载的文件系统,，其中包括共 6 项</p><ul><li>要挂载的设备或伪文件系统
设备文件
LABEL：LABEL=""<br>UUID：UUID=""<br>伪文件系统名称：proc, sysfs</li><li>挂载点：必须是事先存在的目录</li><li>文件系统类型：ext4，xfs，iso9660，nfs，none</li><li>挂载选项：defaults ，acl，bind</li><li>转储频率：0：不做备份 1：每天转储 2：每隔一天转储</li><li>fsck检查的文件系统的顺序：允许的数字是0 1 2
0：不自检 ，1：首先自检；一般只有rootfs才用 2：非rootfs使用
<strong>添加新的挂载项，需要执行下面命令生效</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>mount -a
</span></span></code></pre></div><p>范例：/etc/fstab格式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>rocky <span style=color:#f92672>~</span>]<span style=color:#75715e># cat /etc/fstab</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># /etc/fstab</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Created by anaconda on Sun Dec  8 07:59:56 2024</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Accessible filesystems, by reference, are maintained under &#39;/dev/disk/&#39;.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># After editing this file, run &#39;systemctl daemon-reload&#39; to update systemd</span>
</span></span><span style=display:flex><span><span style=color:#75715e># units generated from this file.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>mapper<span style=color:#f92672>/</span>rl_192<span style=color:#f92672>-</span>root <span style=color:#f92672>/</span>                       xfs     defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>UUID<span style=color:#f92672>=</span><span style=color:#ae81ff>04</span>c2ba22<span style=color:#f92672>-</span>c928<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>cdd<span style=color:#f92672>-</span><span style=color:#ae81ff>8334</span><span style=color:#f92672>-</span><span style=color:#ae81ff>25</span>d6bccca8c2 <span style=color:#f92672>/</span>boot                   xfs     defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>mapper<span style=color:#f92672>/</span>rl_192<span style=color:#f92672>-</span>swap none                    swap    defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos6 <span style=color:#f92672>~</span>]<span style=color:#75715e>#cat /etc/fstab</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>disk<span style=color:#f92672>.</span>img           <span style=color:#f92672>/</span>mnt<span style=color:#f92672>/</span>disk           ext4            loop <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>范例：centos7, 8 /etc/fstab 的分区UUID错误，无法启动</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>自动进入emergency mode,输入root 密码
</span></span><span style=display:flex><span>#cat /proc/mounts 可以查看到/ 以rw方式挂载
</span></span><span style=display:flex><span>#vim /etc/fstab
</span></span><span style=display:flex><span>#reboot
</span></span></code></pre></div><p>范例：centos 6 /etc/fstab 的分区UUID错误，无法启动</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>如果/etc/fstab 的挂载设备出错，比如文件系统故障，并且文件系统检测项（即第6项为非0），将导致无
</span></span><span style=display:flex><span>法启动
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>自动进入emergency mode,输入root 密码
</span></span><span style=display:flex><span>#cat /proc/mounts 可以查看到/ 以ro方式挂载，无法直接修改配置文件
</span></span><span style=display:flex><span>#mount -o remount,rw /
</span></span><span style=display:flex><span>#vim /etc/fstab
</span></span><span style=display:flex><span>将故障行的最后1项，即第6项修改为0，开机不检测此项挂载设备的健康性，从而忽略错误，能实现启动
</span></span></code></pre></div><h2 id=处理交换文件和分区>处理交换文件和分区
<a class=header-anchor href=#%e5%a4%84%e7%90%86%e4%ba%a4%e6%8d%a2%e6%96%87%e4%bb%b6%e5%92%8c%e5%88%86%e5%8c%ba></a></h2><h3 id=swap-介绍>swap 介绍
<a class=header-anchor href=#swap-%e4%bb%8b%e7%bb%8d></a></h3><p>swap交换分区是系统RAM的补充，swap 分区支持虚拟内存。当没有足够的 RAM 保存系统处理的数据
时会将数据写入 swap 分区，当系统缺乏 swap 空间时，内核会因 RAM 内存耗尽而终止进程。配置过
多 swap 空间会造成存储设备处于分配状态但闲置，造成浪费，过多 swap 空间还会掩盖内存泄露</p><p>注意：为优化性能，可以将swap 分布存放，或高性能磁盘存放<br><strong>Redhat 官方推荐推荐系统 swap 空间</strong></p><p><a href=https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/installation_guide/sect-disk-partitioning-setup-ppc#sect-recommended-partitioning-scheme-ppc title=https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/installation_guide/sect-disk-partitioning-setup-ppc#sect-recommended-partitioning-scheme-ppc rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/installation_guide/sect-disk-partitioning-setup-ppc#sect-recommended-partitioning-scheme-ppc
<i class="fa fa-external-link-alt"></i></a></p><table><thead><tr><th>系统中的 RAM 量</th><th>推荐的 swap 空间</th><th>允许休眠的建议 swap 空间大小</th></tr></thead><tbody><tr><td>低于 2 GB</td><td>RAM 量的2倍数</td><td>RAM 容量的三倍</td></tr><tr><td>2 GB - 8 GB</td><td>等于 RAM 量</td><td>RAM 量的倍数</td></tr><tr><td>8 GB - 64 GB</td><td>4 GB 到 RAM 容量的 0.5 倍</td><td>RAM 容量的 1.5 倍</td></tr><tr><td>超过 64 GB</td><td>独立负载（至少 4GB）</td><td>不建议使用休眠功能</td></tr></tbody></table><h3 id=交换分区实现过程>交换分区实现过程
<a class=header-anchor href=#%e4%ba%a4%e6%8d%a2%e5%88%86%e5%8c%ba%e5%ae%9e%e7%8e%b0%e8%bf%87%e7%a8%8b></a></h3><ol><li>创建交换分区或者文件</li><li>使用mkswap写入特殊签名</li><li>在/etc/fstab文件中添加适当的条目</li><li>使用swapon -a 激活交换空间<br>启用swap分区</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>swapon [OPTION]... [DEVICE]
</span></span></code></pre></div><p>选项：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>-a #激活所有的交换分区
</span></span><span style=display:flex><span>-p PRIORITY #指定优先级(-1到32767之间)，值越大,优先级越高.也可在/etc/fstab文件中的第4列指
</span></span><span style=display:flex><span>定：pri=value
</span></span></code></pre></div><p>范例:创建swap分区</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#echo -e &#39;n\np\n\n\n+2G\nt\n82\nw\n&#39; | fdisk /dev/sdc
</span></span><span style=display:flex><span>[root@centos8 ~]#mkswap /dev/sdc1
</span></span><span style=display:flex><span>Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)
</span></span><span style=display:flex><span>no label, UUID=d3140a7a-65b7-4cb7-8a2b-12d38aa98c6f
</span></span><span style=display:flex><span>[root@centos8 ~]#blkid /dev/sdc1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/dev/sdc1: UUID=&#34;d3140a7a-65b7-4cb7-8a2b-12d38aa98c6f&#34; TYPE=&#34;swap&#34;
</span></span><span style=display:flex><span>PARTUUID=&#34;b094d43d-01
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#vim /etc/fstab
</span></span><span style=display:flex><span>UUID=d3140a7a-65b7-4cb7-8a2b-12d38aa98c6f swap swap defaults 0 0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#swapon -a
</span></span><span style=display:flex><span>[root@centos8 ~]#free -h
</span></span><span style=display:flex><span>                total   used    free s  hared   buff/cache  available
</span></span><span style=display:flex><span>Mem:            3.7Gi   264Mi   3.2Gi   9.0Mi    2 61Mi        3.2Gi
</span></span><span style=display:flex><span>Swap:           4.0Gi       0B  4.0Gi
</span></span><span style=display:flex><span>[root@centos8 ~]#cat /proc/swaps
</span></span><span style=display:flex><span>Filename         Type       Size        Used        Priority
</span></span><span style=display:flex><span>/dev/sda5                   partition               2097148 0 -2
</span></span><span style=display:flex><span>/dev/sdc1 p                 artition                2097148 0 -3
</span></span></code></pre></div><h3 id=禁用swap分区>禁用swap分区：
<a class=header-anchor href=#%e7%a6%81%e7%94%a8swap%e5%88%86%e5%8c%ba></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>swapoff [OPTION]... [DEVICE]
</span></span></code></pre></div><p>范例:禁用swap分区</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#sed -i.bak &#39;/swap/d&#39; /etc/fstab
</span></span><span style=display:flex><span>[root@centos8 ~]#swapoff -a
</span></span></code></pre></div><h3 id=调整swap启用标准>调整swap启用标准
<a class=header-anchor href=#%e8%b0%83%e6%95%b4swap%e5%90%af%e7%94%a8%e6%a0%87%e5%87%86></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@rocky ~]# cat /proc/sys/vm/swappiness
</span></span><span style=display:flex><span>60         可用空间低于60%启用swap
</span></span><span style=display:flex><span>[root@rocky ~]# echo 0 &gt; /proc/sys/vm/swappiness
</span></span><span style=display:flex><span>[root@rocky ~]# cat /proc/sys/vm/swappiness
</span></span><span style=display:flex><span>0
</span></span></code></pre></div><p><strong>SWAP的优先级</strong><br>可以指定swap分区0到32767的优先级，值越大优先级越高<br>如果用户没有指定，那么核心会自动给swap指定一个优先级，这个优先级从-1开始，每加入一个新的<br>没有用户指定优先级的swap，会给这个优先级减一<br>先添加的swap的缺省优先级比较高，除非用户自己指定一个优先级，而用户指定的优先级(是正数)永远
高于核心缺省指定的优先级(是负数)<br>范例: 修改swap分区的优先级</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#cat /etc/fstab
</span></span><span style=display:flex><span>#
</span></span><span style=display:flex><span>UUID=acf9bd1f-caae-4e28-87be-e53afec61347 / xfs defaults
</span></span><span style=display:flex><span>0 0
</span></span><span style=display:flex><span>UUID=1770b87e-db5a-445e-bff1-1653ac64b3d6 /boot ext4 defaults
</span></span><span style=display:flex><span>1 2
</span></span><span style=display:flex><span>UUID=ffffd919-d674-44d9-a4e7-402874f0a1f0 /data xfs defaults
</span></span><span style=display:flex><span>0 0
</span></span><span style=display:flex><span>UUID=409e36d2-ac5e-423f-ad78-9b12db4576bd swap swap defaults
</span></span><span style=display:flex><span>0 0
</span></span><span style=display:flex><span>UUID=509ee336-6aec-48b0-b390-12c1f9889520 swap swap pri=100
</span></span><span style=display:flex><span>0 0
</span></span></code></pre></div><h3 id=关闭swap>关闭swap
<a class=header-anchor href=#%e5%85%b3%e9%97%adswap></a></h3><p>范例: 以文件实现swap功能</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#dd if=/dev/zero of=/swapfile bs=1M count=1024
</span></span><span style=display:flex><span>[root@centos8 ~]#mkswap /swapfile
</span></span><span style=display:flex><span>[root@centos8 ~]#blkid /swapfile &gt;&gt; /etc/fstab
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/swapfile     swap swap defaults     0 0     #注释后，重启就不再启用swap。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>不重启办法 
</span></span><span style=display:flex><span>[root@rocky ~]# swapon -s
</span></span><span style=display:flex><span>Filename                                Type            Size            Used            Priority
</span></span><span style=display:flex><span>/dev/dm-1                               partition       1048572         25656           -2
</span></span><span style=display:flex><span>[root@rocky ~]# free -h
</span></span><span style=display:flex><span>               total        used        free      shared  buff/cache   available
</span></span><span style=display:flex><span>Mem:           456Mi       121Mi       185Mi       0.0Ki       161Mi       335Mi
</span></span><span style=display:flex><span>Swap:          1.0Gi        25Mi       998Mi
</span></span><span style=display:flex><span>[root@rocky ~]# swapoff /dev/dm-1
</span></span><span style=display:flex><span>[root@rocky ~]# free -h
</span></span><span style=display:flex><span>               total        used        free      shared  buff/cache   available
</span></span><span style=display:flex><span>Mem:           456Mi       142Mi       164Mi       3.0Mi       165Mi       314Mi
</span></span><span style=display:flex><span>Swap:             0B          0B          0B
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>UUID,使用文件的路径
</span></span><span style=display:flex><span>[root@centos8 ~]#chmod 600 /swapfile
</span></span><span style=display:flex><span>[root@centos8 ~]#swapon -a
</span></span><span style=display:flex><span>[root@centos8 ~]#swapon -s
</span></span><span style=display:flex><span>Filename Type Size Used Priority
</span></span><span style=display:flex><span>/dev/sda5 partition 2097148 0 -2
</span></span><span style=display:flex><span>/swapfile file 1048572 0 -3
</span></span></code></pre></div><h3 id=swap的使用策略>swap的使用策略
<a class=header-anchor href=#swap%e7%9a%84%e4%bd%bf%e7%94%a8%e7%ad%96%e7%95%a5></a></h3><p>/proc/sys/vm/swappiness 的值决定了当内存占用达到一定的百分比时，会启用swap分区的空间<br>使用规则</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>当内存使用率达到100-swappiness时,会启用交换分区
</span></span><span style=display:flex><span>简单地说这个参数定义了系统对swap的使用倾向，此值越大表示越倾向于使用swap。
</span></span><span style=display:flex><span>可以设为0，这样做并不会禁止对swap的使用，只是最大限度地降低了使用swap的可能性
</span></span></code></pre></div><p>范例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>#说明：CentOS7和8默认值为30，内存在使用到100-30=70%的时候，就开始出现有交换分区的使用。
</span></span><span style=display:flex><span>[root@centos8 ~]# cat /proc/sys/vm/swappiness
</span></span><span style=display:flex><span>30
</span></span><span style=display:flex><span>[root@centos7 ~]# cat /proc/sys/vm/swappiness
</span></span><span style=display:flex><span>30
</span></span><span style=display:flex><span>[root@centos6 ~]# cat /proc/sys/vm/swappiness
</span></span><span style=display:flex><span>60
</span></span><span style=display:flex><span>[root@rhel5 ~]# cat /proc/sys/vm/swappiness
</span></span><span style=display:flex><span>60
</span></span><span style=display:flex><span>root@ubuntu2004:~# cat /proc/sys/vm/swappiness
</span></span><span style=display:flex><span>60
</span></span><span style=display:flex><span>[root@ubuntu1804 ~]# cat /proc/sys/vm/swappiness
</span></span><span style=display:flex><span>60
</span></span></code></pre></div><h2 id=移动介质>移动介质
<a class=header-anchor href=#%e7%a7%bb%e5%8a%a8%e4%bb%8b%e8%b4%a8></a></h2><p>挂载意味着使外来的文件系统看起来如同是主目录树的一部分，所有移动介质也需要挂载，挂载点通常
在/media 或/mnt下<br>访问前，介质必须被挂载<br>摘除时，介质必须被卸载<br>按照默认设置，非根用户只能挂载某些设备（光盘、DVD、软盘、USB等等）</p><h3 id=使用光盘>使用光盘
<a class=header-anchor href=#%e4%bd%bf%e7%94%a8%e5%85%89%e7%9b%98></a></h3><p>在图形环境下自动启动挂载/run/media//<br>手工挂载</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>mount /dev/cdrom /mnt/
</span></span></code></pre></div><p>操作光盘</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>eject #弹出光盘
</span></span><span style=display:flex><span>eject -t #弹入光盘
</span></span></code></pre></div><p>创建ISO文件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>cp /dev/cdrom /root/centos.iso
</span></span><span style=display:flex><span>mkisofs -r -o /root/etc.iso /etc #来自于genisoimage包
</span></span></code></pre></div><p>mkisofs：这是命令的名称，用于创建 ISO 文件。<br>-r：这个选项告诉 mkisofs 以 Rock Ridge 扩展模式创建 ISO 文件，这意味着 ISO 文件将包含更多的 Unix 文件系统信息，如文件权限和符号链接。<br>-o /root/etc.iso：这个选项指定了输出 ISO 文件的路径和文件名。在这个例子中，ISO 文件将被命名为 etc.iso，并保存在 /root 目录下。<br>/etc：这是要包含在 ISO 文件中的目录。在这个例子中，/etc 目录下的所有文件和目录将被复制到 ISO 文件中。<br>这个命令的作用是将 /etc 目录及其所有内容创建为一个 ISO 光盘映像文件，该文件可以在 /root 目录下找到，并命名为 etc.iso。这个 ISO 文件可以被用来创建一个包含 /etc 目录内容的可启动光盘，或者用于备份 /etc 目录。<br>刻录光盘</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>wodim -v -eject centos.iso.
</span></span></code></pre></div><h3 id=usb介质>USB介质
<a class=header-anchor href=#usb%e4%bb%8b%e8%b4%a8></a></h3><p>查看USB设备是否识别</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>lsusb #来自于usbutils包
</span></span></code></pre></div><p>被内核探测为SCSI设备,表现为/dev/sdaX、/dev/sdbX或类似的设备文件<br>在图形环境中自动挂载在/run/media//<br>手动挂载</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>mount /dev/sdX# /mnt
</span></span></code></pre></div><p>范例：插入U盘后可以看到日志信息</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#tail /var/log/messages -f</span>
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>06</span> centos8 kernel: usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: new SuperSpeed Gen <span style=color:#ae81ff>1</span> USB device number
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span> using xhci_hcd
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>06</span> centos8 kernel: usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: New USB device found, idVendor<span style=color:#f92672>=</span><span style=color:#ae81ff>0951</span>,
</span></span><span style=display:flex><span>idProduct<span style=color:#f92672>=</span><span style=color:#ae81ff>1666</span>, bcdDevice<span style=color:#f92672>=</span> <span style=color:#ae81ff>1.10</span>
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>06</span> centos8 kernel: usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: New USB device strings: Mfr<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>Product<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>, SerialNumber<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>06</span> centos8 kernel: usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: Product: DataTraveler <span style=color:#ae81ff>3.0</span>
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>06</span> centos8 kernel: usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: Manufacturer: Kingston
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>06</span> centos8 kernel: usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: SerialNumber: AC220B280A43B03189723CA0
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>06</span> centos8 kernel: usb<span style=color:#f92672>-</span>storage <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>:<span style=color:#ae81ff>1.0</span>: USB Mass Storage device
</span></span><span style=display:flex><span>detected
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>06</span> centos8 kernel: scsi host3: usb<span style=color:#f92672>-</span>storage <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>:<span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>06</span> centos8 kernel: usbcore: registered new interface driver usb<span style=color:#f92672>-</span>
</span></span><span style=display:flex><span>storage
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>06</span> centos8 kernel: usbcore: registered new interface driver uas
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>07</span> centos8 kernel: scsi <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: Direct<span style=color:#f92672>-</span>Access Kingston
</span></span><span style=display:flex><span>DataTraveler <span style=color:#ae81ff>3.0</span> PMAP PQ: <span style=color:#ae81ff>0</span> ANSI: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>07</span> centos8 kernel: sd <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: Attached scsi generic sg4 type <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>07</span> centos8 kernel: sd <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: [sdd] <span style=color:#ae81ff>60555264</span> <span style=color:#ae81ff>512</span><span style=color:#f92672>-</span>byte logical
</span></span><span style=display:flex><span>blocks: (<span style=color:#ae81ff>31.0</span> GB<span style=color:#f92672>/</span><span style=color:#ae81ff>28.9</span> GiB)
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>07</span> centos8 kernel: sd <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: [sdd] Write Protect is off
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>07</span> centos8 kernel: sd <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: [sdd] Write cache: disabled, read
</span></span><span style=display:flex><span>cache: enabled, doesn<span style=color:#e6db74>&#39;t support DPO or FUA</span>
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>07</span> centos8 kernel: sdd: sdd1
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>25</span>:<span style=color:#ae81ff>07</span> centos8 kernel: sd <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: [sdd] Attached SCSI removable disk
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>30</span>:<span style=color:#ae81ff>02</span> centos8 systemd[<span style=color:#ae81ff>1</span>]: Started <span style=color:#f92672>/</span>usr<span style=color:#f92672>/</span>bin<span style=color:#f92672>/</span>systemctl start man<span style=color:#f92672>-</span>db<span style=color:#f92672>-</span>
</span></span><span style=display:flex><span>cache<span style=color:#f92672>-</span>update<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>30</span>:<span style=color:#ae81ff>02</span> centos8 systemd[<span style=color:#ae81ff>1</span>]: Starting man<span style=color:#f92672>-</span>db<span style=color:#f92672>-</span>cache<span style=color:#f92672>-</span>update<span style=color:#f92672>.</span>service<span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>30</span>:<span style=color:#ae81ff>03</span> centos8 systemd[<span style=color:#ae81ff>1</span>]: Started man<span style=color:#f92672>-</span>db<span style=color:#f92672>-</span>cache<span style=color:#f92672>-</span>update<span style=color:#f92672>.</span>service<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>Apr <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>33</span>:<span style=color:#ae81ff>21</span> centos8 kernel: usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: USB disconnect, device number <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>^</span>C
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#dmesg</span>
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1861.537401</span>] usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: new SuperSpeed Gen <span style=color:#ae81ff>1</span> USB device number <span style=color:#ae81ff>2</span> using xhci_hcd
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1861.551660</span>] usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: New USB device found, idVendor<span style=color:#f92672>=</span><span style=color:#ae81ff>0951</span>, idProduct<span style=color:#f92672>=</span><span style=color:#ae81ff>1666</span>,
</span></span><span style=display:flex><span>bcdDevice<span style=color:#f92672>=</span> <span style=color:#ae81ff>1.10</span>
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1861.551663</span>] usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: New USB device strings: Mfr<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, Product<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>, SerialNumber<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1861.551664</span>] usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: Product: DataTraveler <span style=color:#ae81ff>3.0</span>
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1861.551665</span>] usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: Manufacturer: Kingston
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1861.551666</span>] usb <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>: SerialNumber: AC220B280A43B03189723CA0
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1861.568499</span>] usb<span style=color:#f92672>-</span>storage <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>:<span style=color:#ae81ff>1.0</span>: USB Mass Storage device detected
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1861.570443</span>] scsi host3: usb<span style=color:#f92672>-</span>storage <span style=color:#ae81ff>4</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>:<span style=color:#ae81ff>1.0</span>
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1861.570822</span>] usbcore: registered new interface driver usb<span style=color:#f92672>-</span>storage
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1861.574790</span>] usbcore: registered new interface driver uas
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1862.628850</span>] scsi <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: Direct<span style=color:#f92672>-</span>Access Kingston DataTraveler <span style=color:#ae81ff>3.0</span> PMAP
</span></span><span style=display:flex><span>PQ: <span style=color:#ae81ff>0</span> ANSI: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1862.631979</span>] sd <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: Attached scsi generic sg4 type <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1862.634222</span>] sd <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: [sdd] <span style=color:#ae81ff>60555264</span> <span style=color:#ae81ff>512</span><span style=color:#f92672>-</span>byte logical blocks: (<span style=color:#ae81ff>31.0</span> GB<span style=color:#f92672>/</span><span style=color:#ae81ff>28.9</span>
</span></span><span style=display:flex><span>GiB)
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1862.636424</span>] sd <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: [sdd] Write Protect is off
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1862.636429</span>] sd <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: [sdd] Mode Sense: <span style=color:#ae81ff>45</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1862.640597</span>] sd <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: [sdd] Write cache: disabled, read cache: enabled,
</span></span><span style=display:flex><span>doesn<span style=color:#e6db74>&#39;t support DPO or FUA</span>
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1862.650723</span>] sdd: sdd1
</span></span><span style=display:flex><span>[ <span style=color:#ae81ff>1862.656289</span>] sd <span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>0</span>: [sdd] Attached SCSI removable disk
</span></span></code></pre></div><p>范例：格式化U盘为 FAT32 文件系统</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#dnf -y install dosfstools</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#mkfs.vfat /dev/sdd1</span>
</span></span><span style=display:flex><span>mkfs<span style=color:#f92672>.</span>fat <span style=color:#ae81ff>4.1</span> (<span style=color:#ae81ff>2017</span><span style=color:#f92672>-</span><span style=color:#ae81ff>01</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span>)
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#mount /dev/sdd1 /mnt</span>
</span></span></code></pre></div><p>范例：查看USB设备</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#yum -y install usbutils
</span></span><span style=display:flex><span>[root@centos8 ~]#lsusb
</span></span><span style=display:flex><span>Bus 004 Device 002: ID 0951:1666 Kingston Technology DataTraveler 100 G3/G4/SE9
</span></span><span style=display:flex><span>G2
</span></span><span style=display:flex><span>Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
</span></span><span style=display:flex><span>Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</span></span><span style=display:flex><span>Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</span></span><span style=display:flex><span>Bus 002 Device 003: ID 0e0f:0002 VMware, Inc. Virtual USB Hub
</span></span><span style=display:flex><span>Bus 002 Device 002: ID 0e0f:0003 VMware, Inc. Virtual Mouse
</span></span><span style=display:flex><span>Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
</span></span></code></pre></div><h2 id=磁盘常见工具>磁盘常见工具
<a class=header-anchor href=#%e7%a3%81%e7%9b%98%e5%b8%b8%e8%a7%81%e5%b7%a5%e5%85%b7></a></h2><h3 id=文件系统空间实际真正占用等信息的查看工具-df>文件系统空间实际真正占用等信息的查看工具 df
<a class=header-anchor href=#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%a9%ba%e9%97%b4%e5%ae%9e%e9%99%85%e7%9c%9f%e6%ad%a3%e5%8d%a0%e7%94%a8%e7%ad%89%e4%bf%a1%e6%81%af%e7%9a%84%e6%9f%a5%e7%9c%8b%e5%b7%a5%e5%85%b7-df></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>df [OPTION]... [FILE]...
</span></span></code></pre></div><p>只能看到挂载的文件系统<br>常用选项</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>-H 以10为单位
</span></span><span style=display:flex><span>-T 文件系统类型
</span></span><span style=display:flex><span>-h human-readable
</span></span><span style=display:flex><span>-i inodes instead of blocks
</span></span><span style=display:flex><span>-P 以Posix兼容的格式输出
</span></span></code></pre></div><p>范例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#df -Th
</span></span><span style=display:flex><span>Filesystem Type Size Used Avail Use% Mounted on
</span></span><span style=display:flex><span>devtmpfs devtmpfs 887M 0 887M 0% /dev
</span></span><span style=display:flex><span>tmpfs tmpfs 903M 0 903M 0% /dev/shm
</span></span><span style=display:flex><span>tmpfs tmpfs 903M 8.7M 894M 1% /run
</span></span><span style=display:flex><span>tmpfs tmpfs 903M 0 903M 0% /sys/fs/cgroup
</span></span><span style=display:flex><span>/dev/sda2 xfs 100G 2.7G 98G 3% /
</span></span><span style=display:flex><span>/dev/sda3 xfs 50G 1.4G 49G 3% /data
</span></span><span style=display:flex><span>/dev/sda1 ext4 976M 128M 781M 15% /boot
</span></span><span style=display:flex><span>tmpfs tmpfs 181M 0 181M 0% /run/user/0
</span></span><span style=display:flex><span>[root@centos8 ~]#lsblk -f
</span></span><span style=display:flex><span>NAME FSTYPE LABEL UUID
</span></span><span style=display:flex><span>MOUNTPOINT
</span></span><span style=display:flex><span>sda
</span></span><span style=display:flex><span>├─sda1 ext4 5c2216e3-ae34-444e-aa60-83cbaebb47e7
</span></span><span style=display:flex><span>/boot
</span></span><span style=display:flex><span>├─sda2 xfs f7f53add-b184-4ddc-8d2c-5263b84d1e15 /
</span></span><span style=display:flex><span>├─sda3 xfs 9a2293a8-9277-4b18-bae1-498e0b9da145
</span></span><span style=display:flex><span>/data
</span></span><span style=display:flex><span>├─sda4
</span></span><span style=display:flex><span>├─sda5 swap eebe3bc7-6d52-4ad9-86aa-916f1a123fd4
</span></span><span style=display:flex><span>[SWAP]
</span></span><span style=display:flex><span>└─sda6
</span></span><span style=display:flex><span>sdb
</span></span><span style=display:flex><span>└─sdb1 ext4 /data/mysql cb7cae1e-d227-4f64-872b-cd6cce20c911
</span></span><span style=display:flex><span>sdc swap a3dc8863-b7a6-462b-a8e5-72d034a442de
</span></span><span style=display:flex><span>sr0 iso9660 CentOS-8-1-1911-x86_64-dvd 2020-01-03-21-42-40-00
</span></span></code></pre></div><h3 id=查看某目录总体空间实际占用状态-du>查看某目录总体空间实际占用状态 du
<a class=header-anchor href=#%e6%9f%a5%e7%9c%8b%e6%9f%90%e7%9b%ae%e5%bd%95%e6%80%bb%e4%bd%93%e7%a9%ba%e9%97%b4%e5%ae%9e%e9%99%85%e5%8d%a0%e7%94%a8%e7%8a%b6%e6%80%81-du></a></h3><p>显示指定目录下面各个子目录的大小,单位为KB</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>du [OPTION]... DIR
</span></span></code></pre></div><p>常用选项</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>-a --all 显示所有文件和目录的大小,默认只显示目录大小
</span></span><span style=display:flex><span>-h human-readable
</span></span><span style=display:flex><span>-s summary
</span></span><span style=display:flex><span>--max-depth=# 指定最大目录层级
</span></span><span style=display:flex><span>-x, --one-file-system #忽略不在同一个文件系统的目录
</span></span></code></pre></div><p>范例:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#du -sh /*</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>bin
</span></span><span style=display:flex><span><span style=color:#ae81ff>116</span>M <span style=color:#f92672>/</span>boot
</span></span><span style=display:flex><span><span style=color:#ae81ff>4.0</span>K <span style=color:#f92672>/</span>data
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>dev
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span>M <span style=color:#f92672>/</span>etc
</span></span><span style=display:flex><span><span style=color:#ae81ff>24</span>K <span style=color:#f92672>/</span>home
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>lib
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>lib64
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>media
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>misc
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>mnt
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>net
</span></span><span style=display:flex><span><span style=color:#ae81ff>12</span>K <span style=color:#f92672>/</span>opt
</span></span><span style=display:flex><span>du: cannot access <span style=color:#e6db74>&#39;/proc/1529/task/1529/fd/4&#39;</span>: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span>du: cannot access <span style=color:#e6db74>&#39;/proc/1529/task/1529/fdinfo/4&#39;</span>: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span>du: cannot access <span style=color:#e6db74>&#39;/proc/1529/fd/4&#39;</span>: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span>du: cannot access <span style=color:#e6db74>&#39;/proc/1529/fdinfo/4&#39;</span>: No such file <span style=color:#f92672>or</span> directory
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>proc
</span></span><span style=display:flex><span><span style=color:#ae81ff>197</span>M <span style=color:#f92672>/</span>root
</span></span><span style=display:flex><span><span style=color:#ae81ff>13</span>M <span style=color:#f92672>/</span>run
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>sbin
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>srv
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>sys
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>/</span>tmp
</span></span><span style=display:flex><span><span style=color:#ae81ff>1.7</span>G <span style=color:#f92672>/</span>usr
</span></span><span style=display:flex><span><span style=color:#ae81ff>138</span>M <span style=color:#f92672>/</span><span style=color:#66d9ef>var</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>centos8 <span style=color:#f92672>~</span>]<span style=color:#75715e>#du -h -x --max-depth=1 /</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>22</span>M <span style=color:#f92672>./</span>etc
</span></span><span style=display:flex><span><span style=color:#ae81ff>197</span>M <span style=color:#f92672>./</span>root
</span></span><span style=display:flex><span><span style=color:#ae81ff>138</span>M <span style=color:#f92672>./</span><span style=color:#66d9ef>var</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1.7</span>G <span style=color:#f92672>./</span>usr
</span></span><span style=display:flex><span><span style=color:#ae81ff>24</span>K <span style=color:#f92672>./</span>home
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>./</span>media
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>./</span>mnt
</span></span><span style=display:flex><span><span style=color:#ae81ff>12</span>K <span style=color:#f92672>./</span>opt
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>./</span>srv
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#f92672>./</span>tmp
</span></span><span style=display:flex><span><span style=color:#ae81ff>2.1</span>G 
</span></span></code></pre></div><h3 id=大厂面试题>大厂面试题:
<a class=header-anchor href=#%e5%a4%a7%e5%8e%82%e9%9d%a2%e8%af%95%e9%a2%98></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>df 和 du 区别,什么时候df &gt;du
</span></span><span style=display:flex><span>空分区
</span></span><span style=display:flex><span>df包含元数据
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>什么时候df &lt; du?
</span></span><span style=display:flex><span>目录内挂载有其它分区时的情况
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>当删除文件但不释放空间时,有什么不同?
</span></span><span style=display:flex><span>du 查看文件空间释放,df不释放
</span></span></code></pre></div><h3 id=工具-dd>工具 dd
<a class=header-anchor href=#%e5%b7%a5%e5%85%b7-dd></a></h3><p>dd 命令：convert and copy a file
格式：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>dd if=/PATH/FROM/SRC of=/PATH/TO/DEST bs=# count=#
</span></span></code></pre></div><p>常用选项</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>if=file 从所命名文件读取而不是从标准输入
</span></span><span style=display:flex><span>of=file 写到所命名的文件而不是到标准输出
</span></span><span style=display:flex><span>ibs=size 一次读size个byte
</span></span><span style=display:flex><span>obs=size 一次写size个byte
</span></span><span style=display:flex><span>bs=size block size, 指定块大小（既是是ibs也是obs)
</span></span><span style=display:flex><span>cbs=size 一次转化size个byte
</span></span><span style=display:flex><span>skip=blocks 从开头忽略blocks个ibs大小的块
</span></span><span style=display:flex><span>seek=blocks 从开头忽略blocks个obs大小的块
</span></span><span style=display:flex><span>count=n 复制n个bs
</span></span><span style=display:flex><span>conv=conversion[,conversion...] 用指定的参数转换文件
</span></span><span style=display:flex><span>#conversion 转换参数:
</span></span><span style=display:flex><span>ascii 转换 EBCDIC 为 ASCII
</span></span><span style=display:flex><span>ebcdic 转换 ASCII 为 EBCDIC
</span></span><span style=display:flex><span>lcase 把大写字符转换为小写字符
</span></span><span style=display:flex><span>ucase 把小写字符转换为大写字符
</span></span><span style=display:flex><span>nocreat 不创建输出文件
</span></span><span style=display:flex><span>noerror 出错时不停止
</span></span><span style=display:flex><span>notrunc 不截短输出文件
</span></span><span style=display:flex><span>sync 把每个输入块填充到ibs个字节，不足部分用空(NUL)字符补齐
</span></span><span style=display:flex><span>fdatasync 写完成前，物理写入输出文件
</span></span></code></pre></div><p>范例:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#cat f1.txt;
</span></span><span style=display:flex><span>abcdef
</span></span><span style=display:flex><span>[root@centos8 ~]#cat f2.txt
</span></span><span style=display:flex><span>123456789
</span></span><span style=display:flex><span>[root@centos8 ~]#dd if=f1.txt of=f2.txt bs=1 count=2 skip=3 seek=4
</span></span><span style=display:flex><span>2+0 records in
</span></span><span style=display:flex><span>2+0 records out
</span></span><span style=display:flex><span>2 bytes copied, 6.6515e-05 s, 30.1 kB/s
</span></span><span style=display:flex><span>[root@centos8 ~]#cat f2.txt
</span></span><span style=display:flex><span>1234de[root@centos8 ~]#echo 123456789 &gt; f2.txt
</span></span><span style=display:flex><span>[root@centos8 ~]#cat f2.txt
</span></span><span style=display:flex><span>123456789
</span></span><span style=display:flex><span>[root@centos8 ~]#cat f1.txt
</span></span><span style=display:flex><span>abcdef
</span></span><span style=display:flex><span>[root@centos8 ~]#cat f1.txt; cat f2.txt
</span></span><span style=display:flex><span>abcdef
</span></span><span style=display:flex><span>123456789
</span></span><span style=display:flex><span>[root@centos8 ~]#dd if=f1.txt of=f2.txt bs=1 count=2 skip=3 seek=4 conv=notrunc
</span></span><span style=display:flex><span>2+0 records in
</span></span><span style=display:flex><span>2+0 records out
</span></span><span style=display:flex><span>2 bytes copied, 7.6153e-05 s, 26.3 kB/s
</span></span><span style=display:flex><span>[root@centos8 ~]#cat f2.txt
</span></span><span style=display:flex><span>1234de789
</span></span></code></pre></div><p>范例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span><span style=color:#75715e>#备份MBR</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>sda of<span style=color:#f92672>=/</span>tmp<span style=color:#f92672>/</span>mbr<span style=color:#f92672>.</span>bak bs<span style=color:#f92672>=</span><span style=color:#ae81ff>512</span> count<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#破坏MBR中的bootloader</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>zero of<span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>sda bs<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> count<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> seek<span style=color:#f92672>=</span><span style=color:#ae81ff>446</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#有一个大与2K的二进制文件fileA。现在想从第64个字节位置开始读取，需要读取的大小是128Byts。又有</span>
</span></span><span style=display:flex><span>fileB, <span style=color:#960050;background-color:#1e0010>想把上面读取到的</span><span style=color:#ae81ff>128</span>Bytes写到第32个字节开始的位置<span style=color:#960050;background-color:#1e0010>，替换</span><span style=color:#ae81ff>128</span>Bytes<span style=color:#960050;background-color:#1e0010>，实现如下</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>fileA of<span style=color:#f92672>=</span>fileB bs<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> count<span style=color:#f92672>=</span><span style=color:#ae81ff>128</span> skip<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> seek<span style=color:#f92672>=</span><span style=color:#ae81ff>31</span> conv<span style=color:#f92672>=</span>notrunc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#将本地的/dev/sdx整盘备份到/dev/sdy</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>sdx of<span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>sdy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#将/dev/sdx全盘数据备份到指定路径的image文件</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>sdx of<span style=color:#f92672>=/</span>path<span style=color:#f92672>/</span>to<span style=color:#f92672>/</span>image
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#备份/dev/sdx全盘数据，并利用gzip压缩，保存到指定路径</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>sdx <span style=color:#f92672>|</span> gzip <span style=color:#f92672>&gt;/</span>path<span style=color:#f92672>/</span>to<span style=color:#f92672>/</span>image<span style=color:#f92672>.</span>gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#将备份文件恢复到指定盘</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>path<span style=color:#f92672>/</span>to<span style=color:#f92672>/</span>image of<span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>sdx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#将压缩的备份文件恢复到指定盘</span>
</span></span><span style=display:flex><span>gzip <span style=color:#f92672>-</span>dc <span style=color:#f92672>/</span>path<span style=color:#f92672>/</span>to<span style=color:#f92672>/</span>image<span style=color:#f92672>.</span>gz <span style=color:#f92672>|</span> dd of<span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>sdx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#将内存里的数据拷贝到root目录下的mem.bin文件</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>mem of<span style=color:#f92672>=/</span>root<span style=color:#f92672>/</span>mem<span style=color:#f92672>.</span>bin bs<span style=color:#f92672>=</span><span style=color:#ae81ff>1024</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#拷贝光盘数据到root文件夹下，并保存为cdrom.iso文件</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>cdrom of<span style=color:#f92672>=/</span>root<span style=color:#f92672>/</span>cdrom<span style=color:#f92672>.</span>iso
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#销毁磁盘数据</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>urandom of<span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>sda1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#通过比较dd指令输出中命令的执行时间，即可确定系统最佳的block size大小</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>zero of<span style=color:#f92672>=/</span>root<span style=color:#f92672>/</span><span style=color:#ae81ff>1</span>Gb<span style=color:#f92672>.</span>file bs<span style=color:#f92672>=</span><span style=color:#ae81ff>1024</span> count<span style=color:#f92672>=</span><span style=color:#ae81ff>1000000</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>zero of<span style=color:#f92672>=/</span>root<span style=color:#f92672>/</span><span style=color:#ae81ff>1</span>Gb<span style=color:#f92672>.</span>file bs<span style=color:#f92672>=</span><span style=color:#ae81ff>2048</span> count<span style=color:#f92672>=</span><span style=color:#ae81ff>500000</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>zero of<span style=color:#f92672>=/</span>root<span style=color:#f92672>/</span><span style=color:#ae81ff>1</span>Gb<span style=color:#f92672>.</span>file bs<span style=color:#f92672>=</span><span style=color:#ae81ff>4096</span> count<span style=color:#f92672>=</span><span style=color:#ae81ff>250000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#测试硬盘写速度</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>zero of<span style=color:#f92672>=/</span>root<span style=color:#f92672>/</span><span style=color:#ae81ff>1</span>Gb<span style=color:#f92672>.</span>file bs<span style=color:#f92672>=</span><span style=color:#ae81ff>1024</span> count<span style=color:#f92672>=</span><span style=color:#ae81ff>1000000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#测试硬盘读速度</span>
</span></span><span style=display:flex><span>dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=/</span>root<span style=color:#f92672>/</span><span style=color:#ae81ff>1</span>Gb<span style=color:#f92672>.</span>file bs<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span>k <span style=color:#f92672>|</span> dd of<span style=color:#f92672>=/</span>dev<span style=color:#f92672>/</span>null
</span></span></code></pre></div><h3 id=练习>练习
<a class=header-anchor href=#%e7%bb%83%e4%b9%a0></a></h3><p>1、创建一个2G的文件系统，块大小为2048byte，预留1%可用空间,文件系统ext4，卷标为TEST，要求
此分区开机后自动挂载至/test目录，且默认有acl挂载选项<br>2、写一个脚本，完成如下功能：<br>(1) 列出当前系统识别到的所有磁盘设备<br>(2) 如磁盘数量为1，则显示其空间使用信息</p><h2 id=raid>RAID
<a class=header-anchor href=#raid></a></h2><p>RAID功能实现<br>提高IO能力,磁盘并行读写<br>提高耐用性,磁盘冗余算法来实现<br>RAID实现的方式<br>外接式磁盘阵列：通过扩展卡提供适配能力<br>内接式RAID：主板集成RAID控制器，安装OS前在BIOS里配置<br>软件RAID：通过OS实现，比如：群晖的NAS</p><h3 id=raid级别>RAID级别
<a class=header-anchor href=#raid%e7%ba%a7%e5%88%ab></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>级别：多块磁盘组织在一起的工作方式有所不同  
</span></span><span style=display:flex><span>参考链接: https://zh.wikipedia.org/wiki/RAID  
</span></span><span style=display:flex><span>RAID-0：条带卷，strip  
</span></span><span style=display:flex><span>RAID-1：镜像卷，mirror  
</span></span><span style=display:flex><span>RAID-2  
</span></span><span style=display:flex><span>......  
</span></span><span style=display:flex><span>RAID-5  
</span></span><span style=display:flex><span>RAID-6  
</span></span><span style=display:flex><span>RAID-7  
</span></span><span style=display:flex><span>RAID-10 
</span></span><span style=display:flex><span>RAID-01  
</span></span><span style=display:flex><span>RAID-50  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RAID-0
</span></span><span style=display:flex><span>读、写性能提升
</span></span><span style=display:flex><span>可用空间：N*min(S1,S2,...)
</span></span><span style=display:flex><span>无容错能力
</span></span><span style=display:flex><span>最少磁盘数：1+
</span></span><span style=display:flex><span>RAID-1
</span></span><span style=display:flex><span>读性能提升、写性能略有下降
</span></span><span style=display:flex><span>可用空间：1*min(S1,S2,...)
</span></span><span style=display:flex><span>磁盘利用率 50%
</span></span><span style=display:flex><span>有冗余能力
</span></span><span style=display:flex><span>最少磁盘数：2+
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RAID-4
</span></span><span style=display:flex><span>多块数据盘异或运算值存于专用校验盘
</span></span><span style=display:flex><span>磁盘利用率 (N-1)/N
</span></span><span style=display:flex><span>有冗余能力
</span></span><span style=display:flex><span>至少3块硬盘才可以实现
</span></span><span style=display:flex><span>RAID-5 
</span></span><span style=display:flex><span>读、写性能提升
</span></span><span style=display:flex><span>可用空间：(N-1)*min(S1,S2,...)
</span></span><span style=display:flex><span>有容错能力：允许最多1块磁盘损坏
</span></span><span style=display:flex><span>最少磁盘数：3, 3+
</span></span><span style=display:flex><span>RAID-6
</span></span><span style=display:flex><span>双份校验位,算法更复杂
</span></span><span style=display:flex><span>读、写性能提升
</span></span><span style=display:flex><span>可用空间：(N-2)*min(S1,S2,...)
</span></span><span style=display:flex><span>有容错能力：允许最多2块磁盘损坏
</span></span><span style=display:flex><span>最少磁盘数：4, 4+
</span></span><span style=display:flex><span>RAID-10  比RAID01更好， 1/3
</span></span><span style=display:flex><span>读、写性能提升
</span></span><span style=display:flex><span>可用空间：N*min(S1,S2,...)/2
</span></span><span style=display:flex><span>有容错能力：每组镜像最多只能坏一块
</span></span><span style=display:flex><span>最少磁盘数：4, 4+
</span></span><span style=display:flex><span>RAID-01  2/3
</span></span><span style=display:flex><span>多块磁盘先实现RAID0,再组合成RAID1
</span></span></code></pre></div><h2 id=逻辑卷管理器lvm>逻辑卷管理器（LVM）
<a class=header-anchor href=#%e9%80%bb%e8%be%91%e5%8d%b7%e7%ae%a1%e7%90%86%e5%99%a8lvm></a></h2><h3 id=lvm介绍>LVM介绍
<a class=header-anchor href=#lvm%e4%bb%8b%e7%bb%8d></a></h3><p><a href=http://www.178linux.com/74565 title=LVM基础http://www.178linux.com/74565 rel="noopener external nofollow noreferrer" target=_blank class=exturl>LVM基础http://www.178linux.com/74565
<i class="fa fa-external-link-alt"></i></a><br>VM: Logical Volume Manager 可以允许对卷进行方便操作的抽象层，包括重新设定文件系统的大小，
允许在多个物理设备间重新组织文件系统<br>LVM可以弹性的更改LVM的容量<br>通过交换PE来进行资料的转换，将原来LV内的PE转移到其他的设备中以降低LV的容量，或将其他设备
中的PE加到LV中以加大容量<br>实现过程</p><ul><li>将设备指定为物理卷</li><li>用一个或者多个物理卷来创建一个卷组，物理卷是用固定大小的物理区域（Physical Extent，
PE）来定义的</li><li>在物理卷上创建的逻辑卷， 是由物理区域（PE）组成</li><li>可以在逻辑卷上创建文件系统并挂载<br><img src=/imgs/img-lazy-loading.gif data-src=/images/url/linux/linux09/08.jpg alt></li></ul><p>第一个逻辑卷对应设备名：/dev/dm-#<br>dm: device mapper，将一个或多个底层块设备组织成一个逻辑设备的模块<br>软链接：</p><ul><li>/dev/mapper/VG_NAME-LV_NAME</li><li>/dev/VG_NAME/LV_NAME
范例</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>/dev/mapper/vol0-root
</span></span><span style=display:flex><span>/dev/vol0/root
</span></span></code></pre></div><h2 id=实现逻辑卷>实现逻辑卷
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e9%80%bb%e8%be%91%e5%8d%b7></a></h2><p>相关工具来自于 lvm2 包</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#yum -y install lvm2
</span></span></code></pre></div><p>范例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@localhost ~]# lsblk
</span></span><span style=display:flex><span>NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
</span></span><span style=display:flex><span>sda           8:0    0   20G  0 disk
</span></span><span style=display:flex><span>└─sda1        8:1    0    5G  0 part
</span></span><span style=display:flex><span>sdb           8:16   0   10G  0 disk
</span></span><span style=display:flex><span>sr0          11:0    1  1.8G  0 rom
</span></span><span style=display:flex><span>nvme0n1     259:0    0  200G  0 disk
</span></span><span style=display:flex><span>├─nvme0n1p1 259:1    0    1G  0 part /boot
</span></span><span style=display:flex><span>└─nvme0n1p2 259:2    0  199G  0 part
</span></span><span style=display:flex><span>  ├─rl-root 253:0    0   70G  0 lvm  /
</span></span><span style=display:flex><span>  ├─rl-swap 253:1    0    2G  0 lvm  [SWAP]
</span></span><span style=display:flex><span>  └─rl-home 253:2    0  127G  0 lvm  /home
</span></span><span style=display:flex><span>[root@localhost ~]# pvs  查看物理卷
</span></span><span style=display:flex><span>  PV             VG Fmt  Attr PSize    PFree
</span></span><span style=display:flex><span>  /dev/nvme0n1p2 rl lvm2 a--  &lt;199.00g    0
</span></span><span style=display:flex><span>[root@localhost ~]# pvcreate /dev/sdb /dev/sda1   创建物理卷，可一步可两步。
</span></span><span style=display:flex><span>WARNING: ext4 signature detected on /dev/sda1 at offset 1080. Wipe it? [y/n]: y
</span></span><span style=display:flex><span>  Wiping ext4 signature on /dev/sda1.
</span></span><span style=display:flex><span>  Physical volume &#34;/dev/sdb&#34; successfully created.
</span></span><span style=display:flex><span>  Physical volume &#34;/dev/sda1&#34; successfully created.
</span></span><span style=display:flex><span>[root@localhost ~]# vgs
</span></span><span style=display:flex><span>  VG #PV #LV #SN Attr   VSize    VFree
</span></span><span style=display:flex><span>  rl   1   3   0 wz--n- &lt;199.00g    0
</span></span><span style=display:flex><span>[root@localhost ~]# vgcreate -s 4M testvg0 /dev/sdb /dev/sda1      创建逻辑卷组（包括了两个物理卷） -s 4M 指定PW Size大小
</span></span><span style=display:flex><span>  Volume group &#34;testvg0&#34; successfully created
</span></span><span style=display:flex><span>[root@localhost ~]# vgdisplay
</span></span><span style=display:flex><span>  --- Volume group ---
</span></span><span style=display:flex><span>  VG Name               rl
</span></span><span style=display:flex><span>  System ID
</span></span><span style=display:flex><span>  Format                lvm2
</span></span><span style=display:flex><span>  Metadata Areas        1
</span></span><span style=display:flex><span>  Metadata Sequence No  4
</span></span><span style=display:flex><span>  VG Access             read/write
</span></span><span style=display:flex><span>  VG Status             resizable
</span></span><span style=display:flex><span>  MAX LV                0
</span></span><span style=display:flex><span>  Cur LV                3
</span></span><span style=display:flex><span>  Open LV               3
</span></span><span style=display:flex><span>  Max PV                0
</span></span><span style=display:flex><span>  Cur PV                1
</span></span><span style=display:flex><span>  Act PV                1
</span></span><span style=display:flex><span>  VG Size               &lt;199.00 GiB
</span></span><span style=display:flex><span>  PE Size               4.00 MiB
</span></span><span style=display:flex><span>  Total PE              50943
</span></span><span style=display:flex><span>  Alloc PE / Size       50943 / &lt;199.00 GiB
</span></span><span style=display:flex><span>  Free  PE / Size       0 / 0
</span></span><span style=display:flex><span>  VG UUID               knhB0W-gb2s-ZWFT-jSeN-adeV-rukB-jatNJr
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  --- Volume group ---
</span></span><span style=display:flex><span>  VG Name               testvg0
</span></span><span style=display:flex><span>  System ID
</span></span><span style=display:flex><span>  Format                lvm2
</span></span><span style=display:flex><span>  Metadata Areas        2
</span></span><span style=display:flex><span>  Metadata Sequence No  1
</span></span><span style=display:flex><span>  VG Access             read/write
</span></span><span style=display:flex><span>  VG Status             resizable
</span></span><span style=display:flex><span>  MAX LV                0
</span></span><span style=display:flex><span>  Cur LV                0
</span></span><span style=display:flex><span>  Open LV               0
</span></span><span style=display:flex><span>  Max PV                0
</span></span><span style=display:flex><span>  Cur PV                2
</span></span><span style=display:flex><span>  Act PV                2
</span></span><span style=display:flex><span>  VG Size               14.99 GiB
</span></span><span style=display:flex><span>  PE Size               4.00 MiB
</span></span><span style=display:flex><span>  Total PE              3838
</span></span><span style=display:flex><span>  Alloc PE / Size       0 / 0
</span></span><span style=display:flex><span>  Free  PE / Size       3838 / 14.99 GiB
</span></span><span style=display:flex><span>  VG UUID               4alfMP-1eeI-rept-aL8k-J6OL-aUhZ-18lNrf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@localhost ~]# pvs
</span></span><span style=display:flex><span>  PV             VG      Fmt  Attr PSize    PFree
</span></span><span style=display:flex><span>  /dev/nvme0n1p2 rl      lvm2 a--  &lt;199.00g      0
</span></span><span style=display:flex><span>  /dev/sda1      testvg0 lvm2 a--    &lt;5.00g  &lt;5.00g
</span></span><span style=display:flex><span>  /dev/sdb       testvg0 lvm2 a--   &lt;10.00g &lt;10.00g
</span></span><span style=display:flex><span>[root@localhost ~]# lvcreate  -L 6G -n mysql testvg0  创建指定大小的逻辑卷，不能超过VG Size  14.99 GiB
</span></span><span style=display:flex><span>  Logical volume &#34;mysql&#34; created.
</span></span><span style=display:flex><span>[root@localhost ~]# lvs
</span></span><span style=display:flex><span>  LV    VG      Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
</span></span><span style=display:flex><span>  home  rl      -wi-ao---- 126.98g
</span></span><span style=display:flex><span>  root  rl      -wi-ao----  70.00g
</span></span><span style=display:flex><span>  swap  rl      -wi-ao----  &lt;2.02g
</span></span><span style=display:flex><span>  mysql testvg0 -wi-a-----   6.00g
</span></span><span style=display:flex><span>[root@localhost ~]# ll /d
</span></span><span style=display:flex><span>data/ dev/
</span></span><span style=display:flex><span>[root@localhost ~]# ll /dev/testvg0/mysql
</span></span><span style=display:flex><span>lrwxrwxrwx. 1 root root 7 Dec 17 16:11 /dev/testvg0/mysql -&gt; ../dm-3
</span></span><span style=display:flex><span>[root@localhost ~]# ll /dev//dm*
</span></span><span style=display:flex><span>brw-rw----. 1 root disk  253, 0 Dec 17 14:05 /dev//dm-0
</span></span><span style=display:flex><span>brw-rw----. 1 root disk  253, 1 Dec 17 14:05 /dev//dm-1
</span></span><span style=display:flex><span>brw-rw----. 1 root disk  253, 2 Dec 17 14:05 /dev//dm-2
</span></span><span style=display:flex><span>brw-rw----. 1 root disk  253, 3 Dec 17 16:11 /dev//dm-3
</span></span><span style=display:flex><span>crw-rw----. 1 root audio  14, 9 Dec 17 14:05 /dev//dmmidi
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/dev//dma_heap:
</span></span><span style=display:flex><span>total 0
</span></span><span style=display:flex><span>crw-------. 1 root root 251, 0 Dec 17 14:05 system
</span></span><span style=display:flex><span>[root@localhost ~]# mkfs.ext4 /dev/testvg0/mysql          创建文件系统后即可挂载
</span></span><span style=display:flex><span>mke2fs 1.46.5 (30-Dec-2021)
</span></span><span style=display:flex><span>Creating filesystem with 1572864 4k blocks and 393216 inodes
</span></span><span style=display:flex><span>Filesystem UUID: 8e93d6b1-0055-4d4d-9fe9-a965a5270735
</span></span><span style=display:flex><span>Superblock backups stored on blocks:
</span></span><span style=display:flex><span>        32768, 98304, 163840, 229376, 294912, 819200, 884736
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Allocating group tables: done
</span></span><span style=display:flex><span>Writing inode tables: done
</span></span><span style=display:flex><span>Creating journal (16384 blocks): done
</span></span><span style=display:flex><span>Writing superblocks and filesystem accounting information: done
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># vim /etc/fstab</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>mapper<span style=color:#f92672>/</span>rl<span style=color:#f92672>-</span>root     <span style=color:#f92672>/</span>                       xfs     defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>UUID<span style=color:#f92672>=</span>dd377e35<span style=color:#f92672>-</span>a149<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>f7d<span style=color:#f92672>-</span>a9c9<span style=color:#f92672>-</span>ca32c66fc90e <span style=color:#f92672>/</span>boot                   xfs     defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>mapper<span style=color:#f92672>/</span>rl<span style=color:#f92672>-</span>home     <span style=color:#f92672>/</span>home                   xfs     defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>mapper<span style=color:#f92672>/</span>rl<span style=color:#f92672>-</span>swap     none                    swap    defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>UUID<span style=color:#f92672>=</span><span style=color:#ae81ff>8e93</span>d6b1<span style=color:#f92672>-</span><span style=color:#ae81ff>0055</span><span style=color:#f92672>-</span><span style=color:#ae81ff>4</span>d4d<span style=color:#f92672>-</span><span style=color:#ae81ff>9</span>fe9<span style=color:#f92672>-</span>a965a5270735  <span style=color:#f92672>/</span>data<span style=color:#f92672>/</span>mysql  ext4 defaults <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># mkdir /data/mysql</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># mount -a</span>
</span></span><span style=display:flex><span>mount: (hint) your fstab has been modified, but systemd still uses
</span></span><span style=display:flex><span>       the old version; use <span style=color:#e6db74>&#39;systemctl daemon-reload&#39;</span> to reload<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># df -h</span>
</span></span><span style=display:flex><span>Filesystem                 Size  Used Avail Use<span style=color:#f92672>%</span> Mounted on
</span></span><span style=display:flex><span>devtmpfs                   <span style=color:#ae81ff>4.0</span>M     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>4.0</span>M   <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>dev
</span></span><span style=display:flex><span>tmpfs                      <span style=color:#ae81ff>871</span>M     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>871</span>M   <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>shm
</span></span><span style=display:flex><span>tmpfs                      <span style=color:#ae81ff>349</span>M  <span style=color:#ae81ff>5.2</span>M  <span style=color:#ae81ff>344</span>M   <span style=color:#ae81ff>2</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>run
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>mapper<span style=color:#f92672>/</span>rl<span style=color:#f92672>-</span>root         <span style=color:#ae81ff>70</span>G  <span style=color:#ae81ff>2.1</span>G   <span style=color:#ae81ff>68</span>G   <span style=color:#ae81ff>3</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>nvme0n1p1             <span style=color:#ae81ff>960</span>M  <span style=color:#ae81ff>305</span>M  <span style=color:#ae81ff>656</span>M  <span style=color:#ae81ff>32</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>boot
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>mapper<span style=color:#f92672>/</span>rl<span style=color:#f92672>-</span>home        <span style=color:#ae81ff>127</span>G  <span style=color:#ae81ff>939</span>M  <span style=color:#ae81ff>127</span>G   <span style=color:#ae81ff>1</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>home
</span></span><span style=display:flex><span>tmpfs                      <span style=color:#ae81ff>175</span>M     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>175</span>M   <span style=color:#ae81ff>0</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>run<span style=color:#f92672>/</span>user<span style=color:#f92672>/</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>mapper<span style=color:#f92672>/</span>testvg0<span style=color:#f92672>-</span>mysql  <span style=color:#ae81ff>5.9</span>G   <span style=color:#ae81ff>24</span>K  <span style=color:#ae81ff>5.6</span>G   <span style=color:#ae81ff>1</span><span style=color:#f92672>%</span> <span style=color:#f92672>/</span>data<span style=color:#f92672>/</span>mysql
</span></span></code></pre></div><h3 id=pv管理工具>pv管理工具
<a class=header-anchor href=#pv%e7%ae%a1%e7%90%86%e5%b7%a5%e5%85%b7></a></h3><p>显示pv信息</p><p><code>pvs</code> 用于显示 LVM（逻辑卷管理）物理卷的简略信息的命令。与 pvdisplay 相比，pvs 提供的信息更为简洁，通常只包括物理卷的名称、大小和所属的卷组（VG）。<br><code>pvdisplay</code> 用于显示 LVM（逻辑卷管理）物理卷属性的命令。</p><h4 id=创建pv>创建pv
<a class=header-anchor href=#%e5%88%9b%e5%bb%bapv></a></h4><p>pvcreate用于将物理磁盘分区初始化为 LVM（逻辑卷管理）物理卷的命令。这个命令通常在设置 LVM 存储时使用，作为创建逻辑卷的第一步。<br>范例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>pvcreate /dev/DEVICE
</span></span></code></pre></div><h4 id=删除pv>删除pv
<a class=header-anchor href=#%e5%88%a0%e9%99%a4pv></a></h4><p>pvremove 是一个用于从 LVM（逻辑卷管理）中移除物理卷的命令。这个命令通常在不再需要某个物理卷作为 LVM 存储的一部分时使用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>pvremove /dev/DEVICE
</span></span></code></pre></div><h3 id=vg管理工具>vg管理工具
<a class=header-anchor href=#vg%e7%ae%a1%e7%90%86%e5%b7%a5%e5%85%b7></a></h3><h4 id=显示卷组>显示卷组
<a class=header-anchor href=#%e6%98%be%e7%a4%ba%e5%8d%b7%e7%bb%84></a></h4><p><code>vgs</code> vgs 是一个用于显示 LVM（逻辑卷管理）卷组的简略信息的命令。这个命令提供的信息包括卷组的名称、大小、可用空间、物理卷（PV）的数量以及逻辑卷（LV）的数量。</p><p><code>vgdisplay</code> vgdisplay 是一个用于显示 LVM（逻辑卷管理）卷组的详细信息的命令。这个命令提供的信息包括卷组的名称、ID、状态、大小、可用空间、物理卷（PV）的数量、逻辑卷（LV）的数量以及每个物理卷的详细信息。</p><h4 id=创建卷组>创建卷组
<a class=header-anchor href=#%e5%88%9b%e5%bb%ba%e5%8d%b7%e7%bb%84></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>vgcreate [-s #[kKmMgGtTpPeE]] VolumeGroupName PhysicalDevicePath
</span></span><span style=display:flex><span>[PhysicalDevicePath...]
</span></span><span style=display:flex><span>#示例
</span></span><span style=display:flex><span>vgcreate -s 16M vg0 /dev/sdb /dev/sdc #指定PE的大小,默认4M
</span></span></code></pre></div><h4 id=管理卷组>管理卷组
<a class=header-anchor href=#%e7%ae%a1%e7%90%86%e5%8d%b7%e7%bb%84></a></h4><p><code>vgextend</code> 是一个用于扩展 LVM（逻辑卷管理）卷组的命令。这个命令允许你向已经存在的卷组中添加一个或多个物理卷（PV），从而增加卷组的总大小。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>vgextend VolumeGroupName PhysicalDevicePath [PhysicalDevicePath...]
</span></span><span style=display:flex><span>vgreduce VolumeGroupName PhysicalDevicePath [PhysicalDevicePath...]
</span></span></code></pre></div><ul><li>VolumeGroupName：这是你想要扩展的卷组的名称。</li><li>PhysicalDevicePath：这是你想要添加到卷组中的一个或多个物理卷的设备路径。
例如，如果你有一个名为 vg_data 的卷组，并且想要将 /dev/sdd1 和 /dev/sde1 两个物理卷添加到这个卷组中，你可以使用以下命令：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>vgextend vg_data /dev/sdd1 /dev/sde1
</span></span></code></pre></div><p>在执行 vgextend 命令之前，你需要确保这些物理卷已经被初始化（使用 pvcreate 命令），并且没有被包含在任何其他卷组中。此外，对磁盘进行操作通常需要管理员权限（root）
删除卷组</p><ul><li>先做pvmove</li><li>再做vgremove</li></ul><h3 id=lv管理工具>lv管理工具
<a class=header-anchor href=#lv%e7%ae%a1%e7%90%86%e5%b7%a5%e5%85%b7></a></h3><h4 id=显示逻辑卷>显示逻辑卷
<a class=header-anchor href=#%e6%98%be%e7%a4%ba%e9%80%bb%e8%be%91%e5%8d%b7></a></h4><p><code>lvs</code> 是一个用于显示 LVM（逻辑卷管理）逻辑卷的简略信息的命令。这个命令提供的信息包括逻辑卷的名称、卷组（VG）的名称、大小、设备文件路径以及状态。
<code>Lvdisplay </code>是一个在Linux系统中用于显示逻辑卷（Logical Volume，LV）信息的命令。逻辑卷是在逻辑卷管理器（Logical Volume Manager，LVM）中创建的，它允许系统管理员更灵活地管理磁盘空间。<br>当执行 lvdisplay 命令时，它会列出所有逻辑卷的详细信息，包括但不限于：</p><ul><li>LV Path：逻辑卷的设备路径，通常位于 /dev/mapper/ 或 /dev/ 目录下。</li><li>LV Name：逻辑卷的名称。</li><li>VG Name：包含该逻辑卷的卷组（Volume Group，VG）的名称。</li><li>LV UUID：逻辑卷的唯一标识符。</li><li>LV Write Access：逻辑卷的写入权限，通常为 read/write（可读可写）。</li><li>LV Creation host, time：创建逻辑卷的主机名和时间。</li><li>LV Status：逻辑卷的状态，例如 available（可用）、inactive（未激活）等。</li><li># open：当前打开该逻辑卷的次数。</li><li>LV Size：逻辑卷的大小。</li><li>Current LE：逻辑卷当前使用的逻辑扩展（Logical Extents，LE）数量。</li><li>Segments：逻辑卷包含的段数。</li><li>Allocation：逻辑卷的分配策略。</li><li>Read ahead sectors：预读扇区的数量，用于优化磁盘读取性能。</li><li>Block device：与逻辑卷关联的块设备号。</li></ul><h4 id=创建逻辑卷>创建逻辑卷
<a class=header-anchor href=#%e5%88%9b%e5%bb%ba%e9%80%bb%e8%be%91%e5%8d%b7></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>lvcreate -L #[mMgGtT] -n NAME VolumeGroup
</span></span></code></pre></div><ul><li>-L：指定逻辑卷的大小。# 表示大小数字，后面可以跟着单位，如 m（兆字节），M（兆兆字节），g（千兆字节），G（千千兆字节），t（太字节），T（太兆字节）。如果不指定单位，默认为兆字节（MB）。</li><li>-n：指定逻辑卷的名称。NAME 是你想要给逻辑卷命名的名称。</li><li>VolumeGroup：指定逻辑卷所属的卷组名称。卷组是在物理卷（Physical Volume，PV）之上创建的，逻辑卷必须属于一个卷组。
范例：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>lvcreate -l 60%VG -n mylv testvg        -l 60%VG：这个选项指定了新逻辑卷的大小。60%VG 表示新逻辑卷将占用指定卷组（VG）总空间的60%。这里的 %VG 表示百分比，即相对于卷组的总空间。
</span></span><span style=display:flex><span>lvcreate -l 100%FREE -n yourlv testvg   -l 100%FREE：这个选项指定新逻辑卷的大小为卷组中所有可用空间的大小。100%FREE 表示使用卷组中所有剩余的可用空间。
</span></span></code></pre></div><h4 id=删除逻辑卷>删除逻辑卷
<a class=header-anchor href=#%e5%88%a0%e9%99%a4%e9%80%bb%e8%be%91%e5%8d%b7></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>lvremove /dev/VG_NAME/LV_NAME
</span></span></code></pre></div><p>在执行 lvremove 命令之前，确保已经卸载了该逻辑卷，并且没有其他应用程序正在使用它，否则删除操作可能会失败。此外，这是一个破坏性的操作，一旦逻辑卷被删除，存储在其中的所有数据将会丢失，因此执行此命令前务必谨慎。</p><h4 id=重设文件系统大小>重设文件系统大小
<a class=header-anchor href=#%e9%87%8d%e8%ae%be%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e5%a4%a7%e5%b0%8f></a></h4><p><code>fsadm [options] resize device [new_size[BKMGTEP]]</code></p><p>fsadm 是一个用于调整文件系统大小的工具。命令 fsadm [options] resize device [new_size[BKMGTEP]] 的含义如下：</p><ul><li>fsadm：这是命令的名称，用于调整文件系统的大小。</li><li>[options]：这里可以指定一些可选的参数，例如 -y 表示自动回答 yes，跳过确认提示。</li><li>resize：这是 fsadm 的子命令，用于调整文件系统的大小。</li><li>device：这是要调整大小的文件系统的设备文件路径，例如 /dev/sda1。</li><li>[new_size[BKMGTEP]]：这是可选的新文件系统大小，可以指定为字节（B）、千字节（K）、兆字节（M）、吉字节（G）、太字节（T）、艾字节（E）或拍字节（P）。如果不指定大小，fsadm 将尝试将文件系统扩展到设备的最大可用空间。</li></ul><p><code>resize2fs [-f] [-F] [-M] [-P] [-p] device [new_size]</code></p><p>resize2fs 是一个在Linux系统中用于调整ext2, ext3, 或 ext4文件系统大小的工具。这个命令的各个部分意义如下：</p><ul><li>resize2fs：这是调整文件系统大小的命令。</li><li>-f：强制执行文件系统大小调整，即使文件系统处于挂载状态。</li><li>-F：重新启动 resize2fs 进程，即使它已经运行。</li><li>-M：将文件系统缩减到最小大小。</li><li>-P：打印出文件系统的最小和最大允许大小，但不实际调整大小。</li><li>-p：在调整大小的过程中打印进度信息。</li><li>device：要调整大小的文件系统的设备文件，例如 /dev/sda1。</li><li>[new_size]：可选参数，指定新的文件系统大小。如果不提供这个参数，resize2fs 会将文件系统扩展到设备上的所有可用空间。
<code>xfs_growfs /mountpoint</code></li></ul><p>xfs_growfs 是一个用于调整 XFS 文件系统大小的工具。命令 xfs_growfs /mountpoint 的含义如下：</p><ul><li>xfs_growfs：这是命令的名称，用于调整 XFS 文件系统的大小。</li><li>/mountpoint：这是文件系统挂载点的路径，例如 / 或 /home。
例如，如果你想要调整挂载在 / 的 XFS 文件系统的大小，使其使用设备的100g空间，你可以使用以下命令：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>xfs_repair -i -s size=100G /dev/device
</span></span></code></pre></div><p><code>xfs_growfs /</code> 使用设备的所有可用空间<br><strong>备份重要数据-卸载文件系统-调整分区大小-调整文件系统大小-重新挂载文件系统</strong></p><p>范例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>#创建物理卷
</span></span><span style=display:flex><span>pvcreate /dev/sda3
</span></span><span style=display:flex><span>#为卷组分配物理卷
</span></span><span style=display:flex><span>vgcreate vg0 /dev/sda3
</span></span><span style=display:flex><span>#从卷组创建逻辑卷
</span></span><span style=display:flex><span>lvcreate -L 256M -n data vg0
</span></span><span style=display:flex><span>#mkfs.xfs /dev/vg0/data
</span></span><span style=display:flex><span>#挂载
</span></span><span style=display:flex><span>mount /dev/vg0/data /mnt/data
</span></span></code></pre></div><h3 id=扩展和缩减逻辑卷>扩展和缩减逻辑卷
<a class=header-anchor href=#%e6%89%a9%e5%b1%95%e5%92%8c%e7%bc%a9%e5%87%8f%e9%80%bb%e8%be%91%e5%8d%b7></a></h3><h4 id=在线扩展逻辑卷>在线扩展逻辑卷
<a class=header-anchor href=#%e5%9c%a8%e7%ba%bf%e6%89%a9%e5%b1%95%e9%80%bb%e8%be%91%e5%8d%b7></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>#两步实现
</span></span><span style=display:flex><span>#第一步实现逻辑卷的空间扩展
</span></span><span style=display:flex><span>lvextend -L [+]#[mMgGtT] /dev/VG_NAME/LV_NAME
</span></span><span style=display:flex><span>#第二步实现文件系统的扩展
</span></span><span style=display:flex><span>#针对ext
</span></span><span style=display:flex><span>resize2fs /dev/VG_NAME/LV_NAME
</span></span><span style=display:flex><span>#针对xfs
</span></span><span style=display:flex><span>xfs_growfs MOUNTPOINT  MOUNTPOINT：这是XFS文件系统挂载点的路径。例如，如果你将文件系统挂载到了 /mnt/data，那么 MOUNTPOINT 就是 /mnt/data。
</span></span><span style=display:flex><span>#一步实现容间和文件系统的扩展
</span></span><span style=display:flex><span>lvresize -r -l +100%FREE /dev/VG_NAME/LV_NAME
</span></span></code></pre></div><h4 id=缩减逻辑卷>缩减逻辑卷
<a class=header-anchor href=#%e7%bc%a9%e5%87%8f%e9%80%bb%e8%be%91%e5%8d%b7></a></h4><p><strong>注意：缩减有数据损坏的风险，建议先备份再缩减，xfs文件系统不支持缩减</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>umount /dev/VG_NAME/LV_NAME
</span></span><span style=display:flex><span>e2fsck -f /dev/VG_NAME/LV_NAME
</span></span><span style=display:flex><span>resize2fs /dev/VG_NAME/LV_NAME #[mMgGtT]
</span></span><span style=display:flex><span>lvreduce -L [-]#[mMgGtT] /dev/VG_NAME/LV_NAME
</span></span><span style=display:flex><span>mount /dev/VG_NAME/LV_NAME mountpoint
</span></span></code></pre></div><p><strong>umount /dev/VG_NAME/LV_NAME：</strong></p><ul><li>umount：这是一个用于卸载文件系统的命令。</li><li>/dev/VG_NAME/LV_NAME：这是要卸载的逻辑卷的设备路径。VG_NAME 是卷组的名称，LV_NAME 是逻辑卷的名称。</li></ul><p><strong>e2fsck -f /dev/VG_NAME/LV_NAME：</strong></p><ul><li>e2fsck：这是一个用于检查和修复ext2, ext3, 或 ext4文件系统的工具。</li><li>-f：这个选项表示强制检查文件系统，即使文件系统看起来是干净的。</li><li>/dev/VG_NAME/LV_NAME：这是要检查的逻辑卷的设备路径。</li></ul><p><strong>resize2fs /dev/VG_NAME/LV_NAME #[mMgGtT]：</strong></p><ul><li>resize2fs：这是一个用于调整ext2, ext3, 或 ext4文件系统大小的工具。</li><li>/dev/VG_NAME/LV_NAME：这是要调整大小的逻辑卷的设备路径。</li><li>#[mMgGtT]：这是新的文件系统大小，可以是字节、千字节、兆字节、吉字节或太字节，分别用 b, k, m, g, t 表示。</li></ul><p><strong>lvreduce -L [-]#[mMgGtT] /dev/VG_NAME/LV_NAME：</strong></p><ul><li>lvreduce：这是一个用于缩小逻辑卷大小的命令。</li><li>-L [-]#[mMgGtT]：这个选项表示新的逻辑卷大小。如果大小前面有 -，表示减少相应的大小。</li><li>/dev/VG_NAME/LV_NAME：这是要缩小的逻辑卷的设备路径。</li></ul><p><strong>mount /dev/VG_NAME/LV_NAME mountpoint：</strong></p><ul><li>mount：这是一个用于挂载文件系统的命令。</li><li>/dev/VG_NAME/LV_NAME：这是要挂载的逻辑卷的设备路径。</li><li>mountpoint：这是文件系统应该被挂载到的目录。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>#或者可以简写
</span></span><span style=display:flex><span>umount /dev/VG_NAME/LV_NAME
</span></span><span style=display:flex><span>lvreduce -L #[mMgGtT] -r /dev/VG_NAME/LV_NAME
</span></span><span style=display:flex><span>mount /dev/VG_NAME/LV_NAME mountpoint
</span></span></code></pre></div><p><strong>umount /dev/VG_NAME/LV_NAME：</strong></p><ul><li>umount：这是一个用于卸载文件系统的命令。</li><li>/dev/VG_NAME/LV_NAME：这是要卸载的逻辑卷的设备路径。VG_NAME 是卷组的名称，LV_NAME 是逻辑卷的名称。</li></ul><p><strong>lvreduce -L #[mMgGtT] -r /dev/VG_NAME/LV_NAME：</strong></p><ul><li>lvreduce：这是一个用于缩小逻辑卷大小的命令。</li><li>-L #[mMgGtT]：这个选项表示新的逻辑卷大小。# 是大小数字，m, M, g, G, t, T 分别表示兆字节、吉字节、太字节。</li><li>-r：这个选项表示在缩小逻辑卷大小之后，自动调整文件系统的大小以匹配新的逻辑卷大小。这个选项只对某些文件系统类型有效，如ext2, ext3, ext4。</li><li>/dev/VG_NAME/LV_NAME：这是要缩小的逻辑卷的设备路径。</li></ul><p><strong>mount /dev/VG_NAME/LV_NAME mountpoint：</strong></p><ul><li>mount：这是一个用于挂载文件系统的命令。</li><li>/dev/VG_NAME/LV_NAME：这是要挂载的逻辑卷的设备路径。</li><li>mountpoint：这是文件系统应该被挂载到的目录。<br>范例：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#blkid /dev/vg0/mysql
</span></span><span style=display:flex><span>/dev/vg0/mysql: UUID=&#34;94674607-2196-4015-9194-4632ac23f36a&#34; TYPE=&#34;ext4&#34;
</span></span><span style=display:flex><span>[root@centos8 ~]#lvs
</span></span><span style=display:flex><span>LV      VG       Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert
</span></span><span style=display:flex><span>mysql vg0 -wi-a----- 2.99g
</span></span><span style=display:flex><span>[root@centos8 ~]#df
</span></span><span style=display:flex><span>Filesystem          1K-blocks   Used    Available   Use% Mounted on
</span></span><span style=display:flex><span>devtmpfs            391676      0 391676            0% /dev
</span></span><span style=display:flex><span>tmpfs               408092      0 408092            0% /dev/shm
</span></span><span style=display:flex><span>tmpfs               408092      5792 402300         2% /run
</span></span><span style=display:flex><span>tmpfs               408092      0 408092            0% /sys/fs/cgroup
</span></span><span style=display:flex><span>/dev/sda2           104806400    2274504 102531896  3% /
</span></span><span style=display:flex><span>/dev/sda3           52403200     98576 52004624     1% /data
</span></span><span style=display:flex><span>/dev/sda1           999320      130848 799660       15% /boot
</span></span><span style=display:flex><span>tmpfs               81616       0 81616             0% /run/user/0
</span></span><span style=display:flex><span>/dev/mapper/vg0-mysql 3022704 9204 2840240          1% /data/mysql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#第一步
</span></span><span style=display:flex><span>[root@centos8 ~]#umount /data/mysql
</span></span><span style=display:flex><span>[root@centos8 ~]#resize2fs /dev/vg0/mysql 1G
</span></span><span style=display:flex><span>resize2fs 1.44.6 (5-Mar-2019)
</span></span><span style=display:flex><span>Please run &#39;e2fsck -f /dev/vg0/mysql&#39; first.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#第二步
</span></span><span style=display:flex><span>[root@centos8 ~]#fsck -f /dev/vg0/mysql
</span></span><span style=display:flex><span>fsck from util-linux 2.32.1
</span></span><span style=display:flex><span>e2fsck 1.44.6 (5-Mar-2019)
</span></span><span style=display:flex><span>Pass 1: Checking inodes, blocks, and sizes
</span></span><span style=display:flex><span>Pass 2: Checking directory structure
</span></span><span style=display:flex><span>Pass 3: Checking directory connectivity
</span></span><span style=display:flex><span>Pass 4: Checking reference counts
</span></span><span style=display:flex><span>Pass 5: Checking group summary information
</span></span><span style=display:flex><span>/dev/mapper/vg0-mysql: 14/196224 files (0.0% non-contiguous), 31009/784384
</span></span><span style=display:flex><span>blocks
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#第三步
</span></span><span style=display:flex><span>[root@centos8 ~]#resize2fs /dev/vg0/mysql 1G
</span></span><span style=display:flex><span>resize2fs 1.44.6 (5-Mar-2019)
</span></span><span style=display:flex><span>Resizing the filesystem on /dev/vg0/mysql to 262144 (4k) blocks.
</span></span><span style=display:flex><span>The filesystem on /dev/vg0/mysql is now 262144 (4k) blocks long.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#lvs
</span></span><span style=display:flex><span>LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert
</span></span><span style=display:flex><span>mysql vg0 -wi-a----- 2.99g
</span></span><span style=display:flex><span>[root@centos8 ~]#df
</span></span><span style=display:flex><span>Filesystem 1K-blocks Used Available Use% Mounted on
</span></span><span style=display:flex><span>devtmpfs 391676 0 391676 0% /dev
</span></span><span style=display:flex><span>tmpfs 408092 0 408092 0% /dev/shm
</span></span><span style=display:flex><span>tmpfs 408092 5792 402300 2% /run
</span></span><span style=display:flex><span>tmpfs 408092 0 408092 0% /sys/fs/cgroup
</span></span><span style=display:flex><span>/dev/sda2 104806400 2274504 102531896 3% /
</span></span><span style=display:flex><span>/dev/sda3 52403200 398576 52004624 1% /data
</span></span><span style=display:flex><span>/dev/sda1 999320 130848 799660 15% /boot
</span></span><span style=display:flex><span>tmpfs 81616 0 81616 0% /run/user/0
</span></span><span style=display:flex><span>[root@centos8 ~]#mount -a
</span></span><span style=display:flex><span>[root@centos8 ~]#df
</span></span><span style=display:flex><span>Filesystem 1K-blocks Used Available Use% Mounted on
</span></span><span style=display:flex><span>devtmpfs 391676 0 391676 0% /dev
</span></span><span style=display:flex><span>tmpfs 408092 0 408092 0% /dev/shm
</span></span><span style=display:flex><span>tmpfs 408092 5792 402300 2% /run
</span></span><span style=display:flex><span>tmpfs 408092 0 408092 0% /sys/fs/cgroup
</span></span><span style=display:flex><span>/dev/sda2 104806400 2274504 102531896 3% /
</span></span><span style=display:flex><span>/dev/sda3 52403200 398576 52004624 1% /data
</span></span><span style=display:flex><span>/dev/sda1 999320 130848 799660 15% /boot
</span></span><span style=display:flex><span>tmpfs 81616 0 81616 0% /run/user/0
</span></span><span style=display:flex><span>/dev/mapper/vg0-mysql 966584 7676 890096 1% /data/mysql
</span></span><span style=display:flex><span>[root@centos8 ~]#df -h
</span></span><span style=display:flex><span>Filesystem Size Used Avail Use% Mounted on
</span></span><span style=display:flex><span>devtmpfs 383M 0 383M 0% /dev
</span></span><span style=display:flex><span>tmpfs 399M 0 399M 0% /dev/shm
</span></span><span style=display:flex><span>tmpfs 399M 5.7M 393M 2% /run
</span></span><span style=display:flex><span>tmpfs 399M 0 399M 0% /sys/fs/cgroup
</span></span><span style=display:flex><span>/dev/sda2 100G 2.2G 98G 3% /
</span></span><span style=display:flex><span>/dev/sda3 50G 390M 50G 1% /data
</span></span><span style=display:flex><span>/dev/sda1 976M 128M 781M 15% /boot
</span></span><span style=display:flex><span>tmpfs 80M 0 80M 0% /run/user/0
</span></span><span style=display:flex><span>/dev/mapper/vg0-mysql 944M 7.5M 870M 1% /data/mysql
</span></span><span style=display:flex><span>[root@centos8 ~]#lvs
</span></span><span style=display:flex><span>LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert
</span></span><span style=display:flex><span>mysql vg0 -wi-ao---- 2.99g
</span></span><span style=display:flex><span>[root@centos8 ~]#umount /data/mysql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#第四步
</span></span><span style=display:flex><span>[root@centos8 ~]#lvreduce -L 1G /dev/vg0/mysql
</span></span><span style=display:flex><span>WARNING: Reducing active logical volume to 1.00 GiB.
</span></span><span style=display:flex><span>THIS MAY DESTROY YOUR DATA (filesystem etc.)
</span></span><span style=display:flex><span>Do you really want to reduce vg0/mysql? [y/n]: y
</span></span><span style=display:flex><span>Size of logical volume vg0/mysql changed from 2.99 GiB (766 extents) to 1.00
</span></span><span style=display:flex><span>GiB (256 extents).
</span></span><span style=display:flex><span>Logical volume vg0/mysql successfully resized.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#第五步
</span></span><span style=display:flex><span>[root@centos8 ~]#mount -a
</span></span><span style=display:flex><span>[root@centos8 ~]#lvs
</span></span><span style=display:flex><span>LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert
</span></span><span style=display:flex><span>mysql vg0 -wi-ao---- 1.00g
</span></span><span style=display:flex><span>[root@centos8 ~]#df -h
</span></span><span style=display:flex><span>Filesystem Size Used Avail Use% Mounted on
</span></span><span style=display:flex><span>devtmpfs 383M 0 383M 0% /dev
</span></span><span style=display:flex><span>tmpfs 399M 0 399M 0% /dev/shm
</span></span><span style=display:flex><span>tmpfs 399M 5.7M 393M 2% /run
</span></span><span style=display:flex><span>tmpfs 399M 0 399M 0% /sys/fs/cgroup
</span></span><span style=display:flex><span>/dev/sda2 100G 2.2G 98G 3% /
</span></span><span style=display:flex><span>/dev/sda3 50G 390M 50G 1% /data
</span></span><span style=display:flex><span>/dev/sda1 976M 128M 781M 15% /boot
</span></span><span style=display:flex><span>tmpfs 80M 0 80M 0% /run/user/0
</span></span><span style=display:flex><span>/dev/mapper/vg0-mysql 944M 7.5M 870M 1% /data/mysql
</span></span></code></pre></div><p>范例: 缩减逻辑卷简化步骤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#df -h /mnt
</span></span><span style=display:flex><span>Filesystem Size Used Avail Use% Mounted on
</span></span><span style=display:flex><span>/dev/mapper/vg0-lv0 1G 2.7M 439M 1% /mnt
</span></span><span style=display:flex><span>[root@centos8 ~]#lvs
</span></span><span style=display:flex><span>LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync
</span></span><span style=display:flex><span>Convert
</span></span><span style=display:flex><span>lv0 vg0 -wi-a----- 1023.00m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#umount /mnt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#使用选项-r 可以同时缩减卷和文件系统
</span></span><span style=display:flex><span>[root@centos8 ~]#lvreduce -L 500M -r /dev/vg0/lv0
</span></span><span style=display:flex><span>fsck from util-linux 2.32.1
</span></span><span style=display:flex><span>/dev/mapper/vg0-lv0: 116/65536 files (0.0% non-contiguous), 9152/261888 blocks
</span></span><span style=display:flex><span>resize2fs 1.45.6 (20-Mar-2020)
</span></span><span style=display:flex><span>Resizing the filesystem on /dev/mapper/vg0-lv0 to 128000 (4k) blocks.
</span></span><span style=display:flex><span>The filesystem on /dev/mapper/vg0-lv0 is now 128000 (4k) blocks long.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Size of logical volume vg0/lv0 changed from 1023.00 MiB (1023 extents) to
</span></span><span style=display:flex><span>500.00 MiB (500 extents).
</span></span><span style=display:flex><span>Logical volume vg0/lv0 successfully resized.
</span></span><span style=display:flex><span>[root@centos8 ~]#lvs
</span></span><span style=display:flex><span>LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync
</span></span><span style=display:flex><span>Convert
</span></span><span style=display:flex><span>lv0 vg0 -wi-a----- 500.00m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#mount /dev/vg0/lv0 /mnt
</span></span><span style=display:flex><span>[root@centos8 ~]#df -h /mnt
</span></span><span style=display:flex><span>Filesystem Size Used Avail Use% Mounted on
</span></span><span style=display:flex><span>/dev/mapper/vg0-lv0 476M 2.7M 439M 1% /mnt
</span></span></code></pre></div><p>范例: 缩减XFS文件系统的逻辑卷</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>#因为XFS文件系统不支持缩减,可以用下面方式缩减
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#先备份XFS文件系统数据
</span></span><span style=display:flex><span>[root@centos8 ~]#yum -y install xfsdump
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#备份/data挂载点对应的逻辑卷
</span></span><span style=display:flex><span>#注意挂载点后面不要加/,否则会出错:xfsdump: ERROR: /data/ does not identify a file
</span></span><span style=display:flex><span>system
</span></span><span style=display:flex><span>[root@centos8 ~]#xfsdump -f data.img /data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#卸载文件系统
</span></span><span style=display:flex><span>[root@centos8 ~]#umount /data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#缩减逻辑卷
</span></span><span style=display:flex><span>[root@centos8 ~]#lvreduce -L 10G /dev/vg0/lv0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#重新创建文件系统
</span></span><span style=display:flex><span>[root@centos8 ~]#mkfs.xfs -f /dev/vg0/lv0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#重新挂载
</span></span><span style=display:flex><span>[root@centos8 ~]#mount /dev/vg0/lv0 /data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#还原数据
</span></span><span style=display:flex><span>[root@centos8 ~]#xfsrestore -f data.img /data
</span></span></code></pre></div><h3 id=跨主机迁移卷组>跨主机迁移卷组
<a class=header-anchor href=#%e8%b7%a8%e4%b8%bb%e6%9c%ba%e8%bf%81%e7%a7%bb%e5%8d%b7%e7%bb%84></a></h3><p>源计算机上</p><h4 id=1-在旧系统中umount-所有卷组上的逻辑卷>1 在旧系统中，umount 所有卷组上的逻辑卷
<a class=header-anchor href=#1-%e5%9c%a8%e6%97%a7%e7%b3%bb%e7%bb%9f%e4%b8%adumount-%e6%89%80%e6%9c%89%e5%8d%b7%e7%bb%84%e4%b8%8a%e7%9a%84%e9%80%bb%e8%be%91%e5%8d%b7></a></h4><h4 id=2-禁用卷组>2 禁用卷组
<a class=header-anchor href=#2-%e7%a6%81%e7%94%a8%e5%8d%b7%e7%bb%84></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>vgchange -a n vg0
</span></span><span style=display:flex><span>lvdisplay
</span></span></code></pre></div><p>vgchange -a n vg0：</p><ul><li>vgchange：这是一个用于更改卷组属性的命令。</li><li>-a n：这个选项表示禁用卷组，n 代表 “no”，意味着卷组中的所有逻辑卷都将被禁用。</li><li>vg0：这是要禁用的卷组的名称。
lvdisplay：</li><li>lvdisplay：这是一个用于显示逻辑卷信息的命令。</li></ul><h4 id=3-导出卷组>3 导出卷组
<a class=header-anchor href=#3-%e5%af%bc%e5%87%ba%e5%8d%b7%e7%bb%84></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>vgexport vg0
</span></span><span style=display:flex><span>pvscan
</span></span><span style=display:flex><span>vgdisplay
</span></span></code></pre></div><p><code>vgexport</code> 命令用于导出 LVM（逻辑卷管理）卷组，使其在系统中不可见。这样做通常是为了将卷组移动到另一台计算机或进行备份。命令 vgexport vg0 的含义如下：</p><ul><li>vgexport：这是命令的名称，用于导出卷组。</li><li>vg0：这是要导出的卷组的名称。
执行 vgexport vg0 命令后，卷组 vg0 将不再在系统中可见，这意味着你不能对其执行任何操作，包括创建、扩展或缩小逻辑卷等。</li></ul><p>接下来，pvscan 命令用于扫描所有磁盘，查找包含 LVM 物理卷的设备。这个命令在执行 vgexport 后使用，以确保系统更新其关于可用物理卷的信息。</p><p>最后，vgdisplay 命令用于显示 LVM 卷组的详细信息。由于你已经导出了 vg0 卷组，vgdisplay 命令将不再显示 vg0 卷组的信息，因为它在系统中不再可见。</p><h4 id=4-拆下旧硬盘在目标计算机上并导入卷组>4 拆下旧硬盘在目标计算机上,并导入卷组：
<a class=header-anchor href=#4-%e6%8b%86%e4%b8%8b%e6%97%a7%e7%a1%ac%e7%9b%98%e5%9c%a8%e7%9b%ae%e6%a0%87%e8%ae%a1%e7%ae%97%e6%9c%ba%e4%b8%8a%e5%b9%b6%e5%af%bc%e5%85%a5%e5%8d%b7%e7%bb%84></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>vgimport vg0
</span></span></code></pre></div><p>vgimport 命令用于将一个已经导出（exported）的卷组（Volume Group，VG）重新导入到LVM系统中。当卷组被导出时，它从LVM的激活列表中移除，这意味着它的逻辑卷（Logical Volumes，LVs）不能被访问。导入卷组后，可以重新激活并访问其逻辑卷。</p><h4 id=5-启用>5 启用
<a class=header-anchor href=#5-%e5%90%af%e7%94%a8></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>vgchange -ay vg0
</span></span></code></pre></div><p>gchange 命令用于改变 LVM（逻辑卷管理）卷组的属性。命令 vgchange -ay vg0 的含义如下：</p><ul><li>vgchange：这是命令的名称，用于改变卷组的属性。</li><li>-ay：这个选项用于激活卷组。其中，a 表示激活，y 表示 yes，即对所有询问回答 yes。
执行 vgchange -ay vg0 命令后，卷组 vg0 将被激活，这意味着它的逻辑卷将变得可访问，并且可以挂载和使用。</li></ul><h4 id=6-mount-所有卷组上的逻辑卷>6 mount 所有卷组上的逻辑卷
<a class=header-anchor href=#6-mount-%e6%89%80%e6%9c%89%e5%8d%b7%e7%bb%84%e4%b8%8a%e7%9a%84%e9%80%bb%e8%be%91%e5%8d%b7></a></h4><h3 id=拆除指定的pv存储设备>拆除指定的PV存储设备
<a class=header-anchor href=#%e6%8b%86%e9%99%a4%e6%8c%87%e5%ae%9a%e7%9a%84pv%e5%ad%98%e5%82%a8%e8%ae%be%e5%a4%87></a></h3><p>要拆除一个指定的物理卷（PV）存储设备，需要执行以下步骤：<br>**卸载逻辑卷：**首先，确保与该物理卷相关的所有逻辑卷（LV）都已经卸载。你可以使用 umount 命令来卸载它们。<br>**删除逻辑卷：**如果物理卷上有任何逻辑卷，你需要先删除这些逻辑卷。使用 lvremove 命令来删除逻辑卷。<br>**从卷组中移除物理卷：**使用 vgreduce 命令从卷组中移除物理卷。<br>**删除物理卷 **
**拆除物理设备 **</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#pvdisplay
</span></span><span style=display:flex><span>[root@centos8 ~]#pvmove /dev/sdc
</span></span><span style=display:flex><span>[root@centos8 ~]#pvdisplay
</span></span><span style=display:flex><span>[root@centos8 ~]#vgreduce vg0 /dev/sdc
</span></span><span style=display:flex><span>[root@centos8 ~]#pvs
</span></span><span style=display:flex><span>[root@centos8 ~]#pvremove /dev/sdc
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@centos8 ~]#pvdisplay
</span></span><span style=display:flex><span>--- Physical volume ---
</span></span><span style=display:flex><span>PV Name /dev/sda7
</span></span><span style=display:flex><span>VG Name vg0
</span></span><span style=display:flex><span>PV Size 3.00 GiB / not usable 4.00 MiB
</span></span><span style=display:flex><span>Allocatable yes
</span></span><span style=display:flex><span>PE Size 4.00 MiB
</span></span><span style=display:flex><span>Total PE 767
</span></span><span style=display:flex><span>Free PE 255
</span></span><span style=display:flex><span>Allocated PE 512
</span></span><span style=display:flex><span>PV UUID rAYPLI-H4Or-Kz7L-44So-IZaD-vEbj-meOz7N
</span></span><span style=display:flex><span>--- Physical volume ---
</span></span><span style=display:flex><span>PV Name /dev/sdc
</span></span><span style=display:flex><span>VG Name vg0
</span></span><span style=display:flex><span>PV Size 10.00 GiB / not usable 4.00 MiB
</span></span><span style=display:flex><span>Allocatable yes
</span></span><span style=display:flex><span>PE Size 4.00 MiB
</span></span><span style=display:flex><span>Total PE 2559
</span></span><span style=display:flex><span>Free PE 2303
</span></span><span style=display:flex><span>Allocated PE 256
</span></span><span style=display:flex><span>PV UUID RDR8Ge-Oxb0-OrT2-CVj7-8doA-r5fo-hj4ZCm
</span></span><span style=display:flex><span>--- Physical volume ---
</span></span><span style=display:flex><span>PV Name /dev/sdb
</span></span><span style=display:flex><span>VG Name vg0
</span></span><span style=display:flex><span>PV Size 20.00 GiB / not usable 4.00 MiB
</span></span><span style=display:flex><span>Allocatable yes
</span></span><span style=display:flex><span>PE Size 4.00 MiB
</span></span><span style=display:flex><span>Total PE 5119
</span></span><span style=display:flex><span>Free PE 5119
</span></span><span style=display:flex><span>Allocated PE 0
</span></span><span style=display:flex><span>PV UUID Ky0f8z-qjVT-ikWZ-gfwL-H5d7-ZsZ2-NDcJ3v
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#pvmove /dev/sdc
</span></span><span style=display:flex><span>/dev/sdc: Moved: 0.78%
</span></span><span style=display:flex><span>/dev/sdc: Moved: 100.00%
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#pvdisplay
</span></span><span style=display:flex><span>--- Physical volume ---
</span></span><span style=display:flex><span>PV Name /dev/sda7
</span></span><span style=display:flex><span>VG Name vg0
</span></span><span style=display:flex><span>PV Size 3.00 GiB / not usable 4.00 MiB
</span></span><span style=display:flex><span>Allocatable yes
</span></span><span style=display:flex><span>PE Size 4.00 MiB
</span></span><span style=display:flex><span>Total PE 767
</span></span><span style=display:flex><span>Free PE 255
</span></span><span style=display:flex><span>Allocated PE 512
</span></span><span style=display:flex><span>PV UUID rAYPLI-H4Or-Kz7L-44So-IZaD-vEbj-meOz7N
</span></span><span style=display:flex><span>--- Physical volume ---
</span></span><span style=display:flex><span>PV Name /dev/sdc
</span></span><span style=display:flex><span>VG Name vg0
</span></span><span style=display:flex><span>PV Size 10.00 GiB / not usable 4.00 MiB
</span></span><span style=display:flex><span>Allocatable yes
</span></span><span style=display:flex><span>PE Size 4.00 MiB
</span></span><span style=display:flex><span>Total PE 2559
</span></span><span style=display:flex><span>Free PE 2559
</span></span><span style=display:flex><span>Allocated PE 0
</span></span><span style=display:flex><span>PV UUID RDR8Ge-Oxb0-OrT2-CVj7-8doA-r5fo-hj4ZCm
</span></span><span style=display:flex><span>--- Physical volume ---
</span></span><span style=display:flex><span>PV Name /dev/sdb
</span></span><span style=display:flex><span>VG Name vg0
</span></span><span style=display:flex><span>PV Size 20.00 GiB / not usable 4.00 MiB
</span></span><span style=display:flex><span>Allocatable yes
</span></span><span style=display:flex><span>PE Size 4.00 MiB
</span></span><span style=display:flex><span>Total PE 5119
</span></span><span style=display:flex><span>Free PE 4863
</span></span><span style=display:flex><span>Allocated PE 256
</span></span><span style=display:flex><span>PV UUID Ky0f8z-qjVT-ikWZ-gfwL-H5d7-ZsZ2-NDcJ3v
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#vgreduce vg0 /dev/sdc
</span></span><span style=display:flex><span>Removed &#34;/dev/sdc&#34; from volume group &#34;vg0&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[root@centos8 ~]#pvs
</span></span><span style=display:flex><span>PV VG Fmt Attr PSize PFree
</span></span><span style=display:flex><span>/dev/sda7 vg0 lvm2 a-- &lt;3.00g 1020.00m
</span></span><span style=display:flex><span>/dev/sdb vg0 lvm2 a-- &lt;20.00g &lt;19.00g
</span></span><span style=display:flex><span>/dev/sdc lvm2 --- 10.00g 10.00g
</span></span><span style=display:flex><span>[root@centos8 ~]#pvremove /dev/sdc
</span></span><span style=display:flex><span>Labels on physical volume &#34;/dev/sdc&#34; successfully wiped.
</span></span></code></pre></div><h2 id=逻辑卷快照>逻辑卷快照
<a class=header-anchor href=#%e9%80%bb%e8%be%91%e5%8d%b7%e5%bf%ab%e7%85%a7></a></h2><h3 id=逻辑卷快照原理>逻辑卷快照原理
<a class=header-anchor href=#%e9%80%bb%e8%be%91%e5%8d%b7%e5%bf%ab%e7%85%a7%e5%8e%9f%e7%90%86></a></h3><p>快照是特殊的逻辑卷，它是在生成快照时存在的逻辑卷的准确拷贝,对于需要备份或者复制的现有数据临
时拷贝以及其它操作来说，快照是最合适的选择,快照只有在它们和原来的逻辑卷不同时才会消耗空间，
建立快照的卷大小小于等于原始逻辑卷,也可以使用lvextend扩展快照<br>逻辑卷管理器快照<br>快照就是将当时的系统信息记录下来，就好像照相一般，若将来有任何数据改动了，则原始数据会被移
动到快照区，没有改动的区域则由快照区和文件系统共享<br>逻辑卷快照工作原理</p><ul><li>在生成快照时会分配给它一定的空间，但只有在原来的逻辑卷或者快照有所改变才会使用这些空间</li><li>当原来的逻辑卷中有所改变时，会将旧的数据复制到快照中</li><li>快照中只含有原来的逻辑卷中更改的数据或者自生成快照后的快照中更改的数据
由于快照区与原本的LV共用很多PE的区块，因此快照与被快照的LV必须在同一个VG中.系统恢复的时候
的文件数量不能高于快照区的实际容量<br>快照特点：</li><li>备份速度快，瞬间完</li><li>应用场景是测试环境，不能完成代替备份</li><li>快照后，逻辑卷的修改速度会一定有影响</li></ul><h3 id=实现逻辑卷快照>实现逻辑卷快照
<a class=header-anchor href=#%e5%ae%9e%e7%8e%b0%e9%80%bb%e8%be%91%e5%8d%b7%e5%bf%ab%e7%85%a7></a></h3><p>范例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>mkfs.xfs /dev/vg0/data
</span></span><span style=display:flex><span>mount /dev/vg0/data/ /mnt/data
</span></span></code></pre></div><h4 id=为现有逻辑卷创建快照>为现有逻辑卷创建快照
<a class=header-anchor href=#%e4%b8%ba%e7%8e%b0%e6%9c%89%e9%80%bb%e8%be%91%e5%8d%b7%e5%88%9b%e5%bb%ba%e5%bf%ab%e7%85%a7></a></h4><p>注意ext4建议使用-p r 实现只读</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>lvcreate -l 64 -s -n data-snapshot /dev/vg0/data  
</span></span><span style=display:flex><span>lvcreate -l 64 -s -n data-snapshot /dev/vg0/data -p r   
</span></span><span style=display:flex><span>lvcreate  -n  lv-mysal-snapshot -s -p r -L 1G  /dev/testvg0/lv-mysql
</span></span><span style=display:flex><span>1G
</span></span></code></pre></div><ul><li>lvcreate：这是命令的名称，用于创建逻辑卷。</li><li>-l 64：这个选项用于指定逻辑卷的大小。在这种情况下，64 表示逻辑卷将使用 64 个物理扩展（PE）。</li><li>-L 1G： 以容量大小。</li><li>-s：这个选项用于创建一个快照卷。</li><li>-n data-snapshot：这个选项用于指定新创建的逻辑卷（快照卷）的名称为 data-snapshot。</li><li>/dev/vg0/data：这是原始逻辑卷的设备文件路径，其中 vg0 是卷组名称，data 是原始逻辑卷的名称。</li><li>-p r：这个选项用于指定快照卷的权限模式为只读。
执行这个命令后，将创建一个名为 data-snapshot 的快照卷，它是 /dev/vg0/data 的快照，并且这个快照卷将以只读模式创建。</li></ul><h4 id=挂载快照>挂载快照
<a class=header-anchor href=#%e6%8c%82%e8%bd%bd%e5%bf%ab%e7%85%a7></a></h4><p>xfs注意要使用-o ro实现只读,防止快照被修改</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>mkdir -p /mnt/snap
</span></span><span style=display:flex><span>mount -o ro,nouuid /dev/vg0/data-snapshot /mnt/snap
</span></span></code></pre></div><p>mkdir -p /mnt/snap 命令用于创建一个目录树，如果该目录树中的目录不存在，则会创建它们。-p 选项表示如果目录树中的任何目录不存在，就创建它。这个命令通常用于确保一个目录路径存在，而不管它是否已经存在。</p><ul><li>mount 是命令的名称，用于挂载文件系统。</li><li>-o ro,nouuid 是挂载选项。ro 表示以只读模式挂载文件系统，nouuid 表示在挂载时忽略文件系统的 UUID，这在挂载某些类型的文件系统时可能是有用的，例如 LVM 快照卷。</li><li>/dev/vg0/data-snapshot 是要挂载的文件系统的设备文件路径。vg0 是卷组名称，data-snapshot 是快照卷的名称。</li><li>/mnt/snap 是挂载点，即文件系统将被挂载到的目录。
执行这个命令后，/dev/vg0/data-snapshot 文件系统将以只读模式挂载到 /mnt/snap 目录。</li></ul><h4 id=恢复快照>恢复快照
<a class=header-anchor href=#%e6%81%a2%e5%a4%8d%e5%bf%ab%e7%85%a7></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>umount /dev/vg0/data-snapshot
</span></span><span style=display:flex><span>umount /dev/vg0/data
</span></span><span style=display:flex><span>lvconvert --merge /dev/vg0/data-snapshot
</span></span></code></pre></div><p><strong>umount /dev/vg0/data-snapshot：</strong></p><ul><li>umount：这是一个用于卸载文件系统的命令。</li><li>/dev/vg0/data-snapshot：这是要卸载的快照卷的设备路径。vg0 是卷组的名称，data-snapshot 是快照卷的逻辑卷名称。</li></ul><p><strong>umount /dev/vg0/data：</strong></p><ul><li>umount：这是用于卸载文件系统的命令。</li><li>/dev/vg0/data：这是要卸载的原始逻辑卷的设备路径。vg0 是卷组的名称，data 是原始逻辑卷的名称。</li></ul><p><strong>lvconvert &ndash;merge /dev/vg0/data-snapshot：</strong></p><ul><li>lvconvert：这是一个用于转换逻辑卷的命令。</li><li>&ndash;merge：这个选项表示将快照卷合并回其原始逻辑卷。</li><li>/dev/vg0/data-snapshot：这是要合并的快照卷的设备路径。</li></ul><h4 id=删除快照>删除快照
<a class=header-anchor href=#%e5%88%a0%e9%99%a4%e5%bf%ab%e7%85%a7></a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>umount /mnt/snap
</span></span><span style=display:flex><span>lvremove /dev/vg0/data-snapshot
</span></span></code></pre></div><ul><li>umount：这是命令的名称，用于卸载文件系统。</li><li>/mnt/snap：这是要卸载的挂载点，即之前文件系统被挂载到的目录。
执行 umount /mnt/snap 命令后，/mnt/snap 目录下的文件系统将被卸载，不再可访问。</li></ul><p>lvremove 命令用于删除 LVM（逻辑卷管理）逻辑卷。命令 lvremove /dev/vg0/data-snapshot 的含义如下：</p><ul><li>lvremove：这是命令的名称，用于删除逻辑卷。</li><li>/dev/vg0/data-snapshot：这是要删除的逻辑卷的设备文件路径，其中 vg0 是卷组名称，data-snapshot 是逻辑卷的名称。</li></ul><h4 id=练习-1>练习
<a class=header-anchor href=#%e7%bb%83%e4%b9%a0-1></a></h4><p>1、创建一个至少有两个PV组成的大小为20G的名为testvg的VG；要求PE大小为16MB, 而后在卷组中创
建大小为5G的逻辑卷testlv；挂载至/users目录<br>2、 新建用户archlinux，要求其家目录为/users/archlinux，而后su切换至archlinux用户，复
制/etc/pam.d目录至自己的家目录<br>3、扩展testlv至7G，要求archlinux用户的文件不能丢失<br>4、收缩testlv至3G，要求archlinux用户的文件不能丢失<br>5、对testlv创建快照，并尝试基于快照备份数据，验证快照的功能</p><h3 id=卸载逻辑卷>卸载逻辑卷
<a class=header-anchor href=#%e5%8d%b8%e8%bd%bd%e9%80%bb%e8%be%91%e5%8d%b7></a></h3><p>反着来一遍
先取消挂载，若写入了fstab文件，也需要删除。
<img src=/imgs/img-lazy-loading.gif data-src=/images/url/linux/linux09/08.jpg alt></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># mount /data/mysql</span>
</span></span><span style=display:flex><span>mount: <span style=color:#f92672>/</span>data<span style=color:#f92672>/</span>mysql: <span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>mapper<span style=color:#f92672>/</span>testvg0<span style=color:#f92672>-</span>mysql already mounted on <span style=color:#f92672>/</span>data<span style=color:#f92672>/</span>mysql<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>mount: (hint) your fstab has been modified, but systemd still uses
</span></span><span style=display:flex><span>       the old version; use <span style=color:#e6db74>&#39;systemctl daemon-reload&#39;</span> to reload<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># umount /dev/testvg0/mysql</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># lvremove /dev/testvg0/mysql</span>
</span></span><span style=display:flex><span>Do you really want to remove active logical volume testvg0<span style=color:#f92672>/</span>mysql<span style=color:#960050;background-color:#1e0010>?</span> [y<span style=color:#f92672>/</span>n]: y
</span></span><span style=display:flex><span>  Logical volume <span style=color:#e6db74>&#34;mysql&#34;</span> successfully removed<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># vgremove testvg0</span>
</span></span><span style=display:flex><span>  Volume group <span style=color:#e6db74>&#34;testvg0&#34;</span> successfully removed
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># vgs</span>
</span></span><span style=display:flex><span>  VG <span style=color:#75715e>#PV #LV #SN Attr   VSize    VFree</span>
</span></span><span style=display:flex><span>  rl   <span style=color:#ae81ff>1</span>   <span style=color:#ae81ff>3</span>   <span style=color:#ae81ff>0</span> wz<span style=color:#f92672>--</span>n<span style=color:#f92672>-</span> <span style=color:#f92672>&lt;</span><span style=color:#ae81ff>199.00</span>g    <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># pvs</span>
</span></span><span style=display:flex><span>  PV             VG Fmt  Attr PSize    PFree
</span></span><span style=display:flex><span>  <span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>nvme0n1p2 rl lvm2 a<span style=color:#f92672>--</span>  <span style=color:#f92672>&lt;</span><span style=color:#ae81ff>199.00</span>g     <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>sda1         lvm2 <span style=color:#f92672>---</span>     <span style=color:#ae81ff>5.00</span>g  <span style=color:#ae81ff>5.00</span>g
</span></span><span style=display:flex><span>  <span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>sdb          lvm2 <span style=color:#f92672>---</span>    <span style=color:#ae81ff>10.00</span>g <span style=color:#ae81ff>10.00</span>g
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># pvremove /dev/sda1  /dev/sdb</span>
</span></span><span style=display:flex><span>  Labels on physical volume <span style=color:#e6db74>&#34;/dev/sda1&#34;</span> successfully wiped<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>  Labels on physical volume <span style=color:#e6db74>&#34;/dev/sdb&#34;</span> successfully wiped<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>[root<span style=color:#960050;background-color:#1e0010>@</span>localhost <span style=color:#f92672>~</span>]<span style=color:#75715e># pvs</span>
</span></span><span style=display:flex><span>  PV             VG Fmt  Attr PSize    PFree
</span></span><span style=display:flex><span>  <span style=color:#f92672>/</span>dev<span style=color:#f92672>/</span>nvme0n1p2 rl lvm2 a<span style=color:#f92672>--</span>  <span style=color:#f92672>&lt;</span><span style=color:#ae81ff>199.00</span>g    <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h2 id=常见面试题>常见面试题
<a class=header-anchor href=#%e5%b8%b8%e8%a7%81%e9%9d%a2%e8%af%95%e9%a2%98></a></h2><ul><li>使用 parted命令将4T硬盘分区,然后制作成LVM,硬盘并挂载到/data目录，请写出操作步骤?(系
统:Centos7)</li><li>df 和 du 的区别</li><li>查看一下那几个文件的占用磁盘空间大,需要做一个使用空间大小的排序?</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>#du -a / | sort -n -r
</span></span></code></pre></div><ul><li>说说Raid0,1,5,6,10的区别</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=/images/url/linux/linux09/07.jpg alt=111></p></div><footer class=post-footer><div class=post-tags><a href=/tags/linux>linux</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/_ali-pay.png alt="蓝惠の小窝 - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/_wechat-pay.png alt="蓝惠の小窝 - 微信">
<span>微信</span></div></div></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i>
</span><span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/rss.xml><span class=icon><i class="fa fa-rss"></i>
</span><span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"></div><div class="post-nav-prev post-nav-item"><a href=/post/linux10/ rel=prev title=shell脚本编程基础>shell脚本编程基础
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>评论交流</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2019 - 2024
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>蓝惠の小窝</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.126.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>湘ICP备20000440号</a>
<img src=/imgs/gongan.png alt=湘公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011402019770" target=_blank>湘公网安备 31011402019770 号</a></div><div class=vendors-list><a target=_blank href title><img src=/imgs/img-lazy-loading.gif data-src alt>
</a><a target=_blank href title><img src=/imgs/img-lazy-loading.gif data-src alt>
</a><a target=_blank href title></a><span></span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script><script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#0cd2f8","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOL_1gUs4Cfkpa","emit":"url","inputposition":"top","mapping":"top","reactions":true,"repo":"lanhui672/lanhui672.Giscus","repoid":"R_kgDOL_1gUg","theme":"cobalt\n\nlang=\"zh-CN\""},"js":"https://giscus.app/client.js"},"hostname":"http://localhost:1313/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline"},"views":{"enable":false,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"right","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3"}</script><script type=text/javascript src=/js/main.js defer></script></body></html>